<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0a0a12">
  <title>ğŸšï¸ Audio Analyzer Pro - Soundcraft EFX8</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    :root{--bg:#0a0a12;--card:#16161f;--card2:#1c1c28;--border:#2a2a3c;--accent:#00c8ff;--green:#00e878;--yellow:#ffc400;--red:#ff3860;--purple:#a855f7;--text:#fff;--text2:#9898b0;--text3:#5a5a70}
    body{font-family:-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
    .app{max-width:480px;margin:0 auto;padding-bottom:100px}
    .header{background:linear-gradient(180deg,#111 0%,transparent 100%);padding:16px;position:sticky;top:0;z-index:100;backdrop-filter:blur(20px);display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;background:linear-gradient(135deg,var(--accent),var(--purple));border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px}
    .header h1{font-size:1.1rem}
    .header p{font-size:0.7rem;color:var(--text3)}
    .nav{display:flex;gap:4px;padding:4px;margin:12px;background:var(--card);border-radius:12px}
    .nav-btn{flex:1;padding:10px 4px;background:transparent;border:none;border-radius:8px;color:var(--text3);font-size:0.7rem;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px}
    .nav-btn.active{background:var(--accent);color:#000}
    .nav-btn span:first-child{font-size:1.2rem}
    .section{display:none;padding:0 12px}
    .section.active{display:block}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:12px}
    .card-header{display:flex;align-items:center;gap:12px;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--border)}
    .card-icon{width:36px;height:36px;background:var(--card2);border-radius:8px;display:flex;align-items:center;justify-content:center}
    .card-title{font-size:0.95rem;font-weight:700}
    .card-sub{font-size:0.7rem;color:var(--text3)}
    .mode-sel{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:16px}
    .mode-btn{padding:14px 8px;background:var(--card);border:2px solid var(--border);border-radius:12px;color:var(--text2);font-size:0.8rem;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:6px}
    .mode-btn.active{background:rgba(0,200,255,0.15);border-color:var(--accent);color:var(--accent)}
    .mode-btn span:first-child{font-size:1.8rem}
    .start-btn{width:100%;padding:18px;margin-bottom:16px;background:linear-gradient(135deg,var(--accent),#0090ff);border:none;border-radius:16px;color:#000;font-size:1rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 4px 20px rgba(0,200,255,0.4)}
    .start-btn.rec{background:linear-gradient(135deg,var(--red),#ff0040);animation:pulse 1.5s infinite}
    @keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(255,56,96,0.5)}50%{box-shadow:0 0 0 15px rgba(255,56,96,0)}}
    .status{display:flex;justify-content:space-between;padding:12px 16px;background:#111;border-radius:12px;margin-bottom:16px;font-size:0.8rem}
    .status-dot{width:8px;height:8px;background:var(--text3);border-radius:50%;display:inline-block;margin-right:8px}
    .status-dot.on{background:var(--green);box-shadow:0 0 10px var(--green);animation:blink 1s infinite}
    @keyframes blink{50%{opacity:0.5}}
    .spectrum{background:var(--bg);border-radius:12px;margin-bottom:16px;padding:2px}
    #canvas{width:100%;height:140px;display:block}
    .bands{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
    .band{background:var(--card2);border-radius:8px;padding:10px 6px;text-align:center}
    .band-meter{height:70px;background:var(--bg);border-radius:6px;margin-bottom:6px;position:relative;overflow:hidden}
    .band-fill{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(to top,var(--green),var(--yellow),var(--red));transition:height 0.1s}
    .band-target{position:absolute;left:0;right:0;height:2px;background:var(--accent);box-shadow:0 0 6px var(--accent)}
    .band-name{font-size:0.55rem;color:var(--text3)}
    .band-val{font-size:0.75rem;font-weight:700}
    .band-sts{font-size:0.5rem;font-weight:700;padding:2px 6px;border-radius:4px;margin-top:4px;display:inline-block}
    .band-sts.ok{background:rgba(0,232,120,0.2);color:var(--green)}
    .band-sts.hi{background:rgba(255,56,96,0.2);color:var(--red)}
    .band-sts.lo{background:rgba(0,200,255,0.2);color:var(--accent)}
    .results{display:none}
    .results.show{display:block}
    .score-card{background:linear-gradient(135deg,var(--card),var(--card2));border-radius:20px;padding:24px;text-align:center;margin-bottom:16px}
    .score-ring{width:130px;height:130px;margin:0 auto 16px;position:relative}
    .score-ring svg{transform:rotate(-90deg);width:100%;height:100%}
    .score-bg{fill:none;stroke:var(--bg);stroke-width:8}
    .score-prog{fill:none;stroke:var(--green);stroke-width:8;stroke-linecap:round;stroke-dasharray:377;stroke-dashoffset:377;transition:all 1s}
    .score-inner{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
    .score-num{font-size:2.5rem;font-weight:700}
    .score-lbl{font-size:0.65rem;color:var(--text3);text-transform:uppercase}
    .score-msg{font-size:1rem;font-weight:700}
    .score-hint{font-size:0.8rem;color:var(--text2)}
    .problem{background:var(--card2);border-radius:12px;padding:14px;margin-bottom:10px;border-left:4px solid var(--yellow)}
    .problem.crit{border-left-color:var(--red)}
    .problem.good{border-left-color:var(--green)}
    .problem-head{display:flex;justify-content:space-between;margin-bottom:8px}
    .problem-title{font-size:0.9rem;font-weight:700}
    .problem-badge{font-size:0.6rem;font-weight:700;padding:4px 8px;border-radius:20px}
    .badge-crit{background:rgba(255,56,96,0.2);color:var(--red)}
    .badge-warn{background:rgba(255,196,0,0.2);color:var(--yellow)}
    .badge-good{background:rgba(0,232,120,0.2);color:var(--green)}
    .problem-desc{font-size:0.8rem;color:var(--text2);margin-bottom:12px}
    .solution{background:var(--card);border-radius:8px;padding:12px}
    .solution-label{font-size:0.75rem;font-weight:700;color:var(--accent);margin-bottom:8px}
    .sol-step{display:flex;align-items:flex-start;gap:10px;padding:10px;background:var(--card2);border-radius:8px;margin-bottom:8px}
    .sol-knob{width:44px;height:44px;background:linear-gradient(145deg,#3a3a4a,#28283a);border-radius:50%;position:relative;flex-shrink:0}
    .sol-knob-ptr{position:absolute;width:3px;height:14px;background:var(--accent);border-radius:2px;top:5px;left:50%;transform-origin:bottom center;box-shadow:0 0 6px var(--accent)}
    .sol-knob-lbl{position:absolute;bottom:-16px;left:50%;transform:translateX(-50%);font-size:0.55rem;font-weight:700;color:var(--text3);white-space:nowrap}
    .sol-info{flex:1}
    .sol-action{font-size:0.85rem;font-weight:700}
    .sol-detail{font-size:0.75rem;color:var(--text2)}
    .sol-turn{display:inline-flex;padding:3px 8px;background:rgba(0,200,255,0.15);border-radius:4px;font-size:0.7rem;font-weight:700;color:var(--accent);margin-top:6px}
    .mixer{background:linear-gradient(145deg,#1e1e2a,#16161f);border-radius:16px;padding:16px;margin-bottom:16px}
    .mixer-label{text-align:center;font-size:0.75rem;color:var(--accent);padding:8px;background:var(--bg);border-radius:8px;margin-bottom:16px;letter-spacing:2px}
    .channel{background:var(--card);border-radius:12px;padding:14px;margin-bottom:12px}
    .channel-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .channel-name{font-size:0.9rem;font-weight:700;display:flex;align-items:center;gap:8px}
    .channel-badge{padding:4px 10px;background:var(--accent);border-radius:20px;font-size:0.6rem;font-weight:700;color:#000}
    .knobs{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
    .knob-item{text-align:center}
    .knob{width:40px;height:40px;margin:0 auto 6px;background:linear-gradient(145deg,#3a3a4a,#28283a);border-radius:50%;position:relative;box-shadow:0 3px 8px rgba(0,0,0,0.4)}
    .knob-ptr{position:absolute;width:3px;height:12px;background:var(--accent);border-radius:2px;top:5px;left:50%;transform-origin:bottom center;box-shadow:0 0 6px var(--accent)}
    .knob-name{font-size:0.55rem;color:var(--text3)}
    .knob-val{font-size:0.7rem;font-weight:700}
    .knob-val.pos{color:var(--green)}
    .knob-val.neg{color:var(--red)}
    .knob-turn{font-size:0.5rem;color:var(--yellow)}
    .channel-freq{display:flex;justify-content:center;gap:8px;margin-top:12px;padding:8px;background:var(--card2);border-radius:8px;font-size:0.75rem}
    .channel-freq span:first-child{color:var(--text3)}
    .channel-freq span:last-child{font-weight:700;color:var(--purple)}
    .fx-panel{background:linear-gradient(135deg,rgba(168,85,247,0.1),transparent);border:1px solid rgba(168,85,247,0.3);border-radius:12px;padding:14px}
    .fx-head{display:flex;align-items:center;gap:8px;margin-bottom:12px;font-size:0.9rem;font-weight:700;color:var(--purple)}
    .fx-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .fx-item{background:var(--card);border-radius:8px;padding:10px}
    .fx-item-lbl{font-size:0.6rem;color:var(--text3)}
    .fx-item-val{font-size:0.85rem;font-weight:700;color:var(--purple)}
    .steps{display:flex;flex-direction:column;gap:10px}
    .step{display:flex;gap:12px;padding:14px;background:var(--card2);border-radius:12px;border:2px solid var(--border)}
    .step.active{border-color:var(--accent);background:rgba(0,200,255,0.05)}
    .step.done{border-color:var(--green);opacity:0.7}
    .step-num{width:32px;height:32px;background:var(--card);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;flex-shrink:0}
    .step.active .step-num{background:var(--accent);color:#000}
    .step.done .step-num{background:var(--green);color:#000}
    .step-content{flex:1}
    .step-title{font-size:0.9rem;font-weight:700;margin-bottom:4px}
    .step-desc{font-size:0.8rem;color:var(--text2);line-height:1.5;margin-bottom:10px}
    .step-visual{display:flex;align-items:center;gap:12px;padding:10px;background:var(--card);border-radius:8px;margin-bottom:10px}
    .step-vis-knob{width:36px;height:36px;background:linear-gradient(145deg,#3a3a4a,#28283a);border-radius:50%;position:relative;flex-shrink:0}
    .step-vis-ptr{position:absolute;width:3px;height:10px;background:var(--accent);border-radius:2px;top:5px;left:50%;transform-origin:bottom center}
    .step-vis-text{font-size:0.75rem}
    .step-btn{width:100%;padding:10px;background:var(--card);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.8rem;cursor:pointer}
    .step.done .step-btn{background:var(--green);color:#000}
    .clock-ref{display:flex;justify-content:center;gap:12px;padding:12px;background:var(--card);border-radius:12px;margin-bottom:16px}
    .clock-item{text-align:center}
    .clock-vis{width:32px;height:32px;background:var(--card2);border-radius:50%;margin:0 auto 4px;position:relative;border:2px solid var(--border)}
    .clock-hand{position:absolute;width:2px;height:10px;background:var(--accent);top:5px;left:50%;transform-origin:bottom center}
    .clock-val{font-size:0.65rem;font-weight:600}
    .clock-lbl{font-size:0.5rem;color:var(--text3)}
    .tip{display:flex;gap:12px;padding:12px;background:var(--card2);border-radius:10px;margin-bottom:8px}
    .tip-icon{font-size:1.3rem}
    .tip-title{font-size:0.8rem;font-weight:700;margin-bottom:4px}
    .tip-text{font-size:0.7rem;color:var(--text2);line-height:1.5}
    .history-item{display:flex;align-items:center;gap:12px;padding:12px;background:var(--card2);border-radius:10px;margin-bottom:8px}
    .history-score{width:44px;height:44px;background:var(--card);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1rem;font-weight:700}
    .history-info{flex:1}
    .history-mode{font-size:0.8rem;font-weight:600}
    .history-time{font-size:0.65rem;color:var(--text3)}
    .history-btn{padding:6px 10px;background:var(--card);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:0.7rem;cursor:pointer}
    .empty{text-align:center;padding:40px;color:var(--text3)}
    .empty-icon{font-size:2.5rem;margin-bottom:12px;opacity:0.5}
    .detail-tbl{width:100%;border-collapse:collapse;font-size:0.75rem}
    .detail-tbl th{padding:8px;background:var(--card2);text-align:left;color:var(--text3);border-bottom:1px solid var(--border)}
    .detail-tbl td{padding:8px;border-bottom:1px solid var(--border)}
    .detail-bar{height:6px;background:var(--bg);border-radius:3px;overflow:hidden}
    .detail-bar-fill{height:100%;border-radius:3px}
    .detail-sts{font-weight:700}
    .detail-sts.hi{color:var(--red)}
    .detail-sts.ok{color:var(--green)}
    .detail-sts.lo{color:var(--accent)}
    .fb-item{display:flex;align-items:center;gap:12px;padding:10px;background:var(--card);border-radius:8px;margin-bottom:8px;border-left:4px solid var(--red)}
    .fb-freq{font-size:1.1rem;font-weight:700;color:var(--red);min-width:70px}
    .fb-info{flex:1}
    .fb-name{font-size:0.8rem;font-weight:600}
    .fb-level{font-size:0.65rem;color:var(--text3)}
    .fb-meter{width:60px;height:8px;background:var(--bg);border-radius:4px;overflow:hidden}
    .fb-meter-fill{height:100%;background:linear-gradient(90deg,var(--yellow),var(--red));border-radius:4px}
    .compare-band{display:flex;align-items:center;gap:10px;padding:10px;background:var(--card);border-radius:8px;margin-bottom:8px}
    .compare-band-name{font-size:0.75rem;font-weight:600;width:70px}
    .compare-band-bars{flex:1;display:flex;gap:4px;align-items:center}
    .compare-band-bar{height:8px;border-radius:4px}
    .compare-band-change{font-size:0.7rem;font-weight:700;min-width:50px;text-align:right}
  </style>
</head>
<body>
<div class="app">
  <header class="header">
    <div class="logo">ğŸšï¸</div>
    <div><h1>Audio Analyzer Pro</h1><p>SOUNDCRAFT EFX8</p></div>
  </header>
  
  <nav class="nav">
    <button class="nav-btn active" data-s="analyze"><span>ğŸ“Š</span><span>PhÃ¢n TÃ­ch</span></button>
    <button class="nav-btn" data-s="headphone"><span>ğŸ§</span><span>Tai Nghe</span></button>
    <button class="nav-btn" data-s="compare"><span>âš–ï¸</span><span>So SÃ¡nh</span></button>
    <button class="nav-btn" data-s="feedback"><span>ğŸ”Š</span><span>Feedback</span></button>
    <button class="nav-btn" data-s="guide"><span>ğŸ›ï¸</span><span>Mixer</span></button>
    <button class="nav-btn" data-s="history"><span>ğŸ“‹</span><span>Lá»‹ch Sá»­</span></button>
  </nav>
  
  <section class="section active" id="s-analyze">
    <!-- Genre Preset Selector -->
    <div class="card" style="margin-bottom:12px;padding:12px">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
        <span style="font-size:1.3rem">ğŸ¼</span>
        <div style="flex:1">
          <div style="font-size:0.85rem;font-weight:700">Chá»n Thá»ƒ Loáº¡i Nháº¡c</div>
          <div style="font-size:0.65rem;color:var(--text3)">Preset EQ tá»‘i Æ°u cho tá»«ng dÃ²ng nháº¡c</div>
        </div>
      </div>
      <select id="genreSelect" style="width:100%;padding:12px;background:var(--card2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;cursor:pointer">
        <option value="">-- Chá»n thá»ƒ loáº¡i --</option>
        <optgroup label="ğŸ¬ CINEMA / DOLBY - Xem phim">
          <option value="cinema_standard">ğŸ¬ Cinema Standard (Ráº¡p chuáº©n)</option>
          <option value="dolby_atmos">ğŸ”Š Dolby Atmos (KhÃ´ng gian 3D)</option>
          <option value="dolby_atmos_music">ğŸµ Dolby Atmos Music</option>
          <option value="cinema_imax">ğŸ¦ IMAX Experience</option>
          <option value="dts_x">ğŸ”‰ DTS:X / DTS HD</option>
          <option value="surround_virtual">ğŸ§ Virtual Surround 7.1</option>
        </optgroup>
        <optgroup label="ğŸ¥ THá»‚ LOáº I PHIM">
          <option value="cinema_action">ğŸ’¥ Action (HÃ nh Ä‘á»™ng)</option>
          <option value="cinema_horror">ğŸ‘» Horror (Kinh dá»‹)</option>
          <option value="cinema_scifi">ğŸš€ Sci-Fi / Fantasy</option>
          <option value="cinema_romance">ğŸ’• Romance / Drama</option>
          <option value="cinema_dialog">ğŸ—£ï¸ Dialog Focus (Thoáº¡i rÃµ)</option>
          <option value="cinema_late_night">ğŸŒ™ Late Night (ÄÃªm khuya)</option>
        </optgroup>
        <optgroup label="ğŸ“± PHONE EQ - Nghe nháº¡c trÃªn ÄT">
          <option value="phone_bass">ğŸ”Š Bass Boost (Tai nghe)</option>
          <option value="phone_vocal">ğŸ¤ Vocal Clear (Giá»ng rÃµ)</option>
          <option value="phone_flat">ğŸ“ Flat (Chuáº©n pháº³ng)</option>
          <option value="phone_loudness">ğŸ”‰ Loudness (Volume nhá»)</option>
          <option value="phone_treble">âœ¨ Treble Boost (SÃ¡ng)</option>
          <option value="phone_night">ğŸŒ™ Night Mode (ÄÃªm)</option>
          <option value="phone_small_speaker">ğŸ”ˆ Small Speaker (Loa nhá»)</option>
        </optgroup>
        <optgroup label="ğŸ¤ Nháº¡c Viá»‡t">
          <option value="bolero">ğŸ» Bolero / Trá»¯ tÃ¬nh</option>
          <option value="nhactre">ğŸ§ Nháº¡c tráº» / V-Pop</option>
          <option value="cachmang">ğŸº CÃ¡ch máº¡ng / Äá»</option>
          <option value="dancaromantic">ğŸ’ƒ Dance / Remix</option>
        </optgroup>
        <optgroup label="ğŸŒ Nháº¡c Quá»‘c Táº¿">
          <option value="pop">ğŸµ Pop / Ballad</option>
          <option value="rock">ğŸ¸ Rock / Metal</option>
          <option value="rnb">ğŸ· R&B / Soul</option>
          <option value="edm">ğŸ¹ EDM / House</option>
          <option value="jazz">ğŸº Jazz / Blues</option>
          <option value="country">ğŸ¤  Country / Folk</option>
          <option value="hiphop">ğŸ¤ Hip-hop / Rap</option>
        </optgroup>
        <optgroup label="ğŸ¹ Acoustic / Live">
          <option value="acoustic">ğŸª• Acoustic</option>
          <option value="karaoke">ğŸ¤ Karaoke</option>
          <option value="livecafe">â˜• Live Cafe / PhÃ²ng trÃ </option>
          <option value="wedding">ğŸ’’ Tiá»‡c cÆ°á»›i / Event</option>
          <option value="church">â›ª NhÃ  thá» / ThÃ¡nh ca</option>
        </optgroup>
      </select>
      <div id="genreInfo" style="margin-top:10px;padding:10px;background:var(--bg);border-radius:8px;display:none">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <span id="genreName" style="font-size:0.85rem;font-weight:700;color:var(--accent)"></span>
          <span id="genreBadge" style="font-size:0.6rem;padding:4px 8px;background:var(--accent);color:#000;border-radius:12px;font-weight:700">PRESET</span>
        </div>
        <div id="genreDesc" style="font-size:0.7rem;color:var(--text2);margin-bottom:8px"></div>
        <div id="genreEQ" style="display:grid;grid-template-columns:repeat(5,1fr);gap:4px;font-size:0.6rem;text-align:center">
          <div><div style="color:var(--text3)">Bass</div><div id="gBass" style="font-weight:700">-</div></div>
          <div><div style="color:var(--text3)">Low</div><div id="gLowMid" style="font-weight:700">-</div></div>
          <div><div style="color:var(--text3)">Mid</div><div id="gMid" style="font-weight:700">-</div></div>
          <div><div style="color:var(--text3)">Hi-Mid</div><div id="gHighMid" style="font-weight:700">-</div></div>
          <div><div style="color:var(--text3)">High</div><div id="gHigh" style="font-weight:700">-</div></div>
        </div>
      </div>
      
      <!-- Phone EQ Visual Panel -->
      <div id="phoneEQPanel" style="display:none;margin-top:12px;background:linear-gradient(145deg,#f5f5f5,#e8e8e8);border-radius:12px;padding:16px">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
          <div style="display:flex;align-items:center;gap:8px">
            <span style="font-size:1.2rem">ğŸ“±</span>
            <span style="font-size:0.85rem;font-weight:700;color:#333">Equalizer</span>
          </div>
          <div style="display:flex;align-items:center;gap:6px">
            <div style="width:14px;height:14px;background:#4cd964;border-radius:3px;display:flex;align-items:center;justify-content:center">
              <span style="color:#fff;font-size:10px">âœ“</span>
            </div>
            <span style="font-size:0.7rem;color:#333">On</span>
          </div>
        </div>
        
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:16px">
          <div style="flex:1;height:32px;background:#fff;border:1px solid #ccc;border-radius:4px;display:flex;align-items:center;padding:0 10px">
            <span id="phoneEQName" style="font-size:0.8rem;color:#333">Custom</span>
          </div>
        </div>
        
        <div style="position:relative;background:#fff;border-radius:8px;padding:12px 8px;border:1px solid #ddd">
          <!-- dB Labels -->
          <div style="position:absolute;left:4px;top:12px;font-size:0.55rem;color:#666">+12 dB</div>
          <div style="position:absolute;left:4px;top:50%;transform:translateY(-50%);font-size:0.55rem;color:#666">0 dB</div>
          <div style="position:absolute;left:4px;bottom:28px;font-size:0.55rem;color:#666">-12 dB</div>
          
          <!-- EQ Sliders -->
          <div style="display:flex;justify-content:space-around;align-items:flex-end;height:140px;margin-left:35px;position:relative">
            <!-- Grid lines -->
            <div style="position:absolute;top:0;left:0;right:0;height:1px;background:#eee"></div>
            <div style="position:absolute;top:35px;left:0;right:0;height:1px;background:#eee"></div>
            <div style="position:absolute;top:70px;left:0;right:0;height:1px;background:#ddd"></div>
            <div style="position:absolute;top:105px;left:0;right:0;height:1px;background:#eee"></div>
            <div style="position:absolute;bottom:0;left:0;right:0;height:1px;background:#eee"></div>
            
            <!-- Preamp -->
            <div style="display:flex;flex-direction:column;align-items:center;z-index:1">
              <div style="width:6px;height:120px;background:linear-gradient(to bottom,#ddd,#bbb);border-radius:3px;position:relative">
                <div id="eq_preamp" style="position:absolute;width:14px;height:14px;background:linear-gradient(145deg,#fff,#e0e0e0);border:1px solid #aaa;border-radius:50%;left:50%;transform:translateX(-50%);top:50%;box-shadow:0 1px 3px rgba(0,0,0,0.2)">
                  <div style="width:6px;height:6px;background:#007aff;border-radius:50%;margin:3px auto"></div>
                </div>
              </div>
              <span style="font-size:0.5rem;color:#666;margin-top:4px">Preamp</span>
            </div>
            
            <!-- Frequency bands -->
            <div style="display:flex;flex-direction:column;align-items:center;z-index:1">
              <div style="width:6px;height:120px;background:linear-gradient(to bottom,#ddd,#bbb);border-radius:3px;position:relative">
                <div id="eq_32" style="position:absolute;width:14px;height:14px;background:linear-gradient(145deg,#fff,#e0e0e0);border:1px solid #aaa;border-radius:50%;left:50%;transform:translateX(-50%);box-shadow:0 1px 3px rgba(0,0,0,0.2)">
                  <div style="width:6px;height:6px;background:#007aff;border-radius:50%;margin:3px auto"></div>
                </div>
              </div>
              <span style="font-size:0.5rem;color:#666;margin-top:4px">32</span>
            </div>
            
            <div style="display:flex;flex-direction:column;align-items:center;z-index:1">
              <div style="width:6px;height:120px;background:linear-gradient(to bottom,#ddd,#bbb);border-radius:3px;position:relative">
                <div id="eq_64" style="position:absolute;width:14px;height:14px;background:linear-gradient(145deg,#fff,#e0e0e0);border:1px solid #aaa;border-radius:50%;left:50%;transform:translateX(-50%);box-shadow:0 1px 3px rgba(0,0,0,0.2)">
                  <div style="width:6px;height:6px;background:#007aff;border-radius:50%;margin:3px auto"></div>
                </div>
              </div>
              <span style="font-size:0.5rem;color:#666;margin-top:4px">64</span>
            </div>
            
            <div style="display:flex;flex-direction:column;align-items:center;z-index:1">
              <div style="width:6px;height:120px;background:linear-gradient(to bottom,#ddd,#bbb);border-radius:3px;position:relative">
                <div id="eq_125" style="position:absolute;width:14px;height:14px;background:linear-gradient(145deg,#fff,#e0e0e0);border:1px solid #aaa;border-radius:50%;left:50%;transform:translateX(-50%);box-shadow:0 1px 3px rgba(0,0,0,0.2)">
                  <div style="width:6px;height:6px;background:#007aff;border-radius:50%;margin:3px auto"></div>
                </div>
              </div>
              <span style="font-size:0.5rem;color:#666;margin-top:4px">125</span>
            </div>
            
            <div style="display:flex;flex-direction:column;align-items:center;z-index:1">
              <div style="width:6px;height:120px;background:linear-gradient(to bottom,#ddd,#bbb);border-radius:3px;position:relative">
                <div id="eq_250" style="position:absolute;width:14px;height:14px;background:linear-gradient(145deg,#fff,#e0e0e0);border:1px solid #aaa;border-radius:50%;left:50%;transform:translateX(-50%);box-shadow:0 1px 3px rgba(0,0,0,0.2)">
                  <div style="width:6px;height:6px;background:#007aff;border-radius:50%;margin:3px auto"></div>
                </div>
              </div>
              <span style="font-size:0.5rem;color:#666;margin-top:4px">250</span>
            </div>
            
            <div style="display:flex;flex-direction:column;align-items:center;z-index:1">
              <div style="width:6px;height:120px;background:linear-gradient(to bottom,#ddd,#bbb);border-radius:3px;position:relative">
                <div id="eq_500" style="position:absolute;width:14px;height:14px;background:linear-gradient(145deg,#fff,#e0e0e0);border:1px solid #aaa;border-radius:50%;left:50%;transform:translateX(-50%);box-shadow:0 1px 3px rgba(0,0,0,0.2)">
                  <div style="width:6px;height:6px;background:#007aff;border-radius:50%;margin:3px auto"></div>
                </div>
              </div>
              <span style="font-size:0.5rem;color:#666;margin-top:4px">500</span>
            </div>
            
            <div style="display:flex;flex-direction:column;align-items:center;z-index:1">
              <div style="width:6px;height:120px;background:linear-gradient(to bottom,#ddd,#bbb);border-radius:3px;position:relative">
                <div id="eq_1k" style="position:absolute;width:14px;height:14px;background:linear-gradient(145deg,#fff,#e0e0e0);border:1px solid #aaa;border-radius:50%;left:50%;transform:translateX(-50%);box-shadow:0 1px 3px rgba(0,0,0,0.2)">
                  <div style="width:6px;height:6px;background:#007aff;border-radius:50%;margin:3px auto"></div>
                </div>
              </div>
              <span style="font-size:0.5rem;color:#666;margin-top:4px">1K</span>
            </div>
            
            <div style="display:flex;flex-direction:column;align-items:center;z-index:1">
              <div style="width:6px;height:120px;background:linear-gradient(to bottom,#ddd,#bbb);border-radius:3px;position:relative">
                <div id="eq_2k" style="position:absolute;width:14px;height:14px;background:linear-gradient(145deg,#fff,#e0e0e0);border:1px solid #aaa;border-radius:50%;left:50%;transform:translateX(-50%);box-shadow:0 1px 3px rgba(0,0,0,0.2)">
                  <div style="width:6px;height:6px;background:#007aff;border-radius:50%;margin:3px auto"></div>
                </div>
              </div>
              <span style="font-size:0.5rem;color:#666;margin-top:4px">2K</span>
            </div>
            
            <div style="display:flex;flex-direction:column;align-items:center;z-index:1">
              <div style="width:6px;height:120px;background:linear-gradient(to bottom,#ddd,#bbb);border-radius:3px;position:relative">
                <div id="eq_4k" style="position:absolute;width:14px;height:14px;background:linear-gradient(145deg,#fff,#e0e0e0);border:1px solid #aaa;border-radius:50%;left:50%;transform:translateX(-50%);box-shadow:0 1px 3px rgba(0,0,0,0.2)">
                  <div style="width:6px;height:6px;background:#007aff;border-radius:50%;margin:3px auto"></div>
                </div>
              </div>
              <span style="font-size:0.5rem;color:#666;margin-top:4px">4K</span>
            </div>
            
            <div style="display:flex;flex-direction:column;align-items:center;z-index:1">
              <div style="width:6px;height:120px;background:linear-gradient(to bottom,#ddd,#bbb);border-radius:3px;position:relative">
                <div id="eq_8k" style="position:absolute;width:14px;height:14px;background:linear-gradient(145deg,#fff,#e0e0e0);border:1px solid #aaa;border-radius:50%;left:50%;transform:translateX(-50%);box-shadow:0 1px 3px rgba(0,0,0,0.2)">
                  <div style="width:6px;height:6px;background:#007aff;border-radius:50%;margin:3px auto"></div>
                </div>
              </div>
              <span style="font-size:0.5rem;color:#666;margin-top:4px">8K</span>
            </div>
            
            <div style="display:flex;flex-direction:column;align-items:center;z-index:1">
              <div style="width:6px;height:120px;background:linear-gradient(to bottom,#ddd,#bbb);border-radius:3px;position:relative">
                <div id="eq_16k" style="position:absolute;width:14px;height:14px;background:linear-gradient(145deg,#fff,#e0e0e0);border:1px solid #aaa;border-radius:50%;left:50%;transform:translateX(-50%);box-shadow:0 1px 3px rgba(0,0,0,0.2)">
                  <div style="width:6px;height:6px;background:#007aff;border-radius:50%;margin:3px auto"></div>
                </div>
              </div>
              <span style="font-size:0.5rem;color:#666;margin-top:4px">16K</span>
            </div>
          </div>
        </div>
        
        <!-- EQ Values Display -->
        <div id="phoneEQValues" style="display:grid;grid-template-columns:repeat(11,1fr);gap:2px;margin-top:8px;font-size:0.55rem;text-align:center;color:#666">
          <div id="val_preamp">0</div>
          <div id="val_32">0</div>
          <div id="val_64">0</div>
          <div id="val_125">0</div>
          <div id="val_250">0</div>
          <div id="val_500">0</div>
          <div id="val_1k">0</div>
          <div id="val_2k">0</div>
          <div id="val_4k">0</div>
          <div id="val_8k">0</div>
          <div id="val_16k">0</div>
        </div>
        
        <div style="margin-top:12px;padding:10px;background:#fff;border-radius:8px;border:1px solid #ddd">
          <div style="font-size:0.7rem;font-weight:700;color:#333;margin-bottom:6px">ğŸ“‹ CÃ¡ch chá»‰nh trÃªn Ä‘iá»‡n thoáº¡i:</div>
          <div style="font-size:0.65rem;color:#666;line-height:1.6">
            <b>iPhone:</b> Settings â†’ Music â†’ EQ â†’ chá»n preset hoáº·c dÃ¹ng app EQ<br>
            <b>Android:</b> Settings â†’ Sound â†’ Equalizer hoáº·c trong app nháº¡c<br>
            <b>Spotify:</b> Settings â†’ Playback â†’ Equalizer<br>
            <b>YouTube Music:</b> Settings â†’ Equalizer
          </div>
        </div>
      </div>
    </div>

    <div class="mode-sel">
      <button class="mode-btn active" data-m="vocal"><span>ğŸ¤</span><span>Vocal</span></button>
      <button class="mode-btn" data-m="guitar"><span>ğŸ¸</span><span>Guitar</span></button>
      <button class="mode-btn" data-m="full"><span>ğŸµ</span><span>Full Mix</span></button>
    </div>
    <div class="mode-sel" style="margin-top:-8px">
      <button class="mode-btn" data-m="broadcast"><span>ğŸ“»</span><span>Broadcast</span></button>
      <button class="mode-btn" data-m="live"><span>ğŸª</span><span>Live</span></button>
      <button class="mode-btn" data-m="custom" id="customModeBtn" style="border-color:var(--purple)"><span>â­</span><span>Cá»§a tÃ´i</span></button>
    </div>
    
    <div id="learnPanel" style="background:linear-gradient(135deg,rgba(168,85,247,0.15),rgba(0,200,255,0.1));border:1px solid var(--purple);border-radius:12px;padding:14px;margin-bottom:16px">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
        <span style="font-size:1.3rem">ğŸ“</span>
        <div>
          <div style="font-size:0.9rem;font-weight:700;color:var(--purple)">Cháº¿ Ä‘á»™ Há»ŒC (Learn)</div>
          <div style="font-size:0.7rem;color:var(--text2)">Khi Ã¢m thanh HAY â†’ LÆ°u lÃ m chuáº©n cá»§a báº¡n</div>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <button onclick="app.learnFromCurrent()" style="padding:12px;background:var(--purple);border:none;border-radius:8px;color:#fff;font-weight:700;font-size:0.75rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px">
          <span>ğŸ’¾</span> LÆ°u lÃ m CHUáº¨N
        </button>
        <button onclick="app.resetToDefault()" style="padding:12px;background:var(--card2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.75rem;cursor:pointer">
          ğŸ”„ Reset vá» máº·c Ä‘á»‹nh
        </button>
      </div>
      <div id="customInfo" style="margin-top:10px;padding:10px;background:var(--card);border-radius:8px;font-size:0.7rem;display:none">
        <div style="color:var(--green);font-weight:700;margin-bottom:4px">âœ… ÄÃ£ cÃ³ chuáº©n cá»§a báº¡n!</div>
        <div id="customDetails" style="color:var(--text2)"></div>
      </div>
    </div>
    
    <button class="start-btn" id="startBtn"><span id="startIcon">ğŸ™ï¸</span><span id="startText">Báº®T Äáº¦U PHÃ‚N TÃCH</span></button>
    
    <div class="status">
      <div><span class="status-dot" id="dot"></span><span id="sts">Chá» káº¿t ná»‘i</span></div>
      <div>ğŸ”Š <span id="db">--dB</span></div>
      <div>â±ï¸ <span id="dur">0s</span></div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <div class="card-icon">ğŸ“ˆ</div>
        <div><div class="card-title">Phá»• Táº§n Sá»‘ Real-time</div><div class="card-sub">Frequency Spectrum</div></div>
      </div>
      <div class="spectrum"><canvas id="canvas"></canvas></div>
      <div class="bands">
        <div class="band"><div class="band-meter"><div class="band-fill" id="fBass"></div><div class="band-target" id="tBass"></div></div><div class="band-name">BASS</div><div class="band-val" id="vBass">0%</div><div class="band-sts ok" id="sBass">OK</div></div>
        <div class="band"><div class="band-meter"><div class="band-fill" id="fLowMid"></div><div class="band-target" id="tLowMid"></div></div><div class="band-name">LOW-MID</div><div class="band-val" id="vLowMid">0%</div><div class="band-sts ok" id="sLowMid">OK</div></div>
        <div class="band"><div class="band-meter"><div class="band-fill" id="fMid"></div><div class="band-target" id="tMid"></div></div><div class="band-name">MID</div><div class="band-val" id="vMid">0%</div><div class="band-sts ok" id="sMid">OK</div></div>
        <div class="band"><div class="band-meter"><div class="band-fill" id="fHighMid"></div><div class="band-target" id="tHighMid"></div></div><div class="band-name">HI-MID</div><div class="band-val" id="vHighMid">0%</div><div class="band-sts ok" id="sHighMid">OK</div></div>
        <div class="band"><div class="band-meter"><div class="band-fill" id="fHigh"></div><div class="band-target" id="tHigh"></div></div><div class="band-name">HIGH</div><div class="band-val" id="vHigh">0%</div><div class="band-sts ok" id="sHigh">OK</div></div>
      </div>
    </div>
    
    <div class="results" id="results">
      <div class="score-card">
        <div class="score-ring">
          <svg viewBox="0 0 130 130"><circle class="score-bg" cx="65" cy="65" r="60"/><circle class="score-prog" id="scoreRing" cx="65" cy="65" r="60"/></svg>
          <div class="score-inner"><div class="score-num" id="scoreNum">0</div><div class="score-lbl">ÄIá»‚M</div></div>
        </div>
        <div class="score-msg" id="scoreMsg">Äang phÃ¢n tÃ­ch...</div>
        <div class="score-hint" id="scoreHint">Vui lÃ²ng chá»</div>
      </div>
      
      <!-- FULL 8-KNOB RECOMMENDATION PANEL -->
      <div class="card" style="border:2px solid var(--accent)">
        <div class="card-header"><div class="card-icon" style="background:var(--accent)">ğŸ›ï¸</div><div><div class="card-title">Gá»£i Ã Äáº¦Y Äá»¦ 8 NÃºm</div><div class="card-sub">Táº¥t cáº£ nÃºm cáº§n chá»‰nh cho kÃªnh nÃ y</div></div></div>
        
        <div id="fullMixerRec" style="display:grid;gap:8px">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
      
      <!-- PHONE EQ RECOMMENDATION PANEL -->
      <div class="card" style="border:2px solid var(--purple);background:linear-gradient(135deg,rgba(168,85,247,0.1),transparent)">
        <div class="card-header">
          <div class="card-icon" style="background:var(--purple)">ğŸ“±</div>
          <div>
            <div class="card-title">Chá»‰nh EQ Äiá»‡n Thoáº¡i</div>
            <div class="card-sub">Copy sang app nghe nháº¡c trÃªn ÄT</div>
          </div>
        </div>
        
        <!-- Phone EQ Visual -->
        <div id="resultPhoneEQ" style="background:linear-gradient(145deg,#f5f5f5,#e8e8e8);border-radius:12px;padding:14px">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
            <div style="display:flex;align-items:center;gap:6px">
              <div style="width:12px;height:12px;background:#4cd964;border-radius:3px"></div>
              <span style="font-size:0.75rem;font-weight:700;color:#333" id="resultEQName">Custom EQ</span>
            </div>
            <span style="font-size:0.6rem;color:#666">Dá»±a trÃªn phÃ¢n tÃ­ch</span>
          </div>
          
          <!-- Mini EQ Sliders -->
          <div style="background:#fff;border-radius:8px;padding:10px;border:1px solid #ddd">
            <div style="display:flex;justify-content:space-between;align-items:flex-end;height:80px;position:relative">
              <!-- Grid line at 0dB -->
              <div style="position:absolute;top:40px;left:0;right:0;height:1px;background:#ddd"></div>
              
              <div style="display:flex;flex-direction:column;align-items:center;flex:1">
                <div style="width:4px;height:70px;background:#e0e0e0;border-radius:2px;position:relative">
                  <div id="req_32" style="position:absolute;width:10px;height:10px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.45rem;color:#666;margin-top:2px">32</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1">
                <div style="width:4px;height:70px;background:#e0e0e0;border-radius:2px;position:relative">
                  <div id="req_64" style="position:absolute;width:10px;height:10px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.45rem;color:#666;margin-top:2px">64</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1">
                <div style="width:4px;height:70px;background:#e0e0e0;border-radius:2px;position:relative">
                  <div id="req_125" style="position:absolute;width:10px;height:10px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.45rem;color:#666;margin-top:2px">125</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1">
                <div style="width:4px;height:70px;background:#e0e0e0;border-radius:2px;position:relative">
                  <div id="req_250" style="position:absolute;width:10px;height:10px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.45rem;color:#666;margin-top:2px">250</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1">
                <div style="width:4px;height:70px;background:#e0e0e0;border-radius:2px;position:relative">
                  <div id="req_500" style="position:absolute;width:10px;height:10px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.45rem;color:#666;margin-top:2px">500</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1">
                <div style="width:4px;height:70px;background:#e0e0e0;border-radius:2px;position:relative">
                  <div id="req_1k" style="position:absolute;width:10px;height:10px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.45rem;color:#666;margin-top:2px">1K</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1">
                <div style="width:4px;height:70px;background:#e0e0e0;border-radius:2px;position:relative">
                  <div id="req_2k" style="position:absolute;width:10px;height:10px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.45rem;color:#666;margin-top:2px">2K</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1">
                <div style="width:4px;height:70px;background:#e0e0e0;border-radius:2px;position:relative">
                  <div id="req_4k" style="position:absolute;width:10px;height:10px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.45rem;color:#666;margin-top:2px">4K</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1">
                <div style="width:4px;height:70px;background:#e0e0e0;border-radius:2px;position:relative">
                  <div id="req_8k" style="position:absolute;width:10px;height:10px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.45rem;color:#666;margin-top:2px">8K</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1">
                <div style="width:4px;height:70px;background:#e0e0e0;border-radius:2px;position:relative">
                  <div id="req_16k" style="position:absolute;width:10px;height:10px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.45rem;color:#666;margin-top:2px">16K</span>
              </div>
            </div>
          </div>
          
          <!-- EQ Values -->
          <div id="resultEQValues" style="display:grid;grid-template-columns:repeat(10,1fr);gap:2px;margin-top:6px;font-size:0.55rem;text-align:center;font-weight:700">
            <div id="rval_32" style="color:#007aff">0</div>
            <div id="rval_64" style="color:#007aff">0</div>
            <div id="rval_125" style="color:#007aff">0</div>
            <div id="rval_250" style="color:#007aff">0</div>
            <div id="rval_500" style="color:#007aff">0</div>
            <div id="rval_1k" style="color:#007aff">0</div>
            <div id="rval_2k" style="color:#007aff">0</div>
            <div id="rval_4k" style="color:#007aff">0</div>
            <div id="rval_8k" style="color:#007aff">0</div>
            <div id="rval_16k" style="color:#007aff">0</div>
          </div>
        </div>
        
        <!-- Quick Reference Card - Compact -->
        <div style="margin-top:12px;background:var(--card2);border-radius:10px;padding:12px">
          <div style="font-size:0.75rem;font-weight:700;color:var(--accent);margin-bottom:8px">ğŸ¯ CÃ´ng thá»©c nhanh:</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;font-size:0.6rem">
            <div style="background:var(--bg);padding:6px;border-radius:6px">ğŸ¤ <b>RÃµ giá»ng:</b> â†“250Hz â†‘2-4kHz</div>
            <div style="background:var(--bg);padding:6px;border-radius:6px">ğŸ”Š <b>Bass:</b> â†‘64Hz â†“250Hz</div>
            <div style="background:var(--bg);padding:6px;border-radius:6px">âœ¨ <b>SÃ¡ng:</b> â†‘4-8kHz â†‘16kHz</div>
            <div style="background:var(--bg);padding:6px;border-radius:6px">ğŸŒ™ <b>ÃŠm:</b> â†“64Hz â†“8kHz</div>
          </div>
        </div>
        
        <!-- EQ GUIDE - Collapsible -->
        <details style="margin-top:12px">
          <summary style="background:var(--purple);color:#fff;padding:10px 12px;border-radius:8px;font-size:0.75rem;font-weight:700;cursor:pointer;list-style:none;display:flex;align-items:center;gap:8px">
            <span>ğŸ“š</span> Xem giáº£i thÃ­ch chi tiáº¿t tá»«ng band EQ <span style="margin-left:auto;font-size:0.6rem">â–¼</span>
          </summary>
          <div style="background:var(--card);border-radius:0 0 8px 8px;border:1px solid var(--purple);border-top:none">
            <div style="padding:10px 12px;border-bottom:1px solid var(--border)">
              <div style="display:flex;align-items:center;gap:6px;margin-bottom:4px">
                <span style="background:#ff3b30;color:#fff;padding:2px 6px;border-radius:4px;font-size:0.55rem;font-weight:700">32Hz</span>
                <span style="font-size:0.7rem;font-weight:700">Sub Bass</span>
              </div>
              <div style="font-size:0.6rem;color:var(--text2)">SiÃªu tráº§m, rung. Chá»‰ tÄƒng náº¿u cÃ³ loa sub/tai nghe bass tá»‘t.</div>
            </div>
            <div style="padding:10px 12px;border-bottom:1px solid var(--border)">
              <div style="display:flex;align-items:center;gap:6px;margin-bottom:4px">
                <span style="background:#ff9500;color:#fff;padding:2px 6px;border-radius:4px;font-size:0.55rem;font-weight:700">64Hz</span>
                <span style="font-size:0.7rem;font-weight:700">Bass</span>
              </div>
              <div style="font-size:0.6rem;color:var(--text2)">Tráº§m "bÃ¹m bÃ¹m". Hip-hop, EDM cáº§n nhiá»u.</div>
            </div>
            <div style="padding:10px 12px;border-bottom:1px solid var(--border)">
              <div style="display:flex;align-items:center;gap:6px;margin-bottom:4px">
                <span style="background:#ffcc00;color:#000;padding:2px 6px;border-radius:4px;font-size:0.55rem;font-weight:700">125-250Hz</span>
                <span style="font-size:0.7rem;font-weight:700;color:var(--red)">âš ï¸ VÃ¹ng "bÃ¹n"</span>
              </div>
              <div style="font-size:0.6rem;color:var(--text2)"><b style="color:var(--red)">THÆ¯á»œNG NÃŠN GIáº¢M!</b> GÃ¢y Ä‘á»¥c giá»ng nháº¥t.</div>
            </div>
            <div style="padding:10px 12px;border-bottom:1px solid var(--border)">
              <div style="display:flex;align-items:center;gap:6px;margin-bottom:4px">
                <span style="background:#34c759;color:#fff;padding:2px 6px;border-radius:4px;font-size:0.55rem;font-weight:700">500Hz-1kHz</span>
                <span style="font-size:0.7rem;font-weight:700">Mid</span>
              </div>
              <div style="font-size:0.6rem;color:var(--text2)">Pháº§n chÃ­nh giá»ng hÃ¡t. Karaoke nÃªn tÄƒng.</div>
            </div>
            <div style="padding:10px 12px;border-bottom:1px solid var(--border)">
              <div style="display:flex;align-items:center;gap:6px;margin-bottom:4px">
                <span style="background:#007aff;color:#fff;padding:2px 6px;border-radius:4px;font-size:0.55rem;font-weight:700">2-4kHz</span>
                <span style="font-size:0.7rem;font-weight:700;color:var(--green)">â­ Presence</span>
              </div>
              <div style="font-size:0.6rem;color:var(--text2)"><b style="color:var(--green)">QUAN TRá»ŒNG NHáº¤T!</b> TÄƒng Ä‘á»ƒ nghe rÃµ tá»«ng chá»¯.</div>
            </div>
            <div style="padding:10px 12px;border-bottom:1px solid var(--border)">
              <div style="display:flex;align-items:center;gap:6px;margin-bottom:4px">
                <span style="background:#5856d6;color:#fff;padding:2px 6px;border-radius:4px;font-size:0.55rem;font-weight:700">8kHz</span>
                <span style="font-size:0.7rem;font-weight:700">Treble</span>
              </div>
              <div style="font-size:0.6rem;color:var(--text2)">SÃ¡ng, láº¥p lÃ¡nh. NgÆ°á»i lá»›n tuá»•i cÃ³ thá»ƒ tÄƒng.</div>
            </div>
            <div style="padding:10px 12px">
              <div style="display:flex;align-items:center;gap:6px;margin-bottom:4px">
                <span style="background:#af52de;color:#fff;padding:2px 6px;border-radius:4px;font-size:0.55rem;font-weight:700">16kHz</span>
                <span style="font-size:0.7rem;font-weight:700">Air</span>
              </div>
              <div style="font-size:0.6rem;color:var(--text2)">SiÃªu cao, thoÃ¡ng. Tai nghe ráº» khÃ´ng tÃ¡i táº¡o Ä‘Æ°á»£c.</div>
            </div>
          </div>
        </details>
        
        <!-- Quick tips -->
        <div style="margin-top:12px;padding:10px;background:var(--card2);border-radius:8px">
          <div style="font-size:0.7rem;font-weight:700;color:var(--purple);margin-bottom:6px">ğŸ“‹ Chá»‰nh EQ trÃªn Ä‘iá»‡n thoáº¡i:</div>
          <div style="font-size:0.6rem;color:var(--text2);line-height:1.5">
            ğŸ <b>iPhone:</b> Settings â†’ Music â†’ EQ | 
            ğŸ¤– <b>Android:</b> Settings â†’ Sound â†’ EQ<br>
            ğŸµ <b>Spotify:</b> Settings â†’ Playback â†’ EQ | 
            â–¶ï¸ <b>YouTube:</b> Settings â†’ EQ
          </div>
        </div>
        
        <!-- Suggested preset -->
        <div id="suggestedPreset" style="margin-top:10px;padding:10px;background:var(--bg);border-radius:8px;border-left:3px solid var(--green)">
          <div style="font-size:0.7rem;font-weight:700;color:var(--green);margin-bottom:4px">ğŸ’¡ Preset gá»£i Ã½:</div>
          <div id="suggestedPresetName" style="font-size:0.8rem;font-weight:700;color:var(--text)">--</div>
          <div id="suggestedPresetDesc" style="font-size:0.65rem;color:var(--text2);margin-top:4px">--</div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header"><div class="card-icon">ğŸ”</div><div><div class="card-title">Váº¥n Äá» & CÃ¡ch Sá»­a</div><div class="card-sub">Chi tiáº¿t váº·n nÃºm</div></div></div>
        <div id="probList"></div>
      </div>
    </div>
  </section>
  
  <section class="section" id="s-compare">
    <div class="card">
      <div class="card-header"><div class="card-icon">âš–ï¸</div><div><div class="card-title">So SÃ¡nh TRÆ¯á»šC / SAU</div><div class="card-sub">Xem hiá»‡u quáº£ chá»‰nh mixer</div></div></div>
      
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">
        <div style="background:var(--card2);border-radius:12px;padding:14px;text-align:center;border:2px solid var(--border)" id="compareLeft">
          <div style="font-size:0.7rem;color:var(--text3);margin-bottom:8px">TRÆ¯á»šC KHI CHá»ˆNH</div>
          <div style="font-size:2.5rem;font-weight:700;color:var(--text3)" id="scoreBefore">--</div>
          <div style="font-size:0.65rem;color:var(--text3)">Ä‘iá»ƒm</div>
          <button style="margin-top:12px;width:100%;padding:10px;background:var(--accent);border:none;border-radius:8px;color:#000;font-weight:700;font-size:0.75rem;cursor:pointer" onclick="app.saveCompare('before')">ğŸ“Œ LÆ°u káº¿t quáº£ TRÆ¯á»šC</button>
        </div>
        <div style="background:var(--card2);border-radius:12px;padding:14px;text-align:center;border:2px solid var(--border)" id="compareRight">
          <div style="font-size:0.7rem;color:var(--text3);margin-bottom:8px">SAU KHI CHá»ˆNH</div>
          <div style="font-size:2.5rem;font-weight:700;color:var(--text3)" id="scoreAfter">--</div>
          <div style="font-size:0.65rem;color:var(--text3)">Ä‘iá»ƒm</div>
          <button style="margin-top:12px;width:100%;padding:10px;background:var(--green);border:none;border-radius:8px;color:#000;font-weight:700;font-size:0.75rem;cursor:pointer" onclick="app.saveCompare('after')">ğŸ“Œ LÆ°u káº¿t quáº£ SAU</button>
        </div>
      </div>
      
      <div style="background:var(--card2);border-radius:12px;padding:16px;text-align:center;margin-bottom:16px" id="compareResult">
        <div style="font-size:0.8rem;color:var(--text3);margin-bottom:8px">Káº¾T QUáº¢ Cáº¢I THIá»†N</div>
        <div style="font-size:2rem;font-weight:700" id="compareChange">ChÆ°a cÃ³ dá»¯ liá»‡u</div>
        <div style="font-size:0.75rem;color:var(--text2);margin-top:8px" id="compareMsg">PhÃ¢n tÃ­ch â†’ LÆ°u TRÆ¯á»šC â†’ Chá»‰nh mixer â†’ PhÃ¢n tÃ­ch láº¡i â†’ LÆ°u SAU</div>
      </div>
      
      <div id="compareBands" style="display:none">
        <div style="font-size:0.8rem;font-weight:700;margin-bottom:12px">ğŸ“Š Chi tiáº¿t tá»«ng band:</div>
        <div id="compareBandsList"></div>
      </div>
      
      <button style="width:100%;padding:12px;background:var(--card2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.8rem;cursor:pointer;margin-top:12px" onclick="app.resetCompare()">ğŸ”„ Reset so sÃ¡nh</button>
    </div>
    
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ’¡</div><div><div class="card-title">CÃ¡ch sá»­ dá»¥ng</div><div class="card-sub">Quy trÃ¬nh so sÃ¡nh</div></div></div>
      <div class="tip"><span class="tip-icon">1ï¸âƒ£</span><div><div class="tip-title">PhÃ¢n tÃ­ch láº§n 1</div><div class="tip-text">Quay láº¡i tab PhÃ¢n TÃ­ch, thu Ã¢m 15-20 giÃ¢y vá»›i setting hiá»‡n táº¡i.</div></div></div>
      <div class="tip"><span class="tip-icon">2ï¸âƒ£</span><div><div class="tip-title">LÆ°u káº¿t quáº£ TRÆ¯á»šC</div><div class="tip-text">Nháº¥n nÃºt "LÆ°u káº¿t quáº£ TRÆ¯á»šC" Ä‘á»ƒ ghi nhá»› Ä‘iá»ƒm sá»‘ ban Ä‘áº§u.</div></div></div>
      <div class="tip"><span class="tip-icon">3ï¸âƒ£</span><div><div class="tip-title">Chá»‰nh mixer</div><div class="tip-text">VÃ o tab HÆ°á»›ng Dáº«n, lÃ m theo cÃ¡c bÆ°á»›c chá»‰nh mixer.</div></div></div>
      <div class="tip"><span class="tip-icon">4ï¸âƒ£</span><div><div class="tip-title">PhÃ¢n tÃ­ch láº§n 2</div><div class="tip-text">Quay láº¡i tab PhÃ¢n TÃ­ch, thu Ã¢m láº¡i vá»›i setting má»›i.</div></div></div>
      <div class="tip"><span class="tip-icon">5ï¸âƒ£</span><div><div class="tip-title">LÆ°u káº¿t quáº£ SAU</div><div class="tip-text">Nháº¥n "LÆ°u káº¿t quáº£ SAU" Ä‘á»ƒ xem má»©c cáº£i thiá»‡n!</div></div></div>
    </div>
  </section>
  
  <!-- HEADPHONE MODE SECTION -->
  <section class="section" id="s-headphone">
    <div class="card" style="border:2px solid var(--purple);background:linear-gradient(135deg,rgba(168,85,247,0.1),transparent)">
      <div class="card-header">
        <div class="card-icon" style="background:var(--purple)">ğŸ§</div>
        <div>
          <div class="card-title">Cháº¿ Äá»™ Tai Nghe</div>
          <div class="card-sub">Tá»± Ä‘Ã¡nh giÃ¡ â†’ Nháº­n Ä‘á» xuáº¥t EQ</div>
        </div>
      </div>
      
      <div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:16px">
        <div style="font-size:0.75rem;color:var(--text2);line-height:1.6">
          <b>ğŸ’¡ CÃ¡ch hoáº¡t Ä‘á»™ng:</b><br>
          Khi Ä‘eo tai nghe, mic khÃ´ng thu Ä‘Æ°á»£c Ã¢m. Thay vÃ o Ä‘Ã³, báº¡n <b>tá»± Ä‘Ã¡nh giÃ¡</b> Ã¢m thanh Ä‘ang nghe, 
          app sáº½ phÃ¢n tÃ­ch vÃ  Ä‘á» xuáº¥t cÃ¡ch chá»‰nh EQ phÃ¹ há»£p.
        </div>
      </div>
      
      <!-- Step 1: Choose what you're listening to -->
      <div style="background:var(--card2);border-radius:12px;padding:14px;margin-bottom:12px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
          <div style="width:28px;height:28px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#000;font-size:0.8rem">1</div>
          <div style="font-size:0.85rem;font-weight:700">Báº¡n Ä‘ang nghe gÃ¬?</div>
        </div>
        
        <!-- Basic content types -->
        <div style="font-size:0.7rem;color:var(--text3);margin-bottom:6px">ğŸ“± CÆ¡ báº£n</div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px">
          <button class="hp-type-btn" data-type="podcast" onclick="app.setHPType('podcast')" style="padding:12px 8px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
            <div style="font-size:1.5rem;margin-bottom:4px">ğŸ™ï¸</div>
            <div style="font-size:0.7rem;color:var(--text)">Podcast</div>
          </button>
          <button class="hp-type-btn" data-type="game" onclick="app.setHPType('game')" style="padding:12px 8px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
            <div style="font-size:1.5rem;margin-bottom:4px">ğŸ®</div>
            <div style="font-size:0.7rem;color:var(--text)">Game</div>
          </button>
          <button class="hp-type-btn" data-type="call" onclick="app.setHPType('call')" style="padding:12px 8px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
            <div style="font-size:1.5rem;margin-bottom:4px">ğŸ“</div>
            <div style="font-size:0.7rem;color:var(--text)">Gá»i Ä‘iá»‡n</div>
          </button>
          <button class="hp-type-btn" data-type="asmr" onclick="app.setHPType('asmr')" style="padding:12px 8px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
            <div style="font-size:1.5rem;margin-bottom:4px">ğŸ˜´</div>
            <div style="font-size:0.7rem;color:var(--text)">ASMR/Ngá»§</div>
          </button>
          <button class="hp-type-btn" data-type="audiobook" onclick="app.setHPType('audiobook')" style="padding:12px 8px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
            <div style="font-size:1.5rem;margin-bottom:4px">ğŸ“š</div>
            <div style="font-size:0.7rem;color:var(--text)">Audiobook</div>
          </button>
          <button class="hp-type-btn" data-type="meditation" onclick="app.setHPType('meditation')" style="padding:12px 8px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
            <div style="font-size:1.5rem;margin-bottom:4px">ğŸ§˜</div>
            <div style="font-size:0.7rem;color:var(--text)">Thiá»n</div>
          </button>
        </div>
        
        <!-- Vietnamese Music -->
        <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--border)">
          <div style="font-size:0.7rem;color:var(--text3);margin-bottom:8px">ğŸ‡»ğŸ‡³ Nháº¡c Viá»‡t</div>
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:8px">
            <button class="hp-type-btn" data-type="bolero" onclick="app.setHPType('bolero')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ»</div>
              <div style="font-size:0.55rem;color:var(--text)">Bolero</div>
            </button>
            <button class="hp-type-btn" data-type="vpop" onclick="app.setHPType('vpop')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ§</div>
              <div style="font-size:0.55rem;color:var(--text)">V-Pop</div>
            </button>
            <button class="hp-type-btn" data-type="vremix" onclick="app.setHPType('vremix')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ’ƒ</div>
              <div style="font-size:0.55rem;color:var(--text)">Remix</div>
            </button>
            <button class="hp-type-btn" data-type="trieudu" onclick="app.setHPType('trieudu')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ¤</div>
              <div style="font-size:0.55rem;color:var(--text)">Trá»¯ tÃ¬nh</div>
            </button>
          </div>
        </div>
        
        <!-- International Music -->
        <div style="margin-top:8px;padding-top:8px;border-top:1px solid var(--border)">
          <div style="font-size:0.7rem;color:var(--text3);margin-bottom:8px">ğŸŒ Nháº¡c Quá»‘c Táº¿</div>
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:8px">
            <button class="hp-type-btn" data-type="pop" onclick="app.setHPType('pop')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸµ</div>
              <div style="font-size:0.55rem;color:var(--text)">Pop</div>
            </button>
            <button class="hp-type-btn" data-type="rock" onclick="app.setHPType('rock')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ¸</div>
              <div style="font-size:0.55rem;color:var(--text)">Rock</div>
            </button>
            <button class="hp-type-btn" data-type="hiphop" onclick="app.setHPType('hiphop')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ¤</div>
              <div style="font-size:0.55rem;color:var(--text)">Hip-hop</div>
            </button>
            <button class="hp-type-btn" data-type="rnb" onclick="app.setHPType('rnb')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ·</div>
              <div style="font-size:0.55rem;color:var(--text)">R&B</div>
            </button>
            <button class="hp-type-btn" data-type="edm" onclick="app.setHPType('edm')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ¹</div>
              <div style="font-size:0.55rem;color:var(--text)">EDM</div>
            </button>
            <button class="hp-type-btn" data-type="jazz" onclick="app.setHPType('jazz')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸº</div>
              <div style="font-size:0.55rem;color:var(--text)">Jazz</div>
            </button>
            <button class="hp-type-btn" data-type="classical" onclick="app.setHPType('classical')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ¼</div>
              <div style="font-size:0.55rem;color:var(--text)">Classical</div>
            </button>
            <button class="hp-type-btn" data-type="country" onclick="app.setHPType('country')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ¤ </div>
              <div style="font-size:0.55rem;color:var(--text)">Country</div>
            </button>
          </div>
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px">
            <button class="hp-type-btn" data-type="kpop" onclick="app.setHPType('kpop')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ‡°ğŸ‡·</div>
              <div style="font-size:0.55rem;color:var(--text)">K-Pop</div>
            </button>
            <button class="hp-type-btn" data-type="jpop" onclick="app.setHPType('jpop')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ‡¯ğŸ‡µ</div>
              <div style="font-size:0.55rem;color:var(--text)">J-Pop</div>
            </button>
            <button class="hp-type-btn" data-type="cpop" onclick="app.setHPType('cpop')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ‡¨ğŸ‡³</div>
              <div style="font-size:0.55rem;color:var(--text)">C-Pop</div>
            </button>
            <button class="hp-type-btn" data-type="latin" onclick="app.setHPType('latin')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ’ƒ</div>
              <div style="font-size:0.55rem;color:var(--text)">Latin</div>
            </button>
          </div>
        </div>
        
        <!-- Acoustic / Special -->
        <div style="margin-top:8px;padding-top:8px;border-top:1px solid var(--border)">
          <div style="font-size:0.7rem;color:var(--text3);margin-bottom:8px">ğŸ¹ Acoustic / Äáº·c biá»‡t</div>
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px">
            <button class="hp-type-btn" data-type="acoustic" onclick="app.setHPType('acoustic')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸª•</div>
              <div style="font-size:0.55rem;color:var(--text)">Acoustic</div>
            </button>
            <button class="hp-type-btn" data-type="lofi" onclick="app.setHPType('lofi')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸŒ§ï¸</div>
              <div style="font-size:0.55rem;color:var(--text)">Lo-Fi</div>
            </button>
            <button class="hp-type-btn" data-type="instrumental" onclick="app.setHPType('instrumental')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ»</div>
              <div style="font-size:0.55rem;color:var(--text)">HÃ²a táº¥u</div>
            </button>
            <button class="hp-type-btn" data-type="metal" onclick="app.setHPType('metal')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ¤˜</div>
              <div style="font-size:0.55rem;color:var(--text)">Metal</div>
            </button>
          </div>
        </div>
        
        <!-- Cinema/Movie Types -->
        <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--border)">
          <div style="font-size:0.7rem;color:var(--text3);margin-bottom:8px">ğŸ¬ Phim / Cinema / Dolby</div>
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px">
            <button class="hp-type-btn" data-type="cinema" onclick="app.setHPType('cinema')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ¬</div>
              <div style="font-size:0.55rem;color:var(--text)">Ráº¡p chuáº©n</div>
            </button>
            <button class="hp-type-btn" data-type="dolby" onclick="app.setHPType('dolby')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ”Š</div>
              <div style="font-size:0.55rem;color:var(--text)">Atmos</div>
            </button>
            <button class="hp-type-btn" data-type="imax" onclick="app.setHPType('imax')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ¦</div>
              <div style="font-size:0.55rem;color:var(--text)">IMAX</div>
            </button>
            <button class="hp-type-btn" data-type="surround" onclick="app.setHPType('surround')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ§</div>
              <div style="font-size:0.55rem;color:var(--text)">7.1</div>
            </button>
            <button class="hp-type-btn" data-type="action" onclick="app.setHPType('action')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ’¥</div>
              <div style="font-size:0.55rem;color:var(--text)">Action</div>
            </button>
            <button class="hp-type-btn" data-type="horror" onclick="app.setHPType('horror')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸ‘»</div>
              <div style="font-size:0.55rem;color:var(--text)">Horror</div>
            </button>
            <button class="hp-type-btn" data-type="scifi" onclick="app.setHPType('scifi')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸš€</div>
              <div style="font-size:0.6rem;color:var(--text)">Sci-Fi</div>
            </button>
            <button class="hp-type-btn" data-type="latenight" onclick="app.setHPType('latenight')" style="padding:10px 6px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center">
              <div style="font-size:1.2rem;margin-bottom:2px">ğŸŒ™</div>
              <div style="font-size:0.6rem;color:var(--text)">ÄÃªm</div>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Step 2: Rate what you hear -->
      <div style="background:var(--card2);border-radius:12px;padding:14px;margin-bottom:12px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
          <div style="width:28px;height:28px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#000;font-size:0.8rem">2</div>
          <div style="font-size:0.85rem;font-weight:700">ÄÃ¡nh giÃ¡ Ã¢m thanh hiá»‡n táº¡i</div>
        </div>
        
        <!-- Bass Rating -->
        <div style="margin-bottom:16px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
            <span style="font-size:0.75rem;font-weight:700;color:var(--text)">ğŸ”Š Bass (Tráº§m)</span>
            <span id="hpBassLabel" style="font-size:0.7rem;color:var(--text3)">Vá»«a Ä‘á»§</span>
          </div>
          <input type="range" id="hpBass" min="-3" max="3" value="0" style="width:100%;accent-color:var(--purple)" oninput="app.updateHPSlider('bass',this.value)">
          <div style="display:flex;justify-content:space-between;font-size:0.6rem;color:var(--text3)">
            <span>Thiáº¿u bass</span>
            <span>QuÃ¡ nhiá»u</span>
          </div>
        </div>
        
        <!-- Mid Rating -->
        <div style="margin-bottom:16px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
            <span style="font-size:0.75rem;font-weight:700;color:var(--text)">ğŸ¤ Giá»ng/Mid (Trung)</span>
            <span id="hpMidLabel" style="font-size:0.7rem;color:var(--text3)">Vá»«a Ä‘á»§</span>
          </div>
          <input type="range" id="hpMid" min="-3" max="3" value="0" style="width:100%;accent-color:var(--purple)" oninput="app.updateHPSlider('mid',this.value)">
          <div style="display:flex;justify-content:space-between;font-size:0.6rem;color:var(--text3)">
            <span>Giá»ng chÃ¬m</span>
            <span>Giá»ng chÃ³i</span>
          </div>
        </div>
        
        <!-- Treble Rating -->
        <div style="margin-bottom:16px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
            <span style="font-size:0.75rem;font-weight:700;color:var(--text)">âœ¨ Treble (Cao)</span>
            <span id="hpTrebleLabel" style="font-size:0.7rem;color:var(--text3)">Vá»«a Ä‘á»§</span>
          </div>
          <input type="range" id="hpTreble" min="-3" max="3" value="0" style="width:100%;accent-color:var(--purple)" oninput="app.updateHPSlider('treble',this.value)">
          <div style="display:flex;justify-content:space-between;font-size:0.6rem;color:var(--text3)">
            <span>Tá»‘i, Ä‘á»¥c</span>
            <span>ChÃ³i, xÃ¨n</span>
          </div>
        </div>
        
        <!-- Clarity Rating -->
        <div style="margin-bottom:16px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
            <span style="font-size:0.75rem;font-weight:700;color:var(--text)">ğŸ” Äá»™ rÃµ rÃ ng</span>
            <span id="hpClarityLabel" style="font-size:0.7rem;color:var(--text3)">Vá»«a Ä‘á»§</span>
          </div>
          <input type="range" id="hpClarity" min="-3" max="3" value="0" style="width:100%;accent-color:var(--purple)" oninput="app.updateHPSlider('clarity',this.value)">
          <div style="display:flex;justify-content:space-between;font-size:0.6rem;color:var(--text3)">
            <span>Äá»¥c, bÃ¹n</span>
            <span>QuÃ¡ sáº¯c</span>
          </div>
        </div>
        
        <!-- Loudness Rating -->
        <div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
            <span style="font-size:0.75rem;font-weight:700;color:var(--text)">ğŸ”‰ Ã‚m lÆ°á»£ng cáº£m nháº­n</span>
            <span id="hpLoudLabel" style="font-size:0.7rem;color:var(--text3)">Vá»«a Ä‘á»§</span>
          </div>
          <input type="range" id="hpLoud" min="-3" max="3" value="0" style="width:100%;accent-color:var(--purple)" oninput="app.updateHPSlider('loud',this.value)">
          <div style="display:flex;justify-content:space-between;font-size:0.6rem;color:var(--text3)">
            <span>Nhá», yáº¿u</span>
            <span>To, máº¡nh</span>
          </div>
        </div>
      </div>
      
      <!-- AUTO ANALYZE SECTION -->
      <div style="background:linear-gradient(135deg,rgba(0,200,255,0.15),rgba(168,85,247,0.1));border:2px solid var(--accent);border-radius:12px;padding:14px;margin-bottom:12px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
          <div style="font-size:1.5rem">ğŸ™ï¸</div>
          <div>
            <div style="font-size:0.9rem;font-weight:700;color:var(--accent)">PhÃ¢n TÃ­ch Tá»± Äá»™ng</div>
            <div style="font-size:0.65rem;color:var(--text2)">PhÃ¡t nháº¡c/phim qua loa â†’ App phÃ¢n tÃ­ch â†’ Äá» xuáº¥t EQ cho tai nghe</div>
          </div>
        </div>
        
        <button class="start-btn" id="hpStartBtn" onclick="app.toggleHPAnalyze()" style="width:100%;margin-bottom:12px">
          <span id="hpStartIcon">ğŸ™ï¸</span>
          <span id="hpStartText">Báº®T Äáº¦U PHÃ‚N TÃCH</span>
        </button>
        
        <!-- Realtime spectrum for headphone -->
        <div style="background:var(--bg);border-radius:8px;padding:4px;margin-bottom:12px">
          <canvas id="hpCanvas" style="width:100%;height:80px;display:block"></canvas>
        </div>
        
        <!-- Status -->
        <div style="display:flex;justify-content:space-between;align-items:center;font-size:0.7rem;color:var(--text2)">
          <div><span class="status-dot" id="hpDot" style="background:var(--text3)"></span> <span id="hpStatus">Chá» báº¯t Ä‘áº§u</span></div>
          <div>â±ï¸ <span id="hpDur">0s</span></div>
          <div>ğŸ”Š <span id="hpDb">--dB</span></div>
        </div>
        
        <div style="margin-top:10px;padding:10px;background:var(--card);border-radius:8px;font-size:0.65rem;color:var(--text3);line-height:1.5">
          <b>ğŸ’¡ CÃ¡ch dÃ¹ng:</b><br>
          1. PhÃ¡t nháº¡c/phim qua <b>LOA NGOÃ€I</b> (khÃ´ng dÃ¹ng tai nghe)<br>
          2. Nháº¥n "Báº¯t Ä‘áº§u phÃ¢n tÃ­ch" - app sáº½ thu Ã¢m tá»« mic<br>
          3. Sau 10-15 giÃ¢y, nháº¥n "Dá»«ng" Ä‘á»ƒ xem káº¿t quáº£<br>
          4. Copy EQ sang Ä‘iá»‡n thoáº¡i, Ä‘eo tai nghe vÃ  nghe!
        </div>
      </div>
      
      <!-- OR divider -->
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
        <div style="flex:1;height:1px;background:var(--border)"></div>
        <div style="font-size:0.7rem;color:var(--text3);font-weight:700">HOáº¶C</div>
        <div style="flex:1;height:1px;background:var(--border)"></div>
      </div>
      
      <!-- Manual rating section header -->
      <div style="text-align:center;margin-bottom:12px">
        <div style="font-size:0.8rem;font-weight:700;color:var(--purple)">âœï¸ ÄÃ¡nh giÃ¡ thá»§ cÃ´ng</div>
        <div style="font-size:0.65rem;color:var(--text3)">Náº¿u Ä‘ang Ä‘eo tai nghe, tá»± Ä‘Ã¡nh giÃ¡ báº±ng slider á»Ÿ trÃªn</div>
      </div>
      
      <!-- Step 3: Get recommendation -->
      <button onclick="app.analyzeHeadphone()" style="width:100%;padding:14px;background:linear-gradient(135deg,var(--purple),var(--accent));border:none;border-radius:12px;color:#fff;font-weight:700;font-size:0.9rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px">
        <span style="font-size:1.2rem">ğŸ¯</span>
        <span>Äá»€ XUáº¤T EQ (tá»« Ä‘Ã¡nh giÃ¡ thá»§ cÃ´ng)</span>
      </button>
      
      <!-- Results -->
      <div id="hpResults" style="display:none">
        <div style="background:linear-gradient(135deg,rgba(0,232,120,0.15),transparent);border:2px solid var(--green);border-radius:12px;padding:14px;margin-bottom:12px">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
            <div style="font-size:1.5rem">ğŸ’¡</div>
            <div>
              <div style="font-size:0.9rem;font-weight:700;color:var(--green)">Äá» Xuáº¥t EQ Cho Báº¡n</div>
              <div id="hpRecName" style="font-size:0.75rem;color:var(--text2)">--</div>
            </div>
          </div>
          
          <!-- Visual EQ -->
          <div style="background:#fff;border-radius:10px;padding:12px;margin-bottom:12px">
            <div style="display:flex;justify-content:space-between;align-items:flex-end;height:100px;position:relative">
              <div style="position:absolute;top:50px;left:0;right:0;height:1px;background:#ddd"></div>
              
              <div style="display:flex;flex-direction:column;align-items:center;flex:1;z-index:1">
                <div style="width:6px;height:90px;background:#e8e8e8;border-radius:3px;position:relative">
                  <div id="hpeq_32" style="position:absolute;width:12px;height:12px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.5rem;color:#666;margin-top:2px">32</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1;z-index:1">
                <div style="width:6px;height:90px;background:#e8e8e8;border-radius:3px;position:relative">
                  <div id="hpeq_64" style="position:absolute;width:12px;height:12px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.5rem;color:#666;margin-top:2px">64</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1;z-index:1">
                <div style="width:6px;height:90px;background:#e8e8e8;border-radius:3px;position:relative">
                  <div id="hpeq_250" style="position:absolute;width:12px;height:12px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.5rem;color:#666;margin-top:2px">250</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1;z-index:1">
                <div style="width:6px;height:90px;background:#e8e8e8;border-radius:3px;position:relative">
                  <div id="hpeq_1k" style="position:absolute;width:12px;height:12px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.5rem;color:#666;margin-top:2px">1K</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1;z-index:1">
                <div style="width:6px;height:90px;background:#e8e8e8;border-radius:3px;position:relative">
                  <div id="hpeq_2k" style="position:absolute;width:12px;height:12px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.5rem;color:#666;margin-top:2px">2K</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1;z-index:1">
                <div style="width:6px;height:90px;background:#e8e8e8;border-radius:3px;position:relative">
                  <div id="hpeq_4k" style="position:absolute;width:12px;height:12px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.5rem;color:#666;margin-top:2px">4K</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1;z-index:1">
                <div style="width:6px;height:90px;background:#e8e8e8;border-radius:3px;position:relative">
                  <div id="hpeq_8k" style="position:absolute;width:12px;height:12px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.5rem;color:#666;margin-top:2px">8K</span>
              </div>
              <div style="display:flex;flex-direction:column;align-items:center;flex:1;z-index:1">
                <div style="width:6px;height:90px;background:#e8e8e8;border-radius:3px;position:relative">
                  <div id="hpeq_16k" style="position:absolute;width:12px;height:12px;background:#007aff;border-radius:50%;left:50%;transform:translateX(-50%);top:50%"></div>
                </div>
                <span style="font-size:0.5rem;color:#666;margin-top:2px">16K</span>
              </div>
            </div>
            
            <!-- EQ Values -->
            <div id="hpEQValues" style="display:grid;grid-template-columns:repeat(8,1fr);gap:2px;margin-top:6px;font-size:0.6rem;text-align:center;font-weight:700">
              <div id="hpval_32" style="color:#007aff">0</div>
              <div id="hpval_64" style="color:#007aff">0</div>
              <div id="hpval_250" style="color:#007aff">0</div>
              <div id="hpval_1k" style="color:#007aff">0</div>
              <div id="hpval_2k" style="color:#007aff">0</div>
              <div id="hpval_4k" style="color:#007aff">0</div>
              <div id="hpval_8k" style="color:#007aff">0</div>
              <div id="hpval_16k" style="color:#007aff">0</div>
            </div>
          </div>
          
          <!-- Explanation -->
          <div id="hpExplanation" style="font-size:0.7rem;color:var(--text2);line-height:1.6;padding:10px;background:var(--card);border-radius:8px">
            --
          </div>
        </div>
        
        <!-- Quick Actions -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <button onclick="app.copyHPEQ()" style="padding:12px;background:var(--card2);border:1px solid var(--border);border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;font-size:0.75rem;color:var(--text)">
            <span>ğŸ“‹</span> Copy EQ
          </button>
          <button onclick="app.resetHP()" style="padding:12px;background:var(--card2);border:1px solid var(--border);border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;font-size:0.75rem;color:var(--text)">
            <span>ğŸ”„</span> Reset
          </button>
        </div>
      </div>
    </div>
    
    <!-- Headphone Tips -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon">ğŸ’¡</div>
        <div>
          <div class="card-title">Máº¹o Nghe Tai Nghe</div>
          <div class="card-sub">Äá»ƒ cÃ³ tráº£i nghiá»‡m tá»‘t nháº¥t</div>
        </div>
      </div>
      
      <div class="tip">
        <span class="tip-icon">ğŸ”Š</span>
        <div>
          <div class="tip-title">Quy táº¯c 60/60</div>
          <div class="tip-text">Nghe á»Ÿ má»©c 60% volume, tá»‘i Ä‘a 60 phÃºt liÃªn tá»¥c Ä‘á»ƒ báº£o vá»‡ tai.</div>
        </div>
      </div>
      
      <div class="tip">
        <span class="tip-icon">ğŸ§</span>
        <div>
          <div class="tip-title">Burn-in tai nghe má»›i</div>
          <div class="tip-text">Tai nghe má»›i cáº§n cháº¡y 20-50 giá» Ä‘á»ƒ driver "chÃ­n", Ã¢m sáº½ mÆ°á»£t hÆ¡n.</div>
        </div>
      </div>
      
      <div class="tip">
        <span class="tip-icon">ğŸ§¹</span>
        <div>
          <div class="tip-title">Vá»‡ sinh thÆ°á»ng xuyÃªn</div>
          <div class="tip-text">Lau sáº¡ch ear tips má»—i tuáº§n. Bá»¥i báº©n lÃ m giáº£m cháº¥t lÆ°á»£ng Ã¢m thanh.</div>
        </div>
      </div>
      
      <div class="tip">
        <span class="tip-icon">ğŸ“±</span>
        <div>
          <div class="tip-title">Táº¯t Dolby/Surround áº£o</div>
          <div class="tip-text">CÃ¡c hiá»‡u á»©ng Ã¢m thanh áº£o thÆ°á»ng lÃ m mÃ©o Ã¢m. NÃªn táº¯t khi nghe nháº¡c.</div>
        </div>
      </div>
    </div>
  </section>

  <section class="section" id="s-feedback">
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ”Š</div><div><div class="card-title">PhÃ¡t Hiá»‡n Feedback</div><div class="card-sub">TÃ¬m táº§n sá»‘ dá»… bá»‹ hÃº</div></div></div>
      
      <button class="start-btn" id="feedbackBtn" onclick="app.toggleFeedback()">
        <span id="fbIcon">ğŸ¤</span>
        <span id="fbText">Báº®T Äáº¦U TÃŒM FEEDBACK</span>
      </button>
      
      <div style="background:var(--bg);border-radius:12px;padding:2px;margin-bottom:16px">
        <canvas id="fbCanvas" style="width:100%;height:120px;display:block"></canvas>
      </div>
      
      <div style="background:var(--card2);border-radius:12px;padding:14px;margin-bottom:16px">
        <div style="font-size:0.8rem;font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:8px">
          <span>âš ï¸</span> Táº¦N Sá» NGUY HIá»‚M (Dá»… hÃº)
        </div>
        <div id="feedbackList">
          <div style="text-align:center;color:var(--text3);padding:20px;font-size:0.8rem">
            Nháº¥n "Báº¯t Ä‘áº§u" vÃ  tÄƒng dáº§n volume Ä‘á»ƒ tÃ¬m Ä‘iá»ƒm feedback
          </div>
        </div>
      </div>
      
      <div id="feedbackTips" style="display:none">
        <div style="font-size:0.8rem;font-weight:700;margin-bottom:12px">ğŸ› ï¸ CÃ¡ch xá»­ lÃ½ Feedback:</div>
        <div id="feedbackSolutions"></div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ“š</div><div><div class="card-title">Kiáº¿n thá»©c vá» Feedback</div><div class="card-sub">Hiá»ƒu Ä‘á»ƒ xá»­ lÃ½ tá»‘t hÆ¡n</div></div></div>
      <div class="tip"><span class="tip-icon">â“</span><div><div class="tip-title">Feedback lÃ  gÃ¬?</div><div class="tip-text">LÃ  hiá»‡n tÆ°á»£ng Ã¢m thanh tá»« loa quay láº¡i mic, táº¡o vÃ²ng láº·p vÃ  phÃ¡t ra tiáº¿ng hÃº chÃ³i tai. ThÆ°á»ng xáº£y ra á»Ÿ má»™t sá»‘ táº§n sá»‘ nháº¥t Ä‘á»‹nh.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ¯</span><div><div class="tip-title">Táº§n sá»‘ hay bá»‹ hÃº nháº¥t</div><div class="tip-text"><b>250-500Hz</b> (Ã¹ Ã¹), <b>1-2kHz</b> (hÃº tráº§m), <b>2.5-4kHz</b> (hÃº chÃ³i - phá»• biáº¿n nháº¥t!), <b>8kHz+</b> (rÃ­t tai)</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ”§</span><div><div class="tip-title">CÃ¡ch xá»­ lÃ½</div><div class="tip-text"><b>1.</b> Giáº£m volume tá»•ng. <b>2.</b> Di chuyá»ƒn mic xa loa hÆ¡n. <b>3.</b> Váº·n MID FREQ vá» táº§n sá»‘ hÃº vÃ  Cáº®T MID. <b>4.</b> Giáº£m FX/reverb.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ’¡</span><div><div class="tip-title">Máº¹o phÃ²ng trÃ¡nh</div><div class="tip-text">Äá»«ng Ä‘á»ƒ mic hÆ°á»›ng tháº³ng vÃ o loa. Sá»­ dá»¥ng mic cardioid (hÆ°á»›ng tÃ­nh). Giá»¯ khoáº£ng cÃ¡ch mic-loa Ã­t nháº¥t 2-3m.</div></div></div>
    </div>
  </section>
  
  <section class="section" id="s-guide">
    <!-- FULL MIXER KNOB GUIDE -->
    <div class="card" style="border:1px solid var(--accent)">
      <div class="card-header"><div class="card-icon" style="background:var(--accent)">ğŸ“–</div><div><div class="card-title">Táº¤T Cáº¢ NÃºm TrÃªn Mixer EFX8</div><div class="card-sub">Hiá»ƒu rÃµ tá»«ng nÃºm Ä‘á»ƒ chá»‰nh hiá»‡u quáº£</div></div></div>
      
      <!-- GAIN Section -->
      <div style="background:linear-gradient(135deg,rgba(255,56,96,0.1),transparent);border:1px solid var(--red);border-radius:12px;padding:14px;margin-bottom:12px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
          <div style="width:40px;height:40px;background:var(--red);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff">1</div>
          <div>
            <div style="font-size:0.95rem;font-weight:700;color:var(--red)">GAIN (Äá»™ nháº¡y Ä‘áº§u vÃ o)</div>
            <div style="font-size:0.65rem;color:var(--text3)">NÃºm trÃªn cÃ¹ng - QUAN TRá»ŒNG NHáº¤T!</div>
          </div>
        </div>
        <div style="font-size:0.75rem;color:var(--text2);line-height:1.6">
          <b>ğŸ¯ Chá»©c nÄƒng:</b> Äiá»u chá»‰nh Ä‘á»™ nháº¡y thu Ã¢m tá»« mic/line. Quyáº¿t Ä‘á»‹nh cháº¥t lÆ°á»£ng tÃ­n hiá»‡u.<br>
          <b>âš¡ CÃ¡ch chá»‰nh:</b><br>
          â€¢ Vá»«a hÃ¡t/Ä‘Ã n vá»«a nhÃ¬n Ä‘Ã¨n LED bÃ¡o má»©c (náº¿u cÃ³)<br>
          â€¢ ÄÃ¨n <span style="color:var(--green)">XANH</span> nháº¥p nhÃ¡y = Tá»T<br>
          â€¢ ÄÃ¨n <span style="color:var(--red)">Äá»</span> sÃ¡ng liÃªn tá»¥c = QUÃ TO â†’ Váº·n TRÃI<br>
          â€¢ KhÃ´ng cÃ³ Ä‘Ã¨n nhÃ¡y = QUÃ NHá» â†’ Váº·n PHáº¢I<br>
          <b>ğŸ’¡ Máº¹o:</b> Äá»ƒ GAIN á»Ÿ má»©c Ä‘Ã¨n xanh nhÃ¡y máº¡nh nhÆ°ng khÃ´ng cháº¡m Ä‘á». ThÆ°á»ng á»Ÿ vá»‹ trÃ­ 10-2 giá».
        </div>
      </div>
      
      <!-- HPF Section -->
      <div style="background:linear-gradient(135deg,rgba(0,200,255,0.1),transparent);border:1px solid var(--accent);border-radius:12px;padding:14px;margin-bottom:12px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
          <div style="width:40px;height:40px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#000">2</div>
          <div>
            <div style="font-size:0.95rem;font-weight:700;color:var(--accent)">HPF / LOW CUT (NÃºt báº¥m)</div>
            <div style="font-size:0.65rem;color:var(--text3)">High Pass Filter - Cáº¯t bass thá»«a</div>
          </div>
        </div>
        <div style="font-size:0.75rem;color:var(--text2);line-height:1.6">
          <b>ğŸ¯ Chá»©c nÄƒng:</b> Cáº¯t bá» táº§n sá»‘ dÆ°á»›i 80-100Hz (tiáº¿ng Ã¹, giÃ³, rung sÃ n).<br>
          <b>âš¡ Khi nÃ o Báº¬T (nháº¥n xuá»‘ng):</b><br>
          â€¢ ğŸ¤ Vocal - <span style="color:var(--green)">LUÃ”N Báº¬T</span><br>
          â€¢ ğŸ¸ Guitar acoustic - <span style="color:var(--green)">Báº¬T</span><br>
          â€¢ ğŸ¹ Keyboard/Synth - TÃ¹y (cÃ³ bass thÃ¬ Táº®T)<br>
          â€¢ ğŸ¥ Trá»‘ng/Bass guitar - <span style="color:var(--red)">Táº®T</span><br>
          <b>ğŸ’¡ Máº¹o:</b> 90% trÆ°á»ng há»£p hÃ¡t karaoke/live cafe nÃªn Báº¬T HPF cho vocal.
        </div>
      </div>
      
      <!-- EQ Section -->
      <div style="background:linear-gradient(135deg,rgba(0,232,120,0.1),transparent);border:1px solid var(--green);border-radius:12px;padding:14px;margin-bottom:12px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
          <div style="width:40px;height:40px;background:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#000">3</div>
          <div>
            <div style="font-size:0.95rem;font-weight:700;color:var(--green)">HI / MID / LO (EQ 3-band)</div>
            <div style="font-size:0.65rem;color:var(--text3)">Chá»‰nh mÃ u sáº¯c Ã¢m thanh</div>
          </div>
        </div>
        <div style="font-size:0.75rem;color:var(--text2);line-height:1.6">
          <div style="display:grid;gap:8px">
            <div style="background:var(--card2);padding:8px;border-radius:6px">
              <b style="color:var(--yellow)">ğŸ”¸ HI (Treble - 12kHz)</b><br>
              Váº·n PHáº¢I: SÃ¡ng, láº¥p lÃ¡nh, "air"<br>
              Váº·n TRÃI: Bá»›t xÃ¨n, bá»›t chÃ³i<br>
              <span style="color:var(--text3)">ThÆ°á»ng Ä‘á»ƒ 12h hoáº·c tÄƒng nháº¹ 1h</span>
            </div>
            <div style="background:var(--card2);padding:8px;border-radius:6px">
              <b style="color:var(--accent)">ğŸ”¹ MID (250Hz-6kHz sweep)</b><br>
              QUAN TRá»ŒNG NHáº¤T cho vocal!<br>
              Káº¿t há»£p vá»›i MID FREQ Ä‘á»ƒ chá»n táº§n sá»‘<br>
              <span style="color:var(--text3)">ThÆ°á»ng Cáº®T vÃ¹ng 300-500Hz, TÄ‚NG vÃ¹ng 2-4kHz</span>
            </div>
            <div style="background:var(--card2);padding:8px;border-radius:6px">
              <b style="color:var(--red)">ğŸ”» LO (Bass - 80Hz)</b><br>
              Váº·n PHáº¢I: DÃ y, áº¥m, náº·ng<br>
              Váº·n TRÃI: Má»ng, rÃµ, nháº¹<br>
              <span style="color:var(--text3)">Vocal nÃªn Ä‘á»ƒ 11h. Guitar 12h.</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- MID FREQ Section -->
      <div style="background:linear-gradient(135deg,rgba(168,85,247,0.1),transparent);border:1px solid var(--purple);border-radius:12px;padding:14px;margin-bottom:12px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
          <div style="width:40px;height:40px;background:var(--purple);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff">4</div>
          <div>
            <div style="font-size:0.95rem;font-weight:700;color:var(--purple)">MID FREQ (Sweep EQ)</div>
            <div style="font-size:0.65rem;color:var(--text3)">Chá»n táº§n sá»‘ cho nÃºm MID - Ráº¤T Máº NH!</div>
          </div>
        </div>
        <div style="font-size:0.75rem;color:var(--text2);line-height:1.6">
          <b>ğŸ¯ Chá»©c nÄƒng:</b> Chá»n táº§n sá»‘ trung tÃ¢m mÃ  nÃºm MID sáº½ tÃ¡c Ä‘á»™ng.<br>
          <b>âš¡ CÃ¡c vá»‹ trÃ­ phá»• biáº¿n:</b><br>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin:8px 0">
            <div style="background:var(--card2);padding:6px;border-radius:4px;text-align:center">
              <div style="font-weight:700;color:var(--red)">300-500Hz</div>
              <div style="font-size:0.65rem">VÃ¹ng "bÃ¹n" - Cáº®T!</div>
            </div>
            <div style="background:var(--card2);padding:6px;border-radius:4px;text-align:center">
              <div style="font-weight:700;color:var(--yellow)">800Hz-1kHz</div>
              <div style="font-size:0.65rem">ThÃ¢n giá»ng</div>
            </div>
            <div style="background:var(--card2);padding:6px;border-radius:4px;text-align:center">
              <div style="font-weight:700;color:var(--green)">2-4kHz</div>
              <div style="font-size:0.65rem">Presence - TÄ‚NG!</div>
            </div>
            <div style="background:var(--card2);padding:6px;border-radius:4px;text-align:center">
              <div style="font-weight:700;color:var(--accent)">5-6kHz</div>
              <div style="font-size:0.65rem">Sibilance (xÃ¬ xÃ¬)</div>
            </div>
          </div>
          <b>ğŸ’¡ CÃ´ng thá»©c vÃ ng:</b> MID FREQ vá» 400Hz + MID váº·n TRÃI = Giá»ng háº¿t Ä‘á»¥c!
        </div>
      </div>
      
      <!-- AUX Section -->
      <div style="background:linear-gradient(135deg,rgba(255,196,0,0.1),transparent);border:1px solid var(--yellow);border-radius:12px;padding:14px;margin-bottom:12px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
          <div style="width:40px;height:40px;background:var(--yellow);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#000">5</div>
          <div>
            <div style="font-size:0.95rem;font-weight:700;color:var(--yellow)">AUX 1 / AUX 2</div>
            <div style="font-size:0.65rem;color:var(--text3)">Gá»­i tÃ­n hiá»‡u ra loa monitor/thiáº¿t bá»‹ ngoÃ i</div>
          </div>
        </div>
        <div style="font-size:0.75rem;color:var(--text2);line-height:1.6">
          <b>ğŸ¯ Chá»©c nÄƒng:</b> Gá»­i Ã¢m thanh riÃªng ra loa kiá»ƒm Ã¢m (monitor) cho ca sÄ© nghe.<br>
          <b>âš¡ CÃ¡ch dÃ¹ng:</b><br>
          â€¢ AUX 1 thÆ°á»ng ná»‘i loa monitor sÃ¢n kháº¥u<br>
          â€¢ AUX 2 cÃ³ thá»ƒ ná»‘i thiáº¿t bá»‹ ghi Ã¢m<br>
          <b>ğŸ’¡ Máº¹o:</b> Ca sÄ© cáº§n nghe rÃµ giá»ng mÃ¬nh â†’ TÄƒng AUX cho kÃªnh vocal á»Ÿ monitor.
        </div>
      </div>
      
      <!-- FX Section -->
      <div style="background:linear-gradient(135deg,rgba(168,85,247,0.1),transparent);border:1px solid var(--purple);border-radius:12px;padding:14px;margin-bottom:12px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
          <div style="width:40px;height:40px;background:var(--purple);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff">6</div>
          <div>
            <div style="font-size:0.95rem;font-weight:700;color:var(--purple)">FX (Effects Send)</div>
            <div style="font-size:0.65rem;color:var(--text3)">Gá»­i tÃ­n hiá»‡u vÃ o bá»™ Reverb/Delay</div>
          </div>
        </div>
        <div style="font-size:0.75rem;color:var(--text2);line-height:1.6">
          <b>ğŸ¯ Chá»©c nÄƒng:</b> Äiá»u chá»‰nh lÆ°á»£ng reverb/echo cho tá»«ng kÃªnh.<br>
          <b>âš¡ Gá»£i Ã½ má»©c FX:</b><br>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin:8px 0">
            <div style="background:var(--card2);padding:6px;border-radius:4px">
              <div style="font-weight:700">ğŸ¤ Vocal</div>
              <div style="font-size:0.65rem;color:var(--green)">20-35% (10-11h)</div>
            </div>
            <div style="background:var(--card2);padding:6px;border-radius:4px">
              <div style="font-weight:700">ğŸ¸ Guitar</div>
              <div style="font-size:0.65rem;color:var(--accent)">10-20% (9-10h)</div>
            </div>
            <div style="background:var(--card2);padding:6px;border-radius:4px">
              <div style="font-weight:700">ğŸ¥ Drums</div>
              <div style="font-size:0.65rem;color:var(--yellow)">5-15% (8-10h)</div>
            </div>
            <div style="background:var(--card2);padding:6px;border-radius:4px">
              <div style="font-weight:700">ğŸ¹ Keys</div>
              <div style="font-size:0.65rem;color:var(--purple)">15-25% (10-11h)</div>
            </div>
          </div>
          <b style="color:var(--red)">âš ï¸ QUÃ NHIá»€U FX = Giá»ng bá»‹ chÃ¬m, khÃ´ng rÃµ chá»¯!</b>
        </div>
      </div>
      
      <!-- PAN Section -->
      <div style="background:var(--card2);border-radius:12px;padding:14px;margin-bottom:12px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
          <div style="width:40px;height:40px;background:var(--text3);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#000">7</div>
          <div>
            <div style="font-size:0.95rem;font-weight:700">PAN (CÃ¢n báº±ng trÃ¡i/pháº£i)</div>
            <div style="font-size:0.65rem;color:var(--text3)">Äáº·t vá»‹ trÃ­ Ã¢m thanh trong stereo</div>
          </div>
        </div>
        <div style="font-size:0.75rem;color:var(--text2);line-height:1.6">
          <b>ğŸ¯ Chá»©c nÄƒng:</b> ÄÆ°a Ã¢m thanh sang loa trÃ¡i hoáº·c pháº£i.<br>
          <b>âš¡ Gá»£i Ã½:</b><br>
          â€¢ ğŸ¤ Vocal â†’ <b>GIá»®A</b> (12h)<br>
          â€¢ ğŸ¸ Guitar 1 â†’ TrÃ¡i nháº¹ (10-11h)<br>
          â€¢ ğŸ¸ Guitar 2 â†’ Pháº£i nháº¹ (1-2h)<br>
          â€¢ ğŸ¹ Keys â†’ TÃ¹y bÃ i, thÆ°á»ng giá»¯a<br>
          <b>ğŸ’¡ Máº¹o:</b> Live cafe mono thÃ¬ Ä‘á»ƒ háº¿t á»Ÿ giá»¯a.
        </div>
      </div>
      
      <!-- FADER Section -->
      <div style="background:linear-gradient(135deg,rgba(0,232,120,0.1),transparent);border:1px solid var(--green);border-radius:12px;padding:14px;margin-bottom:12px">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
          <div style="width:40px;height:40px;background:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#000">8</div>
          <div>
            <div style="font-size:0.95rem;font-weight:700;color:var(--green)">FADER / LEVEL (Thanh trÆ°á»£t)</div>
            <div style="font-size:0.65rem;color:var(--text3)">Ã‚m lÆ°á»£ng cuá»‘i cÃ¹ng cá»§a kÃªnh</div>
          </div>
        </div>
        <div style="font-size:0.75rem;color:var(--text2);line-height:1.6">
          <b>ğŸ¯ Chá»©c nÄƒng:</b> Äiá»u chá»‰nh Ã¢m lÆ°á»£ng kÃªnh ra loa chÃ­nh.<br>
          <b>âš¡ Vá»‹ trÃ­ chuáº©n:</b><br>
          â€¢ Váº¡ch <b>0dB</b> (Unity) = Má»©c chuáº©n<br>
          â€¢ DÆ°á»›i 0dB = Nhá» hÆ¡n<br>
          â€¢ TrÃªn 0dB = To hÆ¡n (cáº©n tháº­n mÃ©o)<br>
          <b>ğŸ’¡ Quy trÃ¬nh:</b> Chá»‰nh GAIN Ä‘Ãºng trÆ°á»›c â†’ Fader vá» 0dB â†’ Äiá»u chá»‰nh cÃ¢n báº±ng cÃ¡c kÃªnh.
        </div>
      </div>
      
      <!-- Summary -->
      <div style="background:var(--bg);border-radius:12px;padding:14px;border:2px solid var(--accent)">
        <div style="font-size:0.9rem;font-weight:700;color:var(--accent);margin-bottom:10px;text-align:center">ğŸ¯ THá»¨ Tá»° CHá»ˆNH MIXER CHUáº¨N</div>
        <div style="font-size:0.75rem;line-height:1.8">
          <span style="display:inline-block;width:24px;height:24px;background:var(--red);border-radius:50%;text-align:center;line-height:24px;color:#fff;font-weight:bold;margin-right:8px">1</span><b>GAIN</b> - Chá»‰nh Ä‘á»™ nháº¡y (Ä‘Ã¨n xanh nhÃ¡y)<br>
          <span style="display:inline-block;width:24px;height:24px;background:var(--accent);border-radius:50%;text-align:center;line-height:24px;color:#000;font-weight:bold;margin-right:8px">2</span><b>HPF</b> - Báº­t cho vocal/guitar<br>
          <span style="display:inline-block;width:24px;height:24px;background:var(--green);border-radius:50%;text-align:center;line-height:24px;color:#000;font-weight:bold;margin-right:8px">3</span><b>EQ</b> - Chá»‰nh HI/MID/LO theo phÃ¢n tÃ­ch<br>
          <span style="display:inline-block;width:24px;height:24px;background:var(--purple);border-radius:50%;text-align:center;line-height:24px;color:#fff;font-weight:bold;margin-right:8px">4</span><b>FX</b> - ThÃªm reverb vá»«a pháº£i<br>
          <span style="display:inline-block;width:24px;height:24px;background:var(--yellow);border-radius:50%;text-align:center;line-height:24px;color:#000;font-weight:bold;margin-right:8px">5</span><b>FADER</b> - CÃ¢n báº±ng Ã¢m lÆ°á»£ng cÃ¡c kÃªnh
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ•</div><div><div class="card-title">Quy Æ¯á»›c Vá»‹ TrÃ­ NÃºm</div><div class="card-sub">DÃ¹ng Ä‘á»“ng há»“ Ä‘á»ƒ dá»… hiá»ƒu</div></div></div>
      <div class="clock-ref">
        <div class="clock-item"><div class="clock-vis"><div class="clock-hand" style="transform:translateX(-50%) rotate(-90deg)"></div></div><div class="clock-val">9 giá»</div><div class="clock-lbl">Giáº£m max</div></div>
        <div class="clock-item"><div class="clock-vis"><div class="clock-hand" style="transform:translateX(-50%) rotate(-45deg)"></div></div><div class="clock-val">10-11h</div><div class="clock-lbl">Giáº£m nháº¹</div></div>
        <div class="clock-item"><div class="clock-vis"><div class="clock-hand" style="transform:translateX(-50%) rotate(0deg)"></div></div><div class="clock-val">12 giá»</div><div class="clock-lbl">Trung tÃ¢m</div></div>
        <div class="clock-item"><div class="clock-vis"><div class="clock-hand" style="transform:translateX(-50%) rotate(45deg)"></div></div><div class="clock-val">1-2 giá»</div><div class="clock-lbl">TÄƒng nháº¹</div></div>
        <div class="clock-item"><div class="clock-vis"><div class="clock-hand" style="transform:translateX(-50%) rotate(90deg)"></div></div><div class="clock-val">3 giá»</div><div class="clock-lbl">TÄƒng max</div></div>
      </div>
      <div style="padding:10px;background:var(--card2);border-radius:8px;font-size:0.75rem;color:var(--text2);line-height:1.8">
        <strong style="color:var(--accent)">ğŸ’¡ CÃCH Äá»ŒC Vá»Š TRÃ NÃšM:</strong><br>
        â€¢ <b>1/8 vÃ²ng</b> = 22.5Â° = tá»« 12h â†’ 1h (hoáº·c 12h â†’ 11h) - thay Ä‘á»•i NHáº¸<br>
        â€¢ <b>1/4 vÃ²ng</b> = 45Â° = tá»« 12h â†’ 3h (hoáº·c 12h â†’ 9h) - thay Ä‘á»•i Vá»ªA<br>
        â€¢ <b>3/8 vÃ²ng</b> = 67.5Â° = tá»« 12h gáº§n tá»›i 3h - thay Ä‘á»•i KHÃ NHIá»€U<br>
        â€¢ <b>1/2 vÃ²ng</b> = 90Â° = ná»­a vÃ²ng trÃ²n - thay Ä‘á»•i Tá»I ÄA<br><br>
        <strong style="color:var(--yellow)">âš ï¸ QUY Táº®C VÃ€NG:</strong><br>
        â€¢ <b>Váº·n TRÃI</b> = GIáº¢M = cáº¯t bá»›t táº§n sá»‘ Ä‘Ã³<br>
        â€¢ <b>Váº·n PHáº¢I</b> = TÄ‚NG = thÃªm táº§n sá»‘ Ä‘Ã³<br>
        â€¢ <b>12 giá»</b> = Vá»‹ trÃ­ trung tÃ¢m = 0dB = khÃ´ng thay Ä‘á»•i
      </div>
    </div>
    
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ›ï¸</div><div><div class="card-title">Gá»£i Ã Chá»‰nh Mixer</div><div class="card-sub">Dá»±a trÃªn phÃ¢n tÃ­ch</div></div></div>
      <div class="mixer">
        <div class="mixer-label">â•â• SOUNDCRAFT EFX8 â•â•</div>
        <div class="channel">
          <div class="channel-head"><div class="channel-name"><span>ğŸ¤</span>KÃŠNH VOCAL</div><div class="channel-badge">CH 1-2</div></div>
          <div class="knobs">
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kVGain" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">GAIN</div><div class="knob-val" id="vVGain">0</div><div class="knob-turn" id="tVGain"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kVHi" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">HI</div><div class="knob-val" id="vVHi">0dB</div><div class="knob-turn" id="tVHi"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kVMid" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">MID</div><div class="knob-val" id="vVMid">0dB</div><div class="knob-turn" id="tVMid"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kVLo" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">LO</div><div class="knob-val" id="vVLo">0dB</div><div class="knob-turn" id="tVLo"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kVFx" style="transform:translateX(-50%) rotate(-45deg)"></div></div><div class="knob-name">FX</div><div class="knob-val" id="vVFx">25%</div><div class="knob-turn" id="tVFx">11h</div></div>
          </div>
          <div class="channel-freq"><span>MID FREQ:</span><span id="fqV">2.5kHz</span></div>
          <div style="margin-top:8px;padding:8px;background:rgba(255,196,0,0.1);border-radius:6px;font-size:0.7rem;color:var(--yellow)">ğŸ’¡ <b>HPF (nÃºt báº¥m):</b> Náº¿u cÃ³, Báº¬T lÃªn Ä‘á»ƒ cáº¯t bass dÆ°á»›i 80Hz!</div>
        </div>
        <div class="channel">
          <div class="channel-head"><div class="channel-name"><span>ğŸ¸</span>KÃŠNH GUITAR</div><div class="channel-badge">CH 3-4</div></div>
          <div class="knobs">
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kGGain" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">GAIN</div><div class="knob-val" id="vGGain">0</div><div class="knob-turn" id="tGGain"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kGHi" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">HI</div><div class="knob-val" id="vGHi">0dB</div><div class="knob-turn" id="tGHi"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kGMid" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">MID</div><div class="knob-val" id="vGMid">0dB</div><div class="knob-turn" id="tGMid"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kGLo" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">LO</div><div class="knob-val" id="vGLo">0dB</div><div class="knob-turn" id="tGLo"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kGFx" style="transform:translateX(-50%) rotate(-60deg)"></div></div><div class="knob-name">FX</div><div class="knob-val" id="vGFx">15%</div><div class="knob-turn" id="tGFx">10h</div></div>
          </div>
          <div class="channel-freq"><span>MID FREQ:</span><span id="fqG">3kHz</span></div>
        </div>
        <div class="fx-panel">
          <div class="fx-head"><span>ğŸŒŠ</span>LEXICON FX (Reverb)</div>
          <div class="fx-grid">
            <div class="fx-item"><div class="fx-item-lbl">ChÆ°Æ¡ng trÃ¬nh</div><div class="fx-item-val" id="fxProg">Vocal Plate</div></div>
            <div class="fx-item"><div class="fx-item-lbl">FX Time (Decay)</div><div class="fx-item-val" id="fxTime">10 giá»</div></div>
            <div class="fx-item"><div class="fx-item-lbl">FX to Mix</div><div class="fx-item-val" id="fxMix">25%</div></div>
            <div class="fx-item"><div class="fx-item-lbl">Ghi chÃº</div><div class="fx-item-val" id="fxNote" style="font-size:0.65rem">Vang vá»«a</div></div>
          </div>
          <div style="margin-top:10px;padding:8px;background:var(--card);border-radius:6px;font-size:0.65rem;color:var(--text2);line-height:1.5">
            <b style="color:var(--purple)">ğŸ’¡ Chá»n Program:</b><br>
            â€¢ <b>Plate</b> - Vocal (ngáº¯n, áº¥m)<br>
            â€¢ <b>Hall</b> - PhÃ²ng lá»›n (dÃ i, rá»™ng)<br>
            â€¢ <b>Room</b> - PhÃ²ng nhá» (tá»± nhiÃªn)<br>
            <b style="color:var(--yellow)">âš ï¸ Ãt reverb = giá»ng RÃ• hÆ¡n!</b>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ“</div><div><div class="card-title">HÆ°á»›ng Dáº«n Tá»«ng BÆ°á»›c</div><div class="card-sub">LÃ m theo thá»© tá»±</div></div></div>
      <div class="steps" id="stepsBox"></div>
    </div>
  </section>
  
  <section class="section" id="s-detail">
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ“Š</div><div><div class="card-title">Báº£ng PhÃ¢n TÃ­ch Chi Tiáº¿t</div><div class="card-sub">Tá»«ng dáº£i táº§n</div></div></div>
      <table class="detail-tbl"><thead><tr><th>Táº§n sá»‘</th><th>Má»©c</th><th>Tráº¡ng thÃ¡i</th></tr></thead><tbody id="detailBody"></tbody></table>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ“š</div><div><div class="card-title">Giáº£i ThÃ­ch Táº§n Sá»‘</div><div class="card-sub">Hiá»ƒu Ä‘á»ƒ chá»‰nh tá»‘t</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ”´</span><div><div class="tip-title">Sub/Bass (20-150Hz) - Äá»™ dÃ y, Ä‘á»™ áº¥m</div><div class="tip-text"><b>QuÃ¡ nhiá»u = tiáº¿ng Ã¹ng á»¥c, náº·ng ná», Ä‘á»¥c.</b> Vá»›i vocal vÃ  guitar acoustic, LUÃ”N cáº¯t vÃ¹ng nÃ y báº±ng nÃºm LO. Chá»‰ cáº§n thiáº¿t cho bass guitar hoáº·c kick drum.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸŸ </span><div><div class="tip-title">Low-Mid (150-500Hz) - VÃ™NG "BÃ™N"!</div><div class="tip-text"><b>ÄÃ¢y lÃ  vÃ¹ng GÃ‚Y Äá»¤C nháº¥t - thÆ°á»ng pháº£i Cáº®T!</b> Váº·n MID FREQ vá» 400Hz rá»“i giáº£m MID. Cáº¯t vÃ¹ng nÃ y sáº½ lÃ m giá»ng/Ä‘Ã n trong hÆ¡n ngay láº­p tá»©c.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸŸ¢</span><div><div class="tip-title">Mid (500Hz-2kHz) - ThÃ¢n tiáº¿ng</div><div class="tip-text"><b>VÃ¹ng quan trá»ng cho vocal!</b> Chá»©a ngá»¯ Ã¢m, phá»¥ Ã¢m. Thiáº¿u = giá»ng má»ng, xa xÃ´i. Thá»«a = tiáº¿ng "há»™p", gÃ² bÃ³. TÄƒng nháº¹ Ä‘á»ƒ giá»ng dÃ y hÆ¡n.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ”µ</span><div><div class="tip-title">Hi-Mid (2-6kHz) - VÃ¹ng "PRESENCE"</div><div class="tip-text"><b>QUAN TRá»ŒNG: LÃ m giá»ng Cáº®T QUA mix!</b> TÄƒng vÃ¹ng nÃ y Ä‘á»ƒ giá»ng ná»•i báº­t, nghe rÃµ tá»«ng chá»¯. Váº·n MID FREQ vá» 2.5-4kHz vÃ  tÄƒng MID.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸŸ£</span><div><div class="tip-title">Treble/Air (6-20kHz) - Äá»™ sÃ¡ng</div><div class="tip-text">ThÃªm "sparkle", "air", Ä‘á»™ sÃ¡ng. <b>QuÃ¡ nhiá»u = chÃ³i tai, xÃ¨n xáº¹t.</b> TÄƒng vá»«a pháº£i báº±ng nÃºm HI Ä‘á»ƒ giá»ng/Ä‘Ã n sÃ¡ng hÆ¡n nhÆ°ng khÃ´ng chÃ³i.</div></div></div>
    </div>
  </section>
  
  <section class="section" id="s-history">
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ“</div><div><div class="card-title">Quy Chuáº©n ChuyÃªn Nghiá»‡p</div><div class="card-sub">Giáº£i thÃ­ch cÃ¡c tiÃªu chuáº©n</div></div></div>
      
      <div class="tip"><span class="tip-icon">ğŸ¤</span><div><div class="tip-title">Vocal Mode</div><div class="tip-text">Cáº¯t bass máº¡nh, tÄƒng presence (2-5kHz). Dá»±a trÃªn nguyÃªn táº¯c <b>vocal cutting through mix</b> - giá»ng hÃ¡t pháº£i ná»•i báº­t.</div></div></div>
      
      <div class="tip"><span class="tip-icon">ğŸ¸</span><div><div class="tip-title">Guitar Mode</div><div class="tip-text">Giá»¯ bass vá»«a pháº£i, tÄƒng hi-mid. Dá»±a trÃªn <b>acoustic guitar frequency response</b> chuáº©n 80Hz-12kHz.</div></div></div>
      
      <div class="tip"><span class="tip-icon">ğŸµ</span><div><div class="tip-title">Full Mix Mode</div><div class="tip-text">CÃ¢n báº±ng táº¥t cáº£ bands. Dá»±a trÃªn <b>Pink Noise Reference</b> - nÄƒng lÆ°á»£ng báº±ng nhau má»—i octave.</div></div></div>
      
      <div class="tip"><span class="tip-icon">ğŸ“»</span><div><div class="tip-title">Broadcast Mode</div><div class="tip-text">Chuáº©n <b>EBU R128 / -24 LUFS</b>. DÃ¹ng cho phÃ¡t thanh, podcast, YouTube. Ã‚m thanh rÃµ rÃ ng qua má»i thiáº¿t bá»‹.</div></div></div>
      
      <div class="tip"><span class="tip-icon">ğŸª</span><div><div class="tip-title">Live Mode</div><div class="tip-text">Cáº¯t low-mid máº¡nh Ä‘á»ƒ <b>chá»‘ng feedback</b>. TÄƒng tolerance vÃ¬ mÃ´i trÆ°á»ng live thay Ä‘á»•i liÃªn tá»¥c.</div></div></div>
      
      <div class="tip"><span class="tip-icon">â­</span><div><div class="tip-title">Cá»§a tÃ´i (Custom)</div><div class="tip-text">Chuáº©n do Báº N tá»± táº¡o. Khi nÃ o tháº¥y Ã¢m thanh HAY â†’ nháº¥n "LÆ°u lÃ m chuáº©n". <b>ChÃ­nh xÃ¡c nháº¥t cho setup cá»§a báº¡n!</b></div></div></div>
      
      <div style="margin-top:12px;padding:12px;background:var(--card2);border-radius:8px;font-size:0.7rem;color:var(--text2);line-height:1.6">
        <b style="color:var(--accent)">ğŸ“š Tham kháº£o tá»«:</b><br>
        â€¢ <b>Fletcher-Munson Curves</b> - Äá»™ nháº¡y tai ngÆ°á»i theo táº§n sá»‘<br>
        â€¢ <b>Pink Noise Reference</b> - NÄƒng lÆ°á»£ng báº±ng nhau/octave<br>
        â€¢ <b>Bob Katz K-System</b> - Chuáº©n mastering chuyÃªn nghiá»‡p<br>
        â€¢ <b>EBU R128</b> - Chuáº©n loudness chÃ¢u Ã‚u<br>
        â€¢ <b>ITU-R BS.1770</b> - Chuáº©n Ä‘o loudness quá»‘c táº¿
      </div>
    </div>
    
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ“‹</div><div><div class="card-title">Lá»‹ch Sá»­ PhÃ¢n TÃ­ch</div><div class="card-sub">So sÃ¡nh trÆ°á»›c/sau</div></div></div>
      <div id="histList"><div class="empty"><div class="empty-icon">ğŸ“Š</div><div>ChÆ°a cÃ³ lá»‹ch sá»­</div></div></div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ’¡</div><div><div class="card-title">Máº¹o Sá»­ Dá»¥ng</div><div class="card-sub">Äá»ƒ chÃ­nh xÃ¡c hÆ¡n</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ“±</span><div><div class="tip-title">Vá»‹ trÃ­ Ä‘iá»‡n thoáº¡i khi Ä‘o</div><div class="tip-text">Äáº·t Ä‘iá»‡n thoáº¡i cÃ¡ch loa <b>1-2 mÃ©t</b>, hÆ°á»›ng mic (thÆ°á»ng á»Ÿ dÆ°á»›i Ä‘iá»‡n thoáº¡i) vá» phÃ­a loa. KhÃ´ng Ä‘á»ƒ quÃ¡ gáº§n (bá»‹ mÃ©o) hoáº·c quÃ¡ xa (nhiá»…u phÃ²ng nhiá»u).</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ”‡</span><div><div class="tip-title">Giáº£m nhiá»…u mÃ´i trÆ°á»ng</div><div class="tip-text"><b>Táº®T quáº¡t, mÃ¡y láº¡nh, TV</b> khi phÃ¢n tÃ­ch. PhÃ²ng cÃ ng yÃªn tÄ©nh, káº¿t quáº£ cÃ ng chÃ­nh xÃ¡c. ÄÃ³ng cá»­a sá»• náº¿u ngoÃ i Ä‘Æ°á»ng á»“n.</div></div></div>
      <div class="tip"><span class="tip-icon">â±ï¸</span><div><div class="tip-title">Thá»i gian phÃ¢n tÃ­ch</div><div class="tip-text">Thu Ã­t nháº¥t <b>15-20 giÃ¢y</b>. HÃ¡t/Ä‘Ã¡nh Ä‘Ã n LIÃŠN Tá»¤C, Ä‘á»«ng ngáº¯t quÃ£ng. HÃ¡t á»Ÿ má»©c Ã¢m lÆ°á»£ng bÃ¬nh thÆ°á»ng khi biá»ƒu diá»…n.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ”„</span><div><div class="tip-title">NguyÃªn táº¯c chá»‰nh</div><div class="tip-text"><b>Chá»‰nh 1 nÃºm â†’ Nghe â†’ PhÃ¢n tÃ­ch láº¡i.</b> Äá»«ng váº·n nhiá»u nÃºm cÃ¹ng lÃºc! Má»—i láº§n chá»‰ thay Ä‘á»•i 1 thá»© Ä‘á»ƒ biáº¿t cÃ¡i nÃ o hiá»‡u quáº£.</div></div></div>
      <div class="tip"><span class="tip-icon">âœ‚ï¸</span><div><div class="tip-title">NguyÃªn táº¯c "Cáº¯t trÆ°á»›c TÄƒng"</div><div class="tip-text"><b>LuÃ´n Cáº®T táº§n sá»‘ thá»«a trÆ°á»›c, rá»“i má»›i TÄ‚NG táº§n sá»‘ thiáº¿u.</b> VÃ­ dá»¥: Cáº¯t bass trÆ°á»›c, rá»“i má»›i tÄƒng mid/treble sau. Cáº¯t khÃ´ng gÃ¢y mÃ©o, tÄƒng cÃ³ thá»ƒ gÃ¢y mÃ©o.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ‘‚</span><div><div class="tip-title">Tin vÃ o tai báº¡n!</div><div class="tip-text">App chá»‰ lÃ  cÃ´ng cá»¥ há»— trá»£. <b>Náº¿u tai báº¡n tháº¥y hay mÃ  Ä‘iá»ƒm tháº¥p = váº«n OK!</b> Má»¥c tiÃªu lÃ  Ã¢m thanh HAY, khÃ´ng pháº£i Ä‘iá»ƒm CAO.</div></div></div>
    </div>
  </section>
</div>

<script>
class App{
  constructor(){
    this.ctx=null;this.an=null;this.src=null;this.stream=null;this.data=null;this.running=false;
    this.canvas=document.getElementById('canvas');this.c=this.canvas.getContext('2d');
    this.mode='vocal';this.dur=0;this.timer=null;this.hist=JSON.parse(localStorage.getItem('ah')||'[]');
    this.bands={bass:{min:20,max:150,vals:[],avg:0},lowMid:{min:150,max:500,vals:[],avg:0},mid:{min:500,max:2000,vals:[],avg:0},highMid:{min:2000,max:6000,vals:[],avg:0},high:{min:6000,max:20000,vals:[],avg:0}};
    // Professional mixing targets based on:
    // - Pink noise reference (equal energy per octave)
    // - Fletcher-Munson equal loudness curves
    // - Industry mixing standards (broadcast -24 LUFS reference)
    // - Bob Katz K-System recommendations
    this.defaultTargets={
      vocal:{bass:18,lowMid:25,mid:52,highMid:55,high:35,tol:10,desc:'Giá»ng hÃ¡t rÃµ, cáº¯t qua mix'},
      guitar:{bass:28,lowMid:32,mid:45,highMid:52,high:40,tol:10,desc:'Guitar acoustic áº¥m, sÃ¡ng'},
      full:{bass:42,lowMid:38,mid:42,highMid:45,high:38,tol:12,desc:'Mix cÃ¢n báº±ng, tá»± nhiÃªn'},
      broadcast:{bass:35,lowMid:35,mid:45,highMid:48,high:40,tol:8,desc:'Chuáº©n phÃ¡t thanh -24 LUFS'},
      live:{bass:38,lowMid:30,mid:48,highMid:50,high:42,tol:15,desc:'Live performance, chá»‘ng feedback'}
    };
    
    // Genre-specific presets for Vietnamese and international music
    this.genrePresets={
      // Nháº¡c Viá»‡t
      bolero:{
        name:'ğŸ» Bolero / Trá»¯ tÃ¬nh',
        bass:25,lowMid:30,mid:55,highMid:50,high:32,tol:10,
        desc:'Giá»ng áº¥m, tráº§m láº¯ng. TÄƒng mid cho giá»ng rÃµ, bass vá»«a pháº£i táº¡o chiá»u sÃ¢u. Treble má»m máº¡i.',
        tips:'Reverb nháº¹, delay ngáº¯n. TrÃ¡nh bass quÃ¡ nhiá»u lÃ m Ä‘á»¥c giá»ng.',
        phoneEQ:{preamp:0,b32:2,b64:1,b125:0,b250:-1,b500:-2,b1k:3,b2k:4,b4k:3,b8k:1,b16k:0}
      },
      nhactre:{
        name:'ğŸ§ Nháº¡c tráº» / V-Pop',
        bass:35,lowMid:28,mid:50,highMid:58,high:45,tol:12,
        desc:'Hiá»‡n Ä‘áº¡i, sÃ¡ng, nÄƒng Ä‘á»™ng. Hi-mid ná»•i báº­t, treble sÃ¡ng, bass cÃ³ lá»±c.',
        tips:'Compression vá»«a pháº£i. CÃ³ thá»ƒ thÃªm exciter cho treble sÃ¡ng hÆ¡n.',
        phoneEQ:{preamp:0,b32:4,b64:3,b125:1,b250:0,b500:-1,b1k:2,b2k:4,b4k:5,b8k:4,b16k:3}
      },
      cachmang:{
        name:'ğŸº CÃ¡ch máº¡ng / Äá»',
        bass:30,lowMid:35,mid:52,highMid:48,high:35,tol:10,
        desc:'HÃ o hÃ¹ng, rÃµ rÃ ng. Mid-forward cho giá»ng vang, bass cháº¯c khá»e.',
        tips:'Reverb hall lá»›n cho cáº£m giÃ¡c hoÃ nh trÃ¡ng. Giá»ng cáº§n rÃµ tá»«ng chá»¯.',
        phoneEQ:{preamp:0,b32:2,b64:3,b125:2,b250:1,b500:0,b1k:3,b2k:4,b4k:3,b8k:2,b16k:1}
      },
      dancaromantic:{
        name:'ğŸ’ƒ Dance / Remix',
        bass:50,lowMid:32,mid:42,highMid:55,high:48,tol:15,
        desc:'Bass máº¡nh, treble sÃ¡ng, kick rÃµ. Nhá»‹p Ä‘iá»‡u sÃ´i Ä‘á»™ng.',
        tips:'Sidechain compression cho kick xuyÃªn qua mix. Sub bass quan trá»ng.',
        phoneEQ:{preamp:-2,b32:6,b64:5,b125:3,b250:0,b500:-2,b1k:0,b2k:3,b4k:5,b8k:4,b16k:3}
      },
      
      // Nháº¡c Quá»‘c Táº¿
      pop:{
        name:'ğŸµ Pop / Ballad',
        bass:30,lowMid:28,mid:52,highMid:55,high:42,tol:10,
        desc:'CÃ¢n báº±ng, dá»… nghe. Giá»ng hÃ¡t lÃ  trung tÃ¢m, nháº¡c ná»n há»— trá»£.',
        tips:'Vocal nÃªn náº±m trÃªn nháº¡c ná»n. Compression nháº¹ cho Ä‘á»u.',
        phoneEQ:{preamp:0,b32:2,b64:2,b125:1,b250:0,b500:0,b1k:2,b2k:3,b4k:3,b8k:2,b16k:1}
      },
      rock:{
        name:'ğŸ¸ Rock / Metal',
        bass:45,lowMid:35,mid:48,highMid:55,high:50,tol:15,
        desc:'Máº¡nh máº½, guitar Ä‘iá»‡n ná»•i báº­t. Bass vÃ  kick cháº¯c, treble sáº¯c.',
        tips:'Guitar cáº§n khÃ´ng gian riÃªng. Cáº©n tháº­n mud zone 200-400Hz.',
        phoneEQ:{preamp:-1,b32:5,b64:4,b125:2,b250:1,b500:-1,b1k:2,b2k:4,b4k:5,b8k:4,b16k:3}
      },
      rnb:{
        name:'ğŸ· R&B / Soul',
        bass:40,lowMid:35,mid:48,highMid:52,high:38,tol:10,
        desc:'áº¤m Ã¡p, groove. Bass sÃ¢u, mid má»m máº¡i, giá»ng silky.',
        tips:'Giá»ng cáº§n warmth. TrÃ¡nh treble quÃ¡ sÃ¡ng. Bass cáº§n tight.',
        phoneEQ:{preamp:0,b32:4,b64:5,b125:3,b250:2,b500:0,b1k:1,b2k:3,b4k:2,b8k:1,b16k:0}
      },
      edm:{
        name:'ğŸ¹ EDM / House',
        bass:55,lowMid:30,mid:40,highMid:52,high:50,tol:15,
        desc:'Sub bass máº¡nh, kick punchy, synth sÃ¡ng. Energy cao.',
        tips:'Sub bass lÃ  vua. Sidechain essential. Hi-hat vÃ  synth cáº§n sparkle.',
        phoneEQ:{preamp:-2,b32:7,b64:6,b125:4,b250:0,b500:-3,b1k:-1,b2k:2,b4k:5,b8k:5,b16k:4}
      },
      jazz:{
        name:'ğŸº Jazz / Blues',
        bass:35,lowMid:38,mid:45,highMid:48,high:35,tol:8,
        desc:'Tá»± nhiÃªn, acoustic. KhÃ´ng gian phÃ²ng thu quan trá»ng.',
        tips:'Ãt compression. Natural dynamics. Room reverb > plate/hall.',
        phoneEQ:{preamp:0,b32:3,b64:3,b125:2,b250:1,b500:0,b1k:1,b2k:2,b4k:2,b8k:1,b16k:0}
      },
      country:{
        name:'ğŸ¤  Country / Folk',
        bass:28,lowMid:32,mid:50,highMid:52,high:42,tol:10,
        desc:'Guitar acoustic ná»•i báº­t, giá»ng storytelling rÃµ rÃ ng.',
        tips:'Acoustic guitar cáº§n presence. Banjo/fiddle á»Ÿ hi-mid.',
        phoneEQ:{preamp:0,b32:2,b64:2,b125:1,b250:0,b500:0,b1k:2,b2k:4,b4k:4,b8k:3,b16k:2}
      },
      hiphop:{
        name:'ğŸ¤ Hip-hop / Rap',
        bass:52,lowMid:30,mid:45,highMid:55,high:42,tol:12,
        desc:'808 bass náº·ng, vocal rÃµ tá»«ng chá»¯, hi-hat crispy.',
        tips:'Rap vocal cáº§n ráº¥t rÃµ. 808 vÃ  kick khÃ´ng Ä‘Æ°á»£c clash. De-ess quan trá»ng.',
        phoneEQ:{preamp:-1,b32:6,b64:6,b125:3,b250:-1,b500:-2,b1k:1,b2k:4,b4k:4,b8k:3,b16k:2}
      },
      
      // Acoustic / Live
      acoustic:{
        name:'ğŸª• Acoustic',
        bass:25,lowMid:30,mid:48,highMid:50,high:40,tol:8,
        desc:'Tá»± nhiÃªn, trong tráº»o. Guitar gá»—, giá»ng má»™c.',
        tips:'Ãt effects. Natural reverb. Finger noise cÃ³ thá»ƒ giá»¯ láº¡i.',
        phoneEQ:{preamp:0,b32:1,b64:2,b125:1,b250:0,b500:0,b1k:2,b2k:3,b4k:3,b8k:2,b16k:1}
      },
      karaoke:{
        name:'ğŸ¤ Karaoke',
        bass:22,lowMid:28,mid:55,highMid:58,high:40,tol:12,
        desc:'Giá»ng hÃ¡t ná»•i báº­t tá»‘i Ä‘a, nháº¡c ná»n lÃ¹i. Reverb vá»«a pháº£i.',
        tips:'Reverb vÃ  delay cho giá»ng dÃ y. Nháº¡c beat nÃªn nhá» hÆ¡n vocal 6-10dB.',
        phoneEQ:{preamp:0,b32:1,b64:1,b125:0,b250:-1,b500:-2,b1k:3,b2k:5,b4k:5,b8k:3,b16k:2}
      },
      livecafe:{
        name:'â˜• Live Cafe / PhÃ²ng trÃ ',
        bass:28,lowMid:32,mid:50,highMid:48,high:35,tol:10,
        desc:'áº¤m cÃºng, intimate. Giá»ng gáº§n gÅ©i, khÃ´ng quÃ¡ loud.',
        tips:'Reverb room nhá». TrÃ¡nh feedback. Monitor volume vá»«a pháº£i.',
        phoneEQ:{preamp:0,b32:2,b64:2,b125:1,b250:1,b500:0,b1k:2,b2k:3,b4k:2,b8k:1,b16k:0}
      },
      wedding:{
        name:'ğŸ’’ Tiá»‡c cÆ°á»›i / Event',
        bass:35,lowMid:30,mid:48,highMid:52,high:42,tol:15,
        desc:'Äa dáº¡ng thá»ƒ loáº¡i, cáº§n linh hoáº¡t. RÃµ rÃ ng, khÃ´ng quÃ¡ bass.',
        tips:'MC vÃ  vocal quan trá»ng nháº¥t. Nháº¡c dance cáº§n bass. Nháº¡c cháº­m cáº§n warmth.',
        phoneEQ:{preamp:0,b32:3,b64:3,b125:2,b250:0,b500:-1,b1k:2,b2k:3,b4k:3,b8k:2,b16k:1}
      },
      church:{
        name:'â›ª NhÃ  thá» / ThÃ¡nh ca',
        bass:30,lowMid:35,mid:48,highMid:45,high:32,tol:10,
        desc:'Trang nghiÃªm, reverb tá»± nhiÃªn lá»›n. Choir blend tá»‘t.',
        tips:'Táº­n dá»¥ng reverb phÃ²ng. KhÃ´ng cáº§n thÃªm nhiá»u effects. Clarity quan trá»ng.',
        phoneEQ:{preamp:0,b32:2,b64:3,b125:2,b250:1,b500:0,b1k:2,b2k:2,b4k:2,b8k:1,b16k:0}
      },
      
      // PHONE EQ PRESETS - Nghe nháº¡c trÃªn Ä‘iá»‡n thoáº¡i
      phone_bass:{
        name:'ğŸ“± Bass Boost (Tai nghe)',
        bass:60,lowMid:35,mid:42,highMid:48,high:40,tol:15,
        desc:'TÄƒng bass cho tai nghe/loa Ä‘iá»‡n thoáº¡i nhá». Nghe EDM, Hip-hop, Dance.',
        tips:'DÃ¹ng khi tai nghe thiáº¿u bass. Giáº£m bá»›t náº¿u bá»‹ Ã¹.',
        phoneEQ:{preamp:-3,b32:8,b64:7,b125:5,b250:2,b500:0,b1k:0,b2k:1,b4k:2,b8k:2,b16k:1},
        isPhoneMode:true
      },
      phone_vocal:{
        name:'ğŸ“± Vocal Clear (Giá»ng rÃµ)',
        bass:20,lowMid:25,mid:58,highMid:60,high:45,tol:10,
        desc:'LÃ m rÃµ giá»ng hÃ¡t, nghe ballad, bolero, podcast rÃµ tá»«ng chá»¯.',
        tips:'Tá»‘t cho nháº¡c acoustic, podcast, audiobook.',
        phoneEQ:{preamp:0,b32:0,b64:0,b125:-1,b250:-2,b500:-1,b1k:4,b2k:5,b4k:5,b8k:3,b16k:2},
        isPhoneMode:true
      },
      phone_flat:{
        name:'ğŸ“± Flat (Chuáº©n pháº³ng)',
        bass:40,lowMid:40,mid:40,highMid:40,high:40,tol:5,
        desc:'Ã‚m thanh trung thá»±c, khÃ´ng chá»‰nh mÃ u. Nghe nhÆ° báº£n gá»‘c.',
        tips:'DÃ¹ng Ä‘á»ƒ kiá»ƒm tra cháº¥t lÆ°á»£ng báº£n mix hoáº·c tai nghe studio.',
        phoneEQ:{preamp:0,b32:0,b64:0,b125:0,b250:0,b500:0,b1k:0,b2k:0,b4k:0,b8k:0,b16k:0},
        isPhoneMode:true
      },
      phone_loudness:{
        name:'ğŸ“± Loudness (To rÃµ)',
        bass:50,lowMid:32,mid:45,highMid:55,high:52,tol:12,
        desc:'BÃ¹ táº§n sá»‘ khi nghe volume nhá». Theo Ä‘Æ°á»ng cong Fletcher-Munson.',
        tips:'DÃ¹ng khi nghe nháº¡c volume tháº¥p (Ä‘Ãªm khuya, nÆ¡i cÃ´ng cá»™ng).',
        phoneEQ:{preamp:-2,b32:5,b64:4,b125:2,b250:0,b500:-1,b1k:0,b2k:2,b4k:4,b8k:5,b16k:4},
        isPhoneMode:true
      },
      phone_treble:{
        name:'ğŸ“± Treble Boost (SÃ¡ng)',
        bass:30,lowMid:30,mid:45,highMid:55,high:60,tol:10,
        desc:'TÄƒng treble cho tai nghe bá»‹ tá»‘i, hoáº·c ngÆ°á»i lá»›n tuá»•i nghe rÃµ hÆ¡n.',
        tips:'Giáº£m náº¿u nghe chÃ³i tai. Tá»‘t cho classical, acoustic.',
        phoneEQ:{preamp:-1,b32:0,b64:0,b125:0,b250:0,b500:0,b1k:1,b2k:3,b4k:5,b8k:6,b16k:5},
        isPhoneMode:true
      },
      phone_night:{
        name:'ğŸ“± Night Mode (ÄÃªm)',
        bass:35,lowMid:35,mid:48,highMid:45,high:35,tol:10,
        desc:'Giáº£m bass vÃ  treble chÃ³i, nghe Ãªm tai ban Ä‘Ãªm.',
        tips:'Báº£o vá»‡ tai khi nghe lÃ¢u. Giáº£m má»‡t má»i.',
        phoneEQ:{preamp:-2,b32:1,b64:2,b125:1,b250:0,b500:0,b1k:1,b2k:2,b4k:1,b8k:0,b16k:-1},
        isPhoneMode:true
      },
      phone_small_speaker:{
        name:'ğŸ“± Small Speaker (Loa nhá»)',
        bass:55,lowMid:40,mid:48,highMid:52,high:45,tol:15,
        desc:'BÃ¹ bass cho loa Ä‘iá»‡n thoáº¡i/laptop nhá» khÃ´ng cÃ³ sub.',
        tips:'DÃ¹ng khi nghe báº±ng loa ngoÃ i Ä‘iá»‡n thoáº¡i, khÃ´ng dÃ¹ng tai nghe.',
        phoneEQ:{preamp:-2,b32:6,b64:5,b125:4,b250:2,b500:0,b1k:1,b2k:2,b4k:3,b8k:2,b16k:1},
        isPhoneMode:true
      },
      
      // CINEMA & DOLBY PRESETS
      cinema_standard:{
        name:'ğŸ¬ Cinema Standard (Ráº¡p chuáº©n)',
        bass:45,lowMid:35,mid:50,highMid:52,high:45,tol:12,
        desc:'Ã‚m thanh chuáº©n ráº¡p phim. Dialog rÃµ, bass rumble máº¡nh, surround immersive.',
        tips:'Táº¯t cÃ¡c hiá»‡u á»©ng Ã¢m thanh khÃ¡c trÃªn TV/Ä‘iá»‡n thoáº¡i. Äá»ƒ EQ nÃ y lÃ m viá»‡c.',
        phoneEQ:{preamp:-1,b32:5,b64:4,b125:2,b250:0,b500:-1,b1k:2,b2k:3,b4k:2,b8k:3,b16k:2},
        isPhoneMode:true,
        isCinema:true
      },
      dolby_atmos:{
        name:'ğŸ”Š Dolby Atmos (KhÃ´ng gian 3D)',
        bass:48,lowMid:32,mid:48,highMid:55,high:52,tol:12,
        desc:'Tá»‘i Æ°u cho Dolby Atmos. TÄƒng spatial cues, height channels, object-based audio.',
        tips:'Báº­t Dolby Atmos trong Settings náº¿u cÃ³. EQ nÃ y bá»• sung, khÃ´ng thay tháº¿ Atmos.',
        phoneEQ:{preamp:-2,b32:4,b64:4,b125:1,b250:-1,b500:-2,b1k:1,b2k:3,b4k:4,b8k:5,b16k:4},
        isPhoneMode:true,
        isCinema:true
      },
      dolby_atmos_music:{
        name:'ğŸµ Dolby Atmos Music',
        bass:42,lowMid:30,mid:50,highMid:55,high:50,tol:10,
        desc:'Dolby Atmos cho nháº¡c. Spatial audio, instruments separation, immersive vocals.',
        tips:'Apple Music, Tidal, Amazon Music cÃ³ Atmos. DÃ¹ng tai nghe há»— trá»£ spatial.',
        phoneEQ:{preamp:-1,b32:3,b64:3,b125:1,b250:-1,b500:0,b1k:2,b2k:3,b4k:4,b8k:4,b16k:3},
        isPhoneMode:true,
        isCinema:true
      },
      cinema_action:{
        name:'ğŸ’¥ Action Movie (Phim hÃ nh Ä‘á»™ng)',
        bass:58,lowMid:35,mid:45,highMid:55,high:50,tol:15,
        desc:'Ná»• máº¡nh, bass cá»±c sÃ¢u, tiáº¿ng sÃºng sáº¯c, dialog váº«n rÃµ.',
        tips:'Chuáº©n bá»‹ cho tai! Bass sáº½ ráº¥t máº¡nh. Giáº£m volume náº¿u cáº§n.',
        phoneEQ:{preamp:-3,b32:8,b64:7,b125:4,b250:0,b500:-2,b1k:1,b2k:3,b4k:4,b8k:4,b16k:3},
        isPhoneMode:true,
        isCinema:true
      },
      cinema_dialog:{
        name:'ğŸ—£ï¸ Dialog Focus (Thoáº¡i rÃµ)',
        bass:35,lowMid:28,mid:55,highMid:58,high:42,tol:10,
        desc:'Æ¯u tiÃªn thoáº¡i. Nghe rÃµ tá»«ng lá»i, giáº£m nháº¡c ná»n vÃ  tiáº¿ng Ä‘á»™ng.',
        tips:'DÃ¹ng khi xem phim nÆ°á»›c ngoÃ i, phim cÃ³ nhiá»u thoáº¡i nhá».',
        phoneEQ:{preamp:0,b32:1,b64:1,b125:-1,b250:-2,b500:0,b1k:4,b2k:5,b4k:4,b8k:2,b16k:1},
        isPhoneMode:true,
        isCinema:true
      },
      cinema_horror:{
        name:'ğŸ‘» Horror Movie (Phim kinh dá»‹)',
        bass:50,lowMid:38,mid:45,highMid:50,high:55,tol:12,
        desc:'Low-end Ã¡m áº£nh, treble chi tiáº¿t cho tiáº¿ng Ä‘á»™ng nhá», jump scare impact.',
        tips:'Äeo tai nghe trong phÃ²ng tá»‘i Ä‘á»ƒ tráº£i nghiá»‡m tá»‘t nháº¥t!',
        phoneEQ:{preamp:-2,b32:6,b64:5,b125:3,b250:1,b500:0,b1k:0,b2k:2,b4k:3,b8k:5,b16k:5},
        isPhoneMode:true,
        isCinema:true
      },
      cinema_scifi:{
        name:'ğŸš€ Sci-Fi / Fantasy',
        bass:52,lowMid:32,mid:48,highMid:55,high:55,tol:12,
        desc:'Synth bass sÃ¢u, hiá»‡u á»©ng khÃ´ng gian, Ã¢m thanh tÆ°Æ¡ng lai.',
        tips:'Tá»‘t cho Star Wars, Marvel, Dune, Interstellar...',
        phoneEQ:{preamp:-2,b32:6,b64:5,b125:2,b250:-1,b500:-1,b1k:1,b2k:3,b4k:5,b8k:5,b16k:5},
        isPhoneMode:true,
        isCinema:true
      },
      cinema_romance:{
        name:'ğŸ’• Romance / Drama',
        bass:35,lowMid:35,mid:52,highMid:50,high:40,tol:10,
        desc:'áº¤m Ã¡p, nháº¹ nhÃ ng. Giá»ng thoáº¡i intimate, nháº¡c ná»n mÆ°á»£t mÃ .',
        tips:'Giáº£m bass Ä‘á»ƒ táº­p trung vÃ o cáº£m xÃºc vÃ  thoáº¡i.',
        phoneEQ:{preamp:0,b32:2,b64:2,b125:2,b250:1,b500:0,b1k:3,b2k:3,b4k:2,b8k:1,b16k:0},
        isPhoneMode:true,
        isCinema:true
      },
      cinema_imax:{
        name:'ğŸ¦ IMAX Experience',
        bass:55,lowMid:35,mid:50,highMid:55,high:52,tol:15,
        desc:'MÃ´ phá»ng tráº£i nghiá»‡m IMAX. Bass cá»±c máº¡nh, dynamic range rá»™ng.',
        tips:'Cáº§n loa/tai nghe tá»‘t. Volume cao Ä‘á»ƒ cáº£m nháº­n full impact.',
        phoneEQ:{preamp:-3,b32:7,b64:6,b125:3,b250:0,b500:-1,b1k:2,b2k:4,b4k:4,b8k:4,b16k:3},
        isPhoneMode:true,
        isCinema:true
      },
      cinema_late_night:{
        name:'ğŸŒ™ Late Night Cinema',
        bass:38,lowMid:35,mid:52,highMid:48,high:38,tol:10,
        desc:'Xem phim Ä‘Ãªm khuya. Giáº£m bass vÃ  treble Ä‘á»™t ngá»™t, dialog váº«n rÃµ.',
        tips:'TrÃ¡nh Ä‘Ã¡nh thá»©c ngÆ°á»i khÃ¡c. Explosions sáº½ Ãªm hÆ¡n.',
        phoneEQ:{preamp:-2,b32:2,b64:2,b125:1,b250:0,b500:0,b1k:3,b2k:3,b4k:2,b8k:0,b16k:-1},
        isPhoneMode:true,
        isCinema:true
      },
      surround_virtual:{
        name:'ğŸ§ Virtual Surround 7.1',
        bass:45,lowMid:30,mid:48,highMid:55,high:55,tol:12,
        desc:'MÃ´ phá»ng surround 7.1 trÃªn tai nghe stereo. Spatial audio enhanced.',
        tips:'Táº¯t cÃ¡c virtual surround khÃ¡c Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t.',
        phoneEQ:{preamp:-1,b32:4,b64:3,b125:0,b250:-2,b500:-1,b1k:1,b2k:3,b4k:5,b8k:5,b16k:5},
        isPhoneMode:true,
        isCinema:true
      },
      dts_x:{
        name:'ğŸ”‰ DTS:X / DTS HD',
        bass:48,lowMid:33,mid:50,highMid:54,high:50,tol:12,
        desc:'Tá»‘i Æ°u cho DTS:X vÃ  DTS HD Master Audio. Object-based 3D audio.',
        tips:'DÃ¹ng khi xem Blu-ray hoáº·c streaming cÃ³ DTS.',
        phoneEQ:{preamp:-2,b32:5,b64:4,b125:1,b250:-1,b500:-1,b1k:2,b2k:3,b4k:4,b8k:4,b16k:3},
        isPhoneMode:true,
        isCinema:true
      }
    };
    this.currentGenre=null;
    this.customTarget=JSON.parse(localStorage.getItem('customTarget')||'null');
    this.targets=JSON.parse(localStorage.getItem('userTargets')||'null')||{...this.defaultTargets};
    this.compareBefore=null;this.compareAfter=null;
    this.fbRunning=false;this.fbPeaks=[];
    // Headphone mode
    this.hpType='music';
    this.hpRatings={bass:0,mid:0,treble:0,clarity:0,loud:0};
    this.init();
  }
  init(){
    this.setupCanvas();this.setupEvents();this.updateTargets();this.genSteps();this.updateDetail();this.renderHist();this.initLearnPanel();
  }
  setupCanvas(){
    const r=()=>{const rc=this.canvas.parentElement.getBoundingClientRect();const d=window.devicePixelRatio||1;this.canvas.width=rc.width*d;this.canvas.height=140*d;this.c.scale(d,d);this.w=rc.width;this.h=140;};
    r();window.addEventListener('resize',r);
  }
  setupEvents(){
    document.getElementById('startBtn').onclick=(e)=>{
      e.preventDefault();
      this.toggle();
    };
    document.querySelectorAll('.mode-btn').forEach(b=>{
      b.onclick=e=>{
        e.preventDefault();
        e.stopPropagation();
        const newMode=e.currentTarget.dataset.m;
        
        // Check if custom mode is selected but no custom target exists
        if(newMode==='custom' && !this.customTarget){
          alert('âš ï¸ ChÆ°a cÃ³ chuáº©n cá»§a báº¡n!\n\nHÃ£y:\n1. PhÃ¢n tÃ­ch Ã¢m thanh khi báº¡n tháº¥y HAY\n2. Nháº¥n "LÆ°u lÃ m CHUáº¨N" Ä‘á»ƒ táº¡o chuáº©n riÃªng');
          return;
        }
        
        document.querySelectorAll('.mode-btn').forEach(x=>x.classList.remove('active'));
        e.currentTarget.classList.add('active');
        this.mode=newMode;
        this.updateTargets();
        this.resetBands();
        // Handle custom info display
        if(this.mode==='custom'&&this.customTarget){
          this.showCustomInfo();
        }else{
          this.hideCustomInfo();
        }
      };
    });
    document.querySelectorAll('.nav-btn').forEach(b=>{
      b.onclick=e=>{
        e.preventDefault();
        e.stopPropagation();
        const s=e.currentTarget.dataset.s;
        document.querySelectorAll('.nav-btn').forEach(x=>x.classList.remove('active'));
        document.querySelectorAll('.section').forEach(x=>x.classList.remove('active'));
        e.currentTarget.classList.add('active');
        const section=document.getElementById('s-'+s);
        if(section) section.classList.add('active');
      };
    });
    
    // Genre preset selector
    document.getElementById('genreSelect').onchange=(e)=>{
      const genre=e.target.value;
      if(!genre){
        this.currentGenre=null;
        document.getElementById('genreInfo').style.display='none';
        return;
      }
      this.applyGenrePreset(genre);
    };
  }
  
  applyGenrePreset(genre){
    const preset=this.genrePresets[genre];
    if(!preset)return;
    
    this.currentGenre=genre;
    
    // Apply preset to current mode
    this.targets[this.mode]={
      bass:preset.bass,
      lowMid:preset.lowMid,
      mid:preset.mid,
      highMid:preset.highMid,
      high:preset.high,
      tol:preset.tol,
      desc:preset.desc
    };
    
    // Update UI
    this.updateTargets();
    this.resetBands();
    
    // Show genre info
    const infoPanel=document.getElementById('genreInfo');
    infoPanel.style.display='block';
    document.getElementById('genreName').textContent=preset.name;
    document.getElementById('genreDesc').innerHTML=preset.desc+'<br><span style="color:var(--yellow);margin-top:4px;display:block">ğŸ’¡ '+preset.tips+'</span>';
    document.getElementById('gBass').textContent=preset.bass+'%';
    document.getElementById('gLowMid').textContent=preset.lowMid+'%';
    document.getElementById('gMid').textContent=preset.mid+'%';
    document.getElementById('gHighMid').textContent=preset.highMid+'%';
    document.getElementById('gHigh').textContent=preset.high+'%';
    
    // Color code the values
    ['gBass','gLowMid','gMid','gHighMid','gHigh'].forEach(id=>{
      const el=document.getElementById(id);
      const val=parseInt(el.textContent);
      if(val>=50)el.style.color='var(--red)';
      else if(val>=35)el.style.color='var(--yellow)';
      else el.style.color='var(--green)';
    });
    
    // Show/hide Phone EQ panel
    const phonePanel=document.getElementById('phoneEQPanel');
    if(preset.phoneEQ){
      phonePanel.style.display='block';
      document.getElementById('phoneEQName').textContent=preset.name.replace(/ğŸ“±\s*/,'');
      this.updatePhoneEQVisual(preset.phoneEQ);
    }else if(preset.isPhoneMode){
      phonePanel.style.display='block';
      document.getElementById('phoneEQName').textContent=preset.name.replace(/ğŸ“±\s*/,'');
      this.updatePhoneEQVisual(preset.phoneEQ);
    }else{
      // Also show phone EQ for music genres
      if(preset.phoneEQ){
        phonePanel.style.display='block';
        document.getElementById('phoneEQName').textContent=preset.name;
        this.updatePhoneEQVisual(preset.phoneEQ);
      }else{
        phonePanel.style.display='none';
      }
    }
  }
  
  updatePhoneEQVisual(eq){
    if(!eq)return;
    
    // Map dB value (-12 to +12) to position (0% to 100%)
    const dbToPos=(db)=>{
      // -12dB = 100% (bottom), 0dB = 50%, +12dB = 0% (top)
      return 50 - (db / 12) * 50;
    };
    
    // Update slider positions
    const bands={
      'preamp':eq.preamp||0,
      '32':eq.b32||0,
      '64':eq.b64||0,
      '125':eq.b125||0,
      '250':eq.b250||0,
      '500':eq.b500||0,
      '1k':eq.b1k||0,
      '2k':eq.b2k||0,
      '4k':eq.b4k||0,
      '8k':eq.b8k||0,
      '16k':eq.b16k||0
    };
    
    Object.keys(bands).forEach(band=>{
      const slider=document.getElementById('eq_'+band);
      const valDisplay=document.getElementById('val_'+band);
      if(slider){
        const pos=dbToPos(bands[band]);
        slider.style.top=pos+'%';
        slider.style.transform='translateX(-50%) translateY(-50%)';
      }
      if(valDisplay){
        const v=bands[band];
        valDisplay.textContent=(v>0?'+':'')+v;
        valDisplay.style.color=v>0?'#007aff':v<0?'#ff3b30':'#666';
        valDisplay.style.fontWeight=v!==0?'700':'400';
      }
    });
  }
  updateTargets(){
    // Fallback to vocal mode if custom target doesn't exist
    let t=this.targets[this.mode];
    if(!t){
      console.warn('Target for mode "'+this.mode+'" not found, using vocal');
      t=this.targets.vocal;
    }
    ['Bass','LowMid','Mid','HighMid','High'].forEach((n,i)=>{const k=['bass','lowMid','mid','highMid','high'][i];const el=document.getElementById('t'+n);if(el&&t[k]!==undefined)el.style.bottom=t[k]+'%';});
  }
  resetBands(){Object.keys(this.bands).forEach(k=>{this.bands[k].vals=[];this.bands[k].avg=0;});}
  async start(){
    try{
      this.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:false,noiseSuppression:false,autoGainControl:false}});
      this.ctx=new(window.AudioContext||window.webkitAudioContext)();this.an=this.ctx.createAnalyser();this.an.fftSize=4096;this.an.smoothingTimeConstant=0.8;
      this.src=this.ctx.createMediaStreamSource(this.stream);this.src.connect(this.an);this.data=new Uint8Array(this.an.frequencyBinCount);
      this.running=true;this.dur=0;this.resetBands();this.updateUI(true);this.startTimer();this.draw();
    }catch(e){alert('KhÃ´ng thá»ƒ truy cáº­p mic!');console.error(e);}
  }
  stop(){this.running=false;this.stopTimer();if(this.stream)this.stream.getTracks().forEach(t=>t.stop());if(this.ctx)this.ctx.close();this.updateUI(false);this.genReport();this.saveHist();}
  toggle(){this.running?this.stop():this.start();}
  startTimer(){this.timer=setInterval(()=>{this.dur++;document.getElementById('dur').textContent=this.dur+'s';},1000);}
  stopTimer(){if(this.timer){clearInterval(this.timer);this.timer=null;}}
  updateUI(on){
    const btn=document.getElementById('startBtn'),icon=document.getElementById('startIcon'),txt=document.getElementById('startText'),dot=document.getElementById('dot'),sts=document.getElementById('sts');
    if(on){btn.classList.add('rec');icon.textContent='â¹ï¸';txt.textContent='Dá»ªNG PHÃ‚N TÃCH';dot.classList.add('on');sts.textContent='Äang thu...';document.getElementById('results').classList.remove('show');}
    else{btn.classList.remove('rec');icon.textContent='ğŸ™ï¸';txt.textContent='Báº®T Äáº¦U PHÃ‚N TÃCH';dot.classList.remove('on');sts.textContent='ÄÃ£ dá»«ng';}
  }
  fToI(f){return Math.round(f/(this.ctx.sampleRate/this.an.fftSize));}
  getBand(min,max){const mi=this.fToI(min),ma=Math.min(this.fToI(max),this.data.length-1);let s=0,c=0;for(let i=mi;i<=ma;i++){s+=this.data[i];c++;}return c>0?(s/c/255)*100:0;}
  analyze(){
    let total=0;
    Object.keys(this.bands).forEach(k=>{
      const b=this.bands[k],lv=this.getBand(b.min,b.max);b.vals.push(lv);if(b.vals.length>100)b.vals.shift();b.avg=b.vals.reduce((a,c)=>a+c,0)/b.vals.length;total+=lv;this.updateBandUI(k,lv);
    });
    const db=20*Math.log10((total/5)/100);document.getElementById('db').textContent=isFinite(db)?db.toFixed(1)+'dB':'--dB';this.updateDetail();
  }
  updateBandUI(k,lv){
    const nm={bass:'Bass',lowMid:'LowMid',mid:'Mid',highMid:'HighMid',high:'High'}[k];
    const target=this.targets[this.mode]||this.targets.vocal;
    const t=target[k],d=this.bands[k].avg-t,tol=target.tol||10;
    document.getElementById('f'+nm).style.height=Math.min(100,lv)+'%';document.getElementById('v'+nm).textContent=Math.round(this.bands[k].avg)+'%';
    const s=document.getElementById('s'+nm);if(Math.abs(d)<=tol){s.className='band-sts ok';s.textContent='OK';}else if(d>0){s.className='band-sts hi';s.textContent='THá»ªA';}else{s.className='band-sts lo';s.textContent='THIáº¾U';}
  }
  updateDetail(){
    const fd=[{n:'Sub Bass',r:'20-60Hz',k:'bass',m:0.4},{n:'Bass',r:'60-150Hz',k:'bass',m:0.6},{n:'Low-Mid',r:'150-500Hz',k:'lowMid',m:1},{n:'Mid',r:'500Hz-2kHz',k:'mid',m:1},{n:'Hi-Mid',r:'2-6kHz',k:'highMid',m:1},{n:'Treble',r:'6-12kHz',k:'high',m:0.7},{n:'Air',r:'12-20kHz',k:'high',m:0.3}];
    const target=this.targets[this.mode]||this.targets.vocal;
    document.getElementById('detailBody').innerHTML=fd.map(f=>{const v=this.bands[f.k].avg*f.m,t=target[f.k]*f.m,d=v-t;let st,cl,co;if(Math.abs(d)<=10){st='OK';cl='ok';co='var(--green)';}else if(d>0){st='+'+Math.round(d)+'%';cl='hi';co='var(--red)';}else{st=Math.round(d)+'%';cl='lo';co='var(--accent)';}return`<tr><td><b>${f.n}</b><br><small style="color:var(--text3)">${f.r}</small></td><td><div class="detail-bar"><div class="detail-bar-fill" style="width:${Math.min(100,v)}%;background:${co}"></div></div></td><td class="detail-sts ${cl}">${st}</td></tr>`;}).join('');
  }
  draw(){
    if(!this.running)return;requestAnimationFrame(()=>this.draw());this.an.getByteFrequencyData(this.data);this.analyze();
    this.c.fillStyle='#0a0a12';this.c.fillRect(0,0,this.w,this.h);
    const bars=64,bw=this.w/bars;
    for(let i=0;i<bars;i++){const idx=Math.floor(Math.pow(i/bars,2)*this.data.length*0.5),v=this.data[idx]/255,ht=v*this.h*0.9;let hue;if(i<bars*0.15)hue=350;else if(i<bars*0.3)hue=40;else if(i<bars*0.5)hue=150;else if(i<bars*0.75)hue=190;else hue=270;const g=this.c.createLinearGradient(0,this.h,0,this.h-ht);g.addColorStop(0,`hsla(${hue},100%,50%,0.9)`);g.addColorStop(1,`hsla(${hue},100%,70%,0.6)`);this.c.fillStyle=g;this.c.fillRect(i*bw+1,this.h-ht,bw-2,ht);}
  }
  dbToTurn(db){const a=Math.abs(db),dir=db>0?'pháº£i':'trÃ¡i',act=db>0?'TÄƒng':'Giáº£m';if(a<1)return{txt:'Giá»¯ nguyÃªn',clk:'12h',trn:''};if(a<=3)return{txt:`Váº·n ${dir} ~1/8 vÃ²ng`,clk:db>0?'1h':'11h',trn:`${act} ~${Math.round(a)}dB`};if(a<=6)return{txt:`Váº·n ${dir} ~1/4 vÃ²ng`,clk:db>0?'2h':'10h',trn:`${act} ~${Math.round(a)}dB`};if(a<=9)return{txt:`Váº·n ${dir} ~3/8 vÃ²ng`,clk:db>0?'2-3h':'9-10h',trn:`${act} ~${Math.round(a)}dB`};return{txt:`Váº·n ${dir} ~1/2 vÃ²ng`,clk:db>0?'3h':'9h',trn:`${act} max`};}
  dbToRot(db){return(db/15)*135;}
  genReport(){
    const t=this.targets[this.mode]||this.targets.vocal,tol=t.tol||10,probs=[];
    const calcEQ=(k,mx=12)=>{const d=t[k]-this.bands[k].avg;return Math.max(-mx,Math.min(mx,d/4));};
    const eqV={hi:calcEQ('high',6),mid:calcEQ('mid',6)+calcEQ('highMid',6)/2,lo:-(this.bands.bass.avg-t.bass)/3-(this.bands.lowMid.avg-t.lowMid)/4};
    const eqG={hi:calcEQ('high',4),mid:calcEQ('highMid',4),lo:calcEQ('bass',6)};
    const bn={bass:'Bass (20-150Hz)',lowMid:'Low-Mid (150-500Hz)',mid:'Mid (500Hz-2kHz)',highMid:'Hi-Mid (2-6kHz)',high:'Treble (6-20kHz)'};
    const sols={bass:{high:{t:'ğŸ”´ Giáº£m nÃºm LO - Loáº¡i bá» tiáº¿ng Ã¹ng á»¥c',s:[{k:'LO',a:'Váº·n TRÃI tá»« tá»«',d:'Báº¯t Ä‘áº§u tá»« 12h, váº·n dáº§n vá» 9-10h. Nghe tháº¥y tiáº¿ng bá»›t náº·ng lÃ  Ä‘Æ°á»£c.',tr:'1/4 vÃ²ng TRÃI (45Â°)'},{k:'HPF',a:'Báº¬T nÃºt HPF (náº¿u cÃ³)',d:'High Pass Filter cáº¯t táº§n sá»‘ dÆ°á»›i 80Hz, giÃºp loáº¡i bá» tiáº¿ng Ã¹.',tr:'Nháº¥n nÃºt xuá»‘ng'}]},low:{t:'ğŸŸ¢ TÄƒng nÃºm LO nháº¹ - ThÃªm Ä‘á»™ áº¥m',s:[{k:'LO',a:'Váº·n PHáº¢I nháº¹',d:'Tá»« 12h vá» 1h. Cáº©n tháº­n Ä‘á»«ng tÄƒng quÃ¡ nhiá»u sáº½ bá»‹ Ã¹ng á»¥c.',tr:'1/8 vÃ²ng PHáº¢I (22Â°)'}]}},lowMid:{high:{t:'ğŸ”´ Cáº¯t vÃ¹ng "bÃ¹n" 200-500Hz - Ráº¤T QUAN TRá»ŒNG!',s:[{k:'MID FREQ',a:'Váº·n nÃºm nhá» vá» 400Hz',d:'TÃ¬m váº¡ch Ä‘Ã¡nh dáº¥u 400 hoáº·c 0.4k trÃªn mixer. ÄÃ¢y lÃ  táº§n sá»‘ gÃ¢y Ä‘á»¥c nháº¥t!',tr:'TÃ¬m vá»‹ trÃ­ 400Hz'},{k:'MID',a:'Váº·n TRÃI máº¡nh tay',d:'Tá»« 12h vá» 9-10h. ÄÃ¢y lÃ  bÆ°á»›c quan trá»ng nháº¥t Ä‘á»ƒ giá»ng/Ä‘Ã n rÃµ hÆ¡n.',tr:'1/4 Ä‘áº¿n 1/2 vÃ²ng TRÃI'}]},low:{t:'ğŸŸ¢ Low-Mid Ä‘ang tá»‘t',s:[{k:'MID',a:'Giá»¯ nguyÃªn vá»‹ trÃ­',d:'VÃ¹ng nÃ y thÆ°á»ng cáº§n cáº¯t. Náº¿u thiáº¿u thÃ¬ khÃ´ng cáº§n tÄƒng.',tr:'KhÃ´ng cáº§n chá»‰nh'}]}},mid:{high:{t:'ğŸŸ¡ Giáº£m MID nháº¹ - Bá»›t tiáº¿ng "há»™p"',s:[{k:'MID FREQ',a:'Váº·n vá» 1kHz',d:'TÃ¬m váº¡ch 1k hoáº·c 1000.',tr:'TÃ¬m vá»‹ trÃ­ 1kHz'},{k:'MID',a:'Váº·n TRÃI nháº¹',d:'Tá»« 12h vá» 11h. Chá»‰ giáº£m nháº¹ thÃ´i, Ä‘á»«ng cáº¯t quÃ¡ nhiá»u.',tr:'1/8 vÃ²ng TRÃI (22Â°)'}]},low:{t:'ğŸ”´ TÄƒng MID - Giá»ng/Ä‘Ã n sáº½ rÃµ hÆ¡n nhiá»u!',s:[{k:'MID FREQ',a:'Váº·n vá» 1-2kHz',d:'VÃ¹ng 1-2kHz lÃ  thÃ¢n tiáº¿ng cá»§a giá»ng hÃ¡t vÃ  guitar.',tr:'TÃ¬m vá»‹ trÃ­ 1-2kHz'},{k:'MID',a:'Váº·n PHáº¢I',d:'Tá»« 12h vá» 1-2h. Giá»ng sáº½ dÃ y vÃ  rÃµ rÃ ng hÆ¡n.',tr:'1/4 vÃ²ng PHáº¢I (45Â°)'}]}},highMid:{high:{t:'ğŸŸ¡ Giáº£m Hi-Mid - Bá»›t chÃ³i tai',s:[{k:'MID FREQ',a:'Váº·n vá» 3-4kHz',d:'TÃ¬m váº¡ch 3k hoáº·c 4k.',tr:'TÃ¬m vá»‹ trÃ­ 3-4kHz'},{k:'MID',a:'Váº·n TRÃI nháº¹',d:'Tá»« 12h vá» 11h. Sáº½ bá»›t chÃ³i vÃ  dá»… nghe hÆ¡n.',tr:'1/8 vÃ²ng TRÃI (22Â°)'}]},low:{t:'ğŸ”´ TÄƒng Hi-Mid - Giá»ng cáº¯t qua mix, nghe RÃ• hÆ¡n!',s:[{k:'MID FREQ',a:'Váº·n vá» 2.5-4kHz',d:'ÄÃ¢y lÃ  vÃ¹ng "presence" - lÃ m giá»ng ná»•i báº­t lÃªn trÃªn nháº¡c!',tr:'TÃ¬m vá»‹ trÃ­ 2.5-4kHz'},{k:'MID',a:'Váº·n PHáº¢I',d:'Tá»« 12h vá» 1-2h. Giá»ng sáº½ cáº¯t qua mix, nghe rÃµ tá»«ng chá»¯.',tr:'1/4 vÃ²ng PHáº¢I (45Â°)'}]}},high:{high:{t:'ğŸŸ¡ Giáº£m Treble - Bá»›t xÃ¨n xáº¹t',s:[{k:'HI',a:'Váº·n TRÃI',d:'Tá»« 12h vá» 10-11h. Giáº£m Ä‘á»™ chÃ³i, dá»… nghe hÆ¡n.',tr:'1/8 vÃ²ng TRÃI (22Â°)'}]},low:{t:'ğŸŸ¢ TÄƒng Treble - ThÃªm Ä‘á»™ sÃ¡ng, sparkle',s:[{k:'HI',a:'Váº·n PHáº¢I',d:'Tá»« 12h vá» 1-2h. ThÃªm "air" vÃ  Ä‘á»™ sÃ¡ng cho giá»ng/Ä‘Ã n.',tr:'1/4 vÃ²ng PHáº¢I (45Â°)'}]}}};
    let sc=0;
    Object.keys(this.bands).forEach(k=>{const avg=this.bands[k].avg,d=avg-t[k],bs=Math.max(0,100-Math.abs(d)*2.5);sc+=bs;if(Math.abs(d)>tol){const hi=d>0,sev=Math.abs(d)>tol*1.8?'crit':'warn',sol=sols[k][hi?'high':'low'];probs.push({k,n:bn[k],sev,hi,d:Math.round(d),avg:Math.round(avg),t:t[k],sol});}});
    sc=Math.round(sc/5);this.showScore(sc);this.showProbs(probs);this.updateMixer(eqV,eqG);this.genSteps(probs);this.genFullMixerRec(sc,eqV,probs);this.genPhoneEQRec();document.getElementById('results').classList.add('show');
  }
  
  genPhoneEQRec(){
    const t=this.targets[this.mode]||this.targets.vocal;
    const b=this.bands;
    
    // Calculate EQ adjustments based on analysis vs target
    // Convert band differences to 10-band EQ (-12 to +12 dB)
    const diff={
      bass:(t.bass-b.bass.avg)/8,      // 32Hz, 64Hz
      lowMid:(t.lowMid-b.lowMid.avg)/8, // 125Hz, 250Hz, 500Hz
      mid:(t.mid-b.mid.avg)/8,          // 1kHz, 2kHz
      highMid:(t.highMid-b.highMid.avg)/8, // 4kHz
      high:(t.high-b.high.avg)/8        // 8kHz, 16kHz
    };
    
    // Clamp to -12 to +12
    const clamp=(v)=>Math.max(-12,Math.min(12,Math.round(v)));
    
    // Generate 10-band EQ values
    const phoneEQ={
      b32:clamp(diff.bass*1.2),
      b64:clamp(diff.bass),
      b125:clamp(diff.bass*0.5+diff.lowMid*0.5),
      b250:clamp(diff.lowMid),
      b500:clamp(diff.lowMid*0.7+diff.mid*0.3),
      b1k:clamp(diff.mid),
      b2k:clamp(diff.mid*0.6+diff.highMid*0.4),
      b4k:clamp(diff.highMid),
      b8k:clamp(diff.highMid*0.4+diff.high*0.6),
      b16k:clamp(diff.high)
    };
    
    // Update visual sliders
    const dbToPos=(db)=>50-(db/12)*50; // -12=100%, 0=50%, +12=0%
    
    const bands=['32','64','125','250','500','1k','2k','4k','8k','16k'];
    const values=[phoneEQ.b32,phoneEQ.b64,phoneEQ.b125,phoneEQ.b250,phoneEQ.b500,phoneEQ.b1k,phoneEQ.b2k,phoneEQ.b4k,phoneEQ.b8k,phoneEQ.b16k];
    
    bands.forEach((band,i)=>{
      const slider=document.getElementById('req_'+band);
      const valDisplay=document.getElementById('rval_'+band);
      if(slider){
        const pos=dbToPos(values[i]);
        slider.style.top=pos+'%';
        slider.style.transform='translateX(-50%) translateY(-50%)';
        // Color based on value
        if(values[i]>3)slider.style.background='#ff3b30';
        else if(values[i]<-3)slider.style.background='#007aff';
        else slider.style.background='#4cd964';
      }
      if(valDisplay){
        const v=values[i];
        valDisplay.textContent=(v>0?'+':'')+v;
        valDisplay.style.color=v>0?'#ff3b30':v<0?'#007aff':'#4cd964';
      }
    });
    
    // Find best matching preset
    let bestPreset=null;
    let bestScore=Infinity;
    const phonePresets=['phone_bass','phone_vocal','phone_flat','phone_loudness','phone_treble','phone_night','phone_small_speaker'];
    
    phonePresets.forEach(key=>{
      const preset=this.genrePresets[key];
      if(preset&&preset.phoneEQ){
        const peq=preset.phoneEQ;
        const score=Math.abs(peq.b32-phoneEQ.b32)+Math.abs(peq.b64-phoneEQ.b64)+
                    Math.abs(peq.b125-phoneEQ.b125)+Math.abs(peq.b250-phoneEQ.b250)+
                    Math.abs(peq.b500-phoneEQ.b500)+Math.abs(peq.b1k-phoneEQ.b1k)+
                    Math.abs(peq.b2k-phoneEQ.b2k)+Math.abs(peq.b4k-phoneEQ.b4k)+
                    Math.abs(peq.b8k-phoneEQ.b8k)+Math.abs(peq.b16k-phoneEQ.b16k);
        if(score<bestScore){
          bestScore=score;
          bestPreset=preset;
        }
      }
    });
    
    // Also check genre presets
    if(this.currentGenre&&this.genrePresets[this.currentGenre]){
      const genrePreset=this.genrePresets[this.currentGenre];
      if(genrePreset.phoneEQ){
        document.getElementById('resultEQName').textContent=genrePreset.name+' (theo thá»ƒ loáº¡i)';
      }
    }else{
      document.getElementById('resultEQName').textContent='Custom EQ (theo phÃ¢n tÃ­ch)';
    }
    
    // Show suggested preset
    if(bestPreset){
      document.getElementById('suggestedPresetName').textContent=bestPreset.name;
      document.getElementById('suggestedPresetDesc').textContent=bestPreset.desc;
    }else{
      document.getElementById('suggestedPresetName').textContent='Custom';
      document.getElementById('suggestedPresetDesc').textContent='DÃ¹ng giÃ¡ trá»‹ EQ á»Ÿ trÃªn Ä‘á»ƒ chá»‰nh thá»§ cÃ´ng';
    }
    
    // Determine overall recommendation
    const avgBass=(phoneEQ.b32+phoneEQ.b64)/2;
    const avgMid=(phoneEQ.b1k+phoneEQ.b2k+phoneEQ.b4k)/3;
    const avgHigh=(phoneEQ.b8k+phoneEQ.b16k)/2;
    
    let recommendation='';
    if(avgBass>4)recommendation='ğŸ”Š Bass Boost';
    else if(avgMid>4)recommendation='ğŸ¤ Vocal Clear';
    else if(avgHigh>4)recommendation='âœ¨ Treble Boost';
    else if(avgBass<-4&&avgHigh<-4)recommendation='ğŸŒ™ Night Mode';
    else recommendation='ğŸ“ Balanced';
    
    document.getElementById('resultEQName').textContent=recommendation+' (tá»± Ä‘á»™ng)';
  }
  
  genFullMixerRec(score,eqV,probs){
    const t=this.targets[this.mode]||this.targets.vocal;
    const genre=this.currentGenre;
    const genrePreset=genre?this.genrePresets[genre]:null;
    
    // Calculate recommendations for all 8 knobs
    const avgLevel=(this.bands.bass.avg+this.bands.lowMid.avg+this.bands.mid.avg+this.bands.highMid.avg+this.bands.high.avg)/5;
    
    // 1. GAIN recommendation based on average level
    let gainRec={status:'ok',pos:'12h',action:'Giá»¯ nguyÃªn',detail:'Má»©c tÃ­n hiá»‡u tá»‘t',color:'var(--green)'};
    if(avgLevel<20){gainRec={status:'low',pos:'1-2h',action:'TÄƒng GAIN',detail:'TÃ­n hiá»‡u yáº¿u - Váº·n PHáº¢I thÃªm 1/4 vÃ²ng',color:'var(--yellow)'};}
    else if(avgLevel>70){gainRec={status:'high',pos:'10-11h',action:'Giáº£m GAIN',detail:'TÃ­n hiá»‡u quÃ¡ máº¡nh - Váº·n TRÃI 1/4 vÃ²ng',color:'var(--red)'};}
    
    // 2. HPF recommendation
    let hpfRec={status:'on',action:'Báº¬T (nháº¥n xuá»‘ng)',detail:'Cáº¯t tiáº¿ng Ã¹, giÃ³ dÆ°á»›i 80Hz',color:'var(--green)'};
    if(this.mode==='guitar'&&this.bands.bass.avg<t.bass){hpfRec={status:'off',action:'Táº®T (nháº£ lÃªn)',detail:'Guitar cáº§n bass, khÃ´ng cáº§n cáº¯t',color:'var(--yellow)'};}
    
    // 3. HI (Treble) recommendation
    const hiDiff=t.high-this.bands.high.avg;
    let hiRec={status:'ok',pos:'12h',action:'Giá»¯ nguyÃªn',detail:'Treble cÃ¢n báº±ng',color:'var(--green)',rot:0};
    if(hiDiff>10){hiRec={status:'low',pos:'1-2h',action:'TÄƒng HI',detail:`Thiáº¿u ${Math.round(hiDiff)}% - Váº·n PHáº¢I`,color:'var(--accent)',rot:45};}
    else if(hiDiff<-10){hiRec={status:'high',pos:'10-11h',action:'Giáº£m HI',detail:`Thá»«a ${Math.round(-hiDiff)}% - Váº·n TRÃI`,color:'var(--red)',rot:-45};}
    
    // 4. MID recommendation
    const midDiff=t.mid-this.bands.mid.avg;
    const hiMidDiff=t.highMid-this.bands.highMid.avg;
    let midRec={status:'ok',pos:'12h',action:'Giá»¯ nguyÃªn',detail:'Mid cÃ¢n báº±ng',color:'var(--green)',rot:0};
    if(midDiff>10||hiMidDiff>10){midRec={status:'low',pos:'1-2h',action:'TÄƒng MID',detail:`Thiáº¿u presence - Váº·n PHáº¢I`,color:'var(--accent)',rot:50};}
    else if(midDiff<-10||hiMidDiff<-10){midRec={status:'high',pos:'10-11h',action:'Giáº£m MID',detail:`ChÃ³i/Ä‘á»¥c - Váº·n TRÃI`,color:'var(--red)',rot:-50};}
    
    // 5. MID FREQ recommendation
    const lowMidHigh=this.bands.lowMid.avg>t.lowMid+10;
    const hiMidHigh=this.bands.highMid.avg>t.highMid+10;
    let midFreqRec={pos:'2.5kHz',action:'Äá»ƒ á»Ÿ 2.5kHz',detail:'TÄƒng presence cho giá»ng',color:'var(--purple)'};
    if(lowMidHigh){midFreqRec={pos:'400Hz',action:'Váº·n vá» 400Hz',detail:'Cáº®T vÃ¹ng bÃ¹n Ä‘á»¥c!',color:'var(--red)'};}
    else if(hiMidHigh){midFreqRec={pos:'3-4kHz',action:'Váº·n vá» 3-4kHz',detail:'Giáº£m chÃ³i tai',color:'var(--yellow)'};}
    
    // 6. LO (Bass) recommendation
    const loDiff=t.bass-this.bands.bass.avg;
    let loRec={status:'ok',pos:'12h',action:'Giá»¯ nguyÃªn',detail:'Bass cÃ¢n báº±ng',color:'var(--green)',rot:0};
    if(loDiff>10){loRec={status:'low',pos:'1h',action:'TÄƒng LO nháº¹',detail:`Thiáº¿u áº¥m - Váº·n PHáº¢I 1/8 vÃ²ng`,color:'var(--accent)',rot:25};}
    else if(loDiff<-10){loRec={status:'high',pos:'9-10h',action:'Giáº£m LO',detail:`Ã™ng á»¥c - Váº·n TRÃI 1/4 vÃ²ng`,color:'var(--red)',rot:-60};}
    
    // 7. FX recommendation based on genre and score
    let fxRec={pos:'10-11h',pct:'25%',action:'FX vá»«a pháº£i',detail:'Reverb plate cho vocal',color:'var(--purple)'};
    if(genrePreset){
      if(['bolero','livecafe','church'].includes(genre)){fxRec={pos:'11-12h',pct:'30-40%',action:'FX nhiá»u hÆ¡n',detail:genrePreset.name+' cáº§n reverb dÃ i',color:'var(--purple)'};}
      else if(['hiphop','edm','rock'].includes(genre)){fxRec={pos:'9-10h',pct:'15-20%',action:'FX Ã­t',detail:genrePreset.name+' cáº§n giá»ng khÃ´, rÃµ',color:'var(--yellow)'};}
    }
    if(score<60){fxRec.detail+=' (âš ï¸ Chá»‰nh EQ trÆ°á»›c, FX sau!)';}
    
    // 8. AUX (Monitor) recommendation
    let auxRec={pos:'12-1h',pct:'50-60%',action:'Monitor vá»«a',detail:'Ca sÄ© nghe rÃµ giá»ng mÃ¬nh',color:'var(--green)'};
    
    // 9. PAN recommendation
    let panRec={pos:'12h (Giá»¯a)',action:'Äá»ƒ giá»¯a',detail:'Vocal luÃ´n á»Ÿ center',color:'var(--text2)'};
    
    // 10. FADER recommendation
    let faderRec={pos:'0dB (Unity)',action:'Äá»ƒ á»Ÿ váº¡ch 0',detail:'Má»©c chuáº©n, Ä‘iá»u chá»‰nh báº±ng Master',color:'var(--green)'};
    if(avgLevel<25){faderRec={pos:'+3 Ä‘áº¿n +5dB',action:'Äáº©y lÃªn trÃªn 0',detail:'BÃ¹ cho tÃ­n hiá»‡u yáº¿u',color:'var(--yellow)'};}
    
    // Generate HTML
    const html=`
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:12px">
        <!-- Row 1: GAIN, HPF, HI, MID -->
        <div style="background:${gainRec.color}22;border:1px solid ${gainRec.color};border-radius:8px;padding:8px;text-align:center">
          <div style="font-size:1.2rem">ğŸšï¸</div>
          <div style="font-size:0.7rem;font-weight:700;color:${gainRec.color}">GAIN</div>
          <div style="font-size:0.6rem;color:var(--text2)">${gainRec.pos}</div>
          <div style="font-size:0.55rem;margin-top:4px">${gainRec.action}</div>
        </div>
        <div style="background:${hpfRec.color}22;border:1px solid ${hpfRec.color};border-radius:8px;padding:8px;text-align:center">
          <div style="font-size:1.2rem">ğŸ”˜</div>
          <div style="font-size:0.7rem;font-weight:700;color:${hpfRec.color}">HPF</div>
          <div style="font-size:0.6rem;color:var(--text2)">${hpfRec.status==='on'?'Báº¬T âœ“':'Táº®T'}</div>
          <div style="font-size:0.55rem;margin-top:4px">${hpfRec.action}</div>
        </div>
        <div style="background:${hiRec.color}22;border:1px solid ${hiRec.color};border-radius:8px;padding:8px;text-align:center">
          <div style="width:28px;height:28px;background:linear-gradient(145deg,#3a3a4a,#28283a);border-radius:50%;margin:0 auto 4px;position:relative">
            <div style="position:absolute;width:2px;height:10px;background:${hiRec.color};border-radius:2px;top:4px;left:50%;transform-origin:bottom center;transform:translateX(-50%) rotate(${hiRec.rot}deg)"></div>
          </div>
          <div style="font-size:0.7rem;font-weight:700;color:${hiRec.color}">HI</div>
          <div style="font-size:0.6rem;color:var(--text2)">${hiRec.pos}</div>
          <div style="font-size:0.55rem;margin-top:4px">${hiRec.action}</div>
        </div>
        <div style="background:${midRec.color}22;border:1px solid ${midRec.color};border-radius:8px;padding:8px;text-align:center">
          <div style="width:28px;height:28px;background:linear-gradient(145deg,#3a3a4a,#28283a);border-radius:50%;margin:0 auto 4px;position:relative">
            <div style="position:absolute;width:2px;height:10px;background:${midRec.color};border-radius:2px;top:4px;left:50%;transform-origin:bottom center;transform:translateX(-50%) rotate(${midRec.rot}deg)"></div>
          </div>
          <div style="font-size:0.7rem;font-weight:700;color:${midRec.color}">MID</div>
          <div style="font-size:0.6rem;color:var(--text2)">${midRec.pos}</div>
          <div style="font-size:0.55rem;margin-top:4px">${midRec.action}</div>
        </div>
      </div>
      
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:12px">
        <!-- Row 2: MID FREQ, LO, FX, AUX -->
        <div style="background:${midFreqRec.color}22;border:1px solid ${midFreqRec.color};border-radius:8px;padding:8px;text-align:center">
          <div style="font-size:1.2rem">ğŸ›ï¸</div>
          <div style="font-size:0.7rem;font-weight:700;color:${midFreqRec.color}">MID FREQ</div>
          <div style="font-size:0.6rem;color:var(--text2)">${midFreqRec.pos}</div>
          <div style="font-size:0.55rem;margin-top:4px">${midFreqRec.action}</div>
        </div>
        <div style="background:${loRec.color}22;border:1px solid ${loRec.color};border-radius:8px;padding:8px;text-align:center">
          <div style="width:28px;height:28px;background:linear-gradient(145deg,#3a3a4a,#28283a);border-radius:50%;margin:0 auto 4px;position:relative">
            <div style="position:absolute;width:2px;height:10px;background:${loRec.color};border-radius:2px;top:4px;left:50%;transform-origin:bottom center;transform:translateX(-50%) rotate(${loRec.rot}deg)"></div>
          </div>
          <div style="font-size:0.7rem;font-weight:700;color:${loRec.color}">LO</div>
          <div style="font-size:0.6rem;color:var(--text2)">${loRec.pos}</div>
          <div style="font-size:0.55rem;margin-top:4px">${loRec.action}</div>
        </div>
        <div style="background:${fxRec.color}22;border:1px solid ${fxRec.color};border-radius:8px;padding:8px;text-align:center">
          <div style="font-size:1.2rem">ğŸŒŠ</div>
          <div style="font-size:0.7rem;font-weight:700;color:${fxRec.color}">FX</div>
          <div style="font-size:0.6rem;color:var(--text2)">${fxRec.pos} (${fxRec.pct})</div>
          <div style="font-size:0.55rem;margin-top:4px">${fxRec.action}</div>
        </div>
        <div style="background:${auxRec.color}22;border:1px solid ${auxRec.color};border-radius:8px;padding:8px;text-align:center">
          <div style="font-size:1.2rem">ğŸ§</div>
          <div style="font-size:0.7rem;font-weight:700;color:${auxRec.color}">AUX</div>
          <div style="font-size:0.6rem;color:var(--text2)">${auxRec.pos}</div>
          <div style="font-size:0.55rem;margin-top:4px">${auxRec.action}</div>
        </div>
      </div>
      
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px">
        <!-- Row 3: PAN, FADER -->
        <div style="background:${panRec.color}22;border:1px solid ${panRec.color};border-radius:8px;padding:8px;text-align:center">
          <div style="font-size:1.2rem">â†”ï¸</div>
          <div style="font-size:0.7rem;font-weight:700;color:${panRec.color}">PAN</div>
          <div style="font-size:0.6rem;color:var(--text2)">${panRec.pos}</div>
          <div style="font-size:0.55rem;margin-top:4px">${panRec.detail}</div>
        </div>
        <div style="background:${faderRec.color}22;border:1px solid ${faderRec.color};border-radius:8px;padding:8px;text-align:center">
          <div style="font-size:1.2rem">ğŸ“Š</div>
          <div style="font-size:0.7rem;font-weight:700;color:${faderRec.color}">FADER</div>
          <div style="font-size:0.6rem;color:var(--text2)">${faderRec.pos}</div>
          <div style="font-size:0.55rem;margin-top:4px">${faderRec.action}</div>
        </div>
      </div>
      
      ${genrePreset?`<div style="margin-top:12px;padding:10px;background:var(--bg);border-radius:8px;border-left:3px solid var(--purple)">
        <div style="font-size:0.75rem;font-weight:700;color:var(--purple);margin-bottom:4px">ğŸ’¡ Máº¹o cho ${genrePreset.name}:</div>
        <div style="font-size:0.7rem;color:var(--text2)">${genrePreset.tips}</div>
      </div>`:''}
    `;
    
    document.getElementById('fullMixerRec').innerHTML=html;
  }
  showScore(sc){
    const ring=document.getElementById('scoreRing'),num=document.getElementById('scoreNum'),msg=document.getElementById('scoreMsg'),hint=document.getElementById('scoreHint');
    const circ=2*Math.PI*60,off=circ-(sc/100)*circ;ring.style.strokeDashoffset=off;
    let col;if(sc>=80)col='var(--green)';else if(sc>=55)col='var(--yellow)';else col='var(--red)';ring.style.stroke=col;num.style.color=col;num.textContent=sc;
    if(sc>=85){msg.textContent='ğŸ‰ Xuáº¥t sáº¯c!';hint.textContent='Ã‚m thanh ráº¥t cÃ¢n báº±ng. Giá»¯ nguyÃªn setting nÃ y!';}else if(sc>=70){msg.textContent='ğŸ‘ KhÃ¡ tá»‘t!';hint.textContent='Gáº§n hoÃ n háº£o rá»“i! Chá»‰nh thÃªm chÃºt theo hÆ°á»›ng dáº«n.';}else if(sc>=55){msg.textContent='âš¡ Cáº§n Ä‘iá»u chá»‰nh';hint.textContent='CÃ³ váº¥n Ä‘á» cáº§n sá»­a. LÃ m theo hÆ°á»›ng dáº«n bÃªn dÆ°á»›i.';}else{msg.textContent='âš ï¸ Cáº§n chá»‰nh nhiá»u';hint.textContent='CÃ³ váº¥n Ä‘á» rÃµ rÃ ng. Xem chi tiáº¿t vÃ  lÃ m tá»«ng bÆ°á»›c.';}
  }
  showProbs(probs){
    const c=document.getElementById('probList');
    if(!probs.length){c.innerHTML='<div class="problem good"><div class="problem-head"><div class="problem-title">âœ… Ã‚m thanh cÃ¢n báº±ng!</div><span class="problem-badge badge-good">TUYá»†T</span></div><div class="problem-desc">Giá»¯ nguyÃªn setting hiá»‡n táº¡i!</div></div>';return;}
    probs.sort((a,b)=>a.sev==='crit'?-1:1);
    c.innerHTML=probs.map(p=>`<div class="problem ${p.sev}"><div class="problem-head"><div class="problem-title">${p.sev==='crit'?'ğŸ”´':'ğŸŸ¡'} ${p.n} ${p.hi?'THá»ªA':'THIáº¾U'}</div><span class="problem-badge badge-${p.sev}">${p.hi?'+':''}${p.d}%</span></div><div class="problem-desc">Hiá»‡n táº¡i: <b>${p.avg}%</b>, lÃ½ tÆ°á»Ÿng: <b>${p.t}%</b> â†’ ${p.hi?'Cáº§n GIáº¢M':'Cáº§n TÄ‚NG'}</div><div class="solution"><div class="solution-label">ğŸ”§ ${p.sol.t}</div>${p.sol.s.map(s=>`<div class="sol-step"><div class="sol-knob"><div class="sol-knob-ptr" style="transform:translateX(-50%) rotate(${s.a.includes('TRÃI')?-60:s.a.includes('PHáº¢I')?60:0}deg)"></div><div class="sol-knob-lbl">${s.k}</div></div><div class="sol-info"><div class="sol-action">${s.a}</div><div class="sol-detail">${s.d}</div>${s.tr?`<div class="sol-turn">â†» ${s.tr}</div>`:''}</div></div>`).join('')}</div></div>`).join('');
  }
  updateMixer(eqV,eqG){
    this.updateKnob('V','Gain',0,'0','');this.updateKnob('V','Hi',eqV.hi);this.updateKnob('V','Mid',eqV.mid);this.updateKnob('V','Lo',eqV.lo);
    this.updateKnob('G','Gain',0,'0','');this.updateKnob('G','Hi',eqG.hi);this.updateKnob('G','Mid',eqG.mid);this.updateKnob('G','Lo',eqG.lo);
    const cut=this.bands.lowMid.avg>this.targets[this.mode].lowMid+10;
    document.getElementById('fqV').textContent=cut?'400Hz (cáº¯t)':'2.5kHz';document.getElementById('fqG').textContent=cut?'500Hz (cáº¯t)':'3kHz';
    const mud=this.bands.lowMid.avg>this.targets[this.mode].lowMid+15;
    document.getElementById('fxProg').textContent=mud?'Plate':'Vocal Plate';document.getElementById('fxTime').textContent=mud?'9h':'10h';document.getElementById('fxMix').textContent=mud?'20%':'25%';document.getElementById('fxNote').textContent=mud?'Giáº£m vang':'Vang vá»«a';
  }
  updateKnob(ch,p,db,dv=null,tv=null){
    const knob=document.getElementById('k'+ch+p),val=document.getElementById('v'+ch+p),trn=document.getElementById('t'+ch+p);
    knob.style.transform=`translateX(-50%) rotate(${this.dbToRot(db)}deg)`;
    if(dv!==null){val.textContent=dv;val.className='knob-val';}else{const s=db>0?'+':'';val.textContent=s+Math.round(db)+'dB';val.className='knob-val '+(db>0?'pos':db<0?'neg':'');}
    if(trn){if(tv!==null)trn.textContent=tv;else{const t=this.dbToTurn(db);trn.textContent=t.trn||t.clk;}}
  }
  genSteps(){
    const steps=[
      {t:'1. ğŸšï¸ Kiá»ƒm tra GAIN (Äá»™ nháº¡y)',d:'HÃ¡t/Ä‘Ã n TO NHáº¤T cÃ³ thá»ƒ. NhÃ¬n Ä‘Ã¨n PEAK (Ä‘Ã¨n Ä‘á» nhá» gáº§n fader). Váº·n GAIN sao cho Ä‘Ã¨n PEAK chá»›p nhÃ¡y 1-2 láº§n khi hÃ¡t to, KHÃ”NG sÃ¡ng liÃªn tá»¥c.',v:{r:0,x:'âœ“ ÄÃ¨n peak chá»›p nháº¹ = ÄÃšNG\nâœ— SÃ¡ng liÃªn tá»¥c = Giáº£m GAIN\nâœ— KhÃ´ng sÃ¡ng = TÄƒng GAIN'}},
      {t:'2. ğŸ”´ Cáº®T BASS - QUAN TRá»ŒNG NHáº¤T!',d:'ÄÃ¢y lÃ  bÆ°á»›c quan trá»ng nháº¥t! Váº·n nÃºm LO sang TRÃI vá» hÆ°á»›ng 9-10 giá». Tiáº¿ng sáº½ bá»›t Ã¹ng á»¥c, náº·ng ná» ngay láº­p tá»©c.',v:{r:-90,x:'Váº·n LO sang TRÃI\nâ†’ 1/4 vÃ²ng (tá»« 12h vá» 9h)\nâ†’ Khoáº£ng 45 Ä‘á»™'}},
      {t:'3. ğŸ¯ Äáº·t MID FREQ (Táº§n sá»‘ trung tÃ¢m)',d:'NÃºm MID FREQ lÃ  nÃºm NHá» náº±m gáº§n nÃºm MID. Váº·n vá»: 2.5kHz cho VOCAL, 3kHz cho GUITAR. Náº¿u tiáº¿ng Ä‘á»¥c thÃ¬ váº·n vá» 400Hz Ä‘á»ƒ cáº¯t "bÃ¹n".',v:{r:30,x:'TÃ¬m váº¡ch 2.5k hoáº·c 3k\nNáº¿u Ä‘á»¥c: chá»n 400Hz'}},
      {t:'4. â¬†ï¸ TÄ‚NG MID - Giá»ng rÃµ hÆ¡n!',d:'Váº·n nÃºm MID sang PHáº¢I vá» hÆ°á»›ng 1-2 giá». Giá»ng hÃ¡t sáº½ dÃ y hÆ¡n, rÃµ tá»«ng chá»¯ hÆ¡n. Guitar sáº½ cÃ³ thÃ¢n tiáº¿ng hÆ¡n.',v:{r:60,x:'Váº·n MID sang PHáº¢I\nâ†’ 1/4 vÃ²ng (tá»« 12h vá» 2-3h)\nâ†’ Khoáº£ng 45-60 Ä‘á»™'}},
      {t:'5. âœ¨ ThÃªm HI (Treble) - ThÃªm sÃ¡ng',d:'Váº·n nÃºm HI sang PHáº¢I NHáº¸ vá» hÆ°á»›ng 1 giá». ThÃªm Ä‘á»™ sÃ¡ng, "air" cho giá»ng/Ä‘Ã n. Äá»«ng tÄƒng quÃ¡ nhiá»u sáº½ chÃ³i tai!',v:{r:30,x:'Váº·n HI sang PHáº¢I NHáº¸\nâ†’ 1/8 vÃ²ng (tá»« 12h vá» 1h)\nâ†’ Khoáº£ng 20-30 Ä‘á»™'}},
      {t:'6. ğŸŒŠ Chá»‰nh FX Send (Reverb)',d:'NÃºm FX Ä‘iá»u khiá»ƒn lÆ°á»£ng reverb. VOCAL: 25-30% (váº·n vá» 10-11h). GUITAR: 15-20% (váº·n vá» 9-10h). Äá»«ng Ä‘á»ƒ quÃ¡ nhiá»u reverb sáº½ bá»‹ "nhÃ²e"!',v:{r:-30,x:'VOCAL: FX á»Ÿ 10-11 giá»\nGUITAR: FX á»Ÿ 9-10 giá»\nâš ï¸ Ãt reverb = rÃµ hÆ¡n'}},
      {t:'7. ğŸ“Š CÃ¢n báº±ng Fader (Volume)',d:'KÃ©o fader VOCAL lÃªn váº¡ch 0dB (váº¡ch Ä‘áº­m, gá»i lÃ  Unity). Fader GUITAR Ä‘á»ƒ THáº¤P HÆ N khoáº£ng 1-2 váº¡ch Ä‘á»ƒ khÃ´ng láº¥n Ã¡t giá»ng hÃ¡t.',v:{r:0,x:'VOCAL: Fader á»Ÿ 0dB (Unity)\nGUITAR: Fader á»Ÿ -3 Ä‘áº¿n -5dB\nâ†’ Giá»ng hÃ¡t luÃ´n ná»•i hÆ¡n Ä‘Ã n'}}
    ];
    document.getElementById('stepsBox').innerHTML=steps.map((s,i)=>`<div class="step ${i===0?'active':''}" data-i="${i}"><div class="step-num">${i+1}</div><div class="step-content"><div class="step-title">${s.t}</div><div class="step-desc">${s.d}</div><div class="step-visual"><div class="step-vis-knob"><div class="step-vis-ptr" style="transform:translateX(-50%) rotate(${s.v.r}deg)"></div></div><div class="step-vis-text" style="white-space:pre-line;font-size:0.7rem;line-height:1.4">${s.v.x}</div></div><button class="step-btn" onclick="app.doneStep(${i})">âœ“ ÄÃ£ xong bÆ°á»›c nÃ y</button></div></div>`).join('');
  }
  doneStep(i){const ss=document.querySelectorAll('.step');ss[i].classList.remove('active');ss[i].classList.add('done');if(i<ss.length-1)ss[i+1].classList.add('active');}
  saveHist(){
    const sc=parseInt(document.getElementById('scoreNum').textContent)||0;
    this.hist.unshift({id:Date.now(),mode:this.mode,score:sc,dur:this.dur,time:new Date().toISOString()});
    if(this.hist.length>20)this.hist.pop();localStorage.setItem('ah',JSON.stringify(this.hist));this.renderHist();
  }
  renderHist(){
    const c=document.getElementById('histList');
    if(!this.hist.length){c.innerHTML='<div class="empty"><div class="empty-icon">ğŸ“Š</div><div>ChÆ°a cÃ³ lá»‹ch sá»­</div></div>';return;}
    c.innerHTML=this.hist.map(h=>{const d=new Date(h.time),ts=d.toLocaleDateString('vi-VN')+' '+d.toLocaleTimeString('vi-VN',{hour:'2-digit',minute:'2-digit'}),ml=h.mode==='vocal'?'ğŸ¤ Vocal':h.mode==='guitar'?'ğŸ¸ Guitar':'ğŸµ Full';let col='var(--green)';if(h.score<55)col='var(--red)';else if(h.score<75)col='var(--yellow)';return`<div class="history-item"><div class="history-score" style="color:${col}">${h.score}</div><div class="history-info"><div class="history-mode">${ml}</div><div class="history-time">${ts} â€¢ ${h.dur}s</div></div><button class="history-btn" onclick="app.delHist(${h.id})">ğŸ—‘ï¸</button></div>`;}).join('');
  }
  delHist(id){this.hist=this.hist.filter(h=>h.id!==id);localStorage.setItem('ah',JSON.stringify(this.hist));this.renderHist();}
  
  // COMPARE FEATURE
  saveCompare(type){
    const sc=parseInt(document.getElementById('scoreNum').textContent)||0;
    if(sc===0){alert('ChÆ°a cÃ³ káº¿t quáº£ phÃ¢n tÃ­ch! HÃ£y phÃ¢n tÃ­ch trÆ°á»›c.');return;}
    
    const bandsData={};
    Object.keys(this.bands).forEach(k=>{bandsData[k]=Math.round(this.bands[k].avg);});
    
    if(type==='before'){
      this.compareBefore={score:sc,bands:bandsData};
      document.getElementById('scoreBefore').textContent=sc;
      document.getElementById('scoreBefore').style.color=sc>=70?'var(--green)':sc>=50?'var(--yellow)':'var(--red)';
      document.getElementById('compareLeft').style.borderColor='var(--accent)';
    }else{
      this.compareAfter={score:sc,bands:bandsData};
      document.getElementById('scoreAfter').textContent=sc;
      document.getElementById('scoreAfter').style.color=sc>=70?'var(--green)':sc>=50?'var(--yellow)':'var(--red)';
      document.getElementById('compareRight').style.borderColor='var(--green)';
    }
    
    this.updateCompare();
  }
  
  updateCompare(){
    if(!this.compareBefore||!this.compareAfter)return;
    
    const diff=this.compareAfter.score-this.compareBefore.score;
    const el=document.getElementById('compareChange');
    const msg=document.getElementById('compareMsg');
    
    if(diff>0){
      el.innerHTML=`<span style="color:var(--green)">+${diff} Ä‘iá»ƒm ğŸ‰</span>`;
      msg.textContent=diff>=20?'Cáº£i thiá»‡n TUYá»†T Vá»œI! Giá»¯ nguyÃªn setting nÃ y!':diff>=10?'Cáº£i thiá»‡n tá»‘t! CÃ³ thá»ƒ chá»‰nh thÃªm.':'CÃ³ cáº£i thiá»‡n. Tiáº¿p tá»¥c chá»‰nh!';
    }else if(diff<0){
      el.innerHTML=`<span style="color:var(--red)">${diff} Ä‘iá»ƒm ğŸ˜¢</span>`;
      msg.textContent='Tá»‡ hÆ¡n trÆ°á»›c! HÃ£y quay láº¡i setting cÅ©.';
    }else{
      el.innerHTML=`<span style="color:var(--yellow)">KhÃ´ng Ä‘á»•i</span>`;
      msg.textContent='KhÃ´ng cÃ³ thay Ä‘á»•i. Thá»­ chá»‰nh khÃ¡c Ä‘i.';
    }
    
    // Show bands comparison
    document.getElementById('compareBands').style.display='block';
    const bandNames={bass:'Bass',lowMid:'Low-Mid',mid:'Mid',highMid:'Hi-Mid',high:'High'};
    document.getElementById('compareBandsList').innerHTML=Object.keys(bandNames).map(k=>{
      const before=this.compareBefore.bands[k]||0;
      const after=this.compareAfter.bands[k]||0;
      const target=this.targets[this.mode][k];
      const beforeDiff=Math.abs(before-target);
      const afterDiff=Math.abs(after-target);
      const improved=afterDiff<beforeDiff;
      const change=after-before;
      return`<div class="compare-band">
        <div class="compare-band-name">${bandNames[k]}</div>
        <div class="compare-band-bars">
          <div class="compare-band-bar" style="width:${before}%;background:var(--text3)"></div>
          <span style="font-size:0.6rem;color:var(--text3)">â†’</span>
          <div class="compare-band-bar" style="width:${after}%;background:${improved?'var(--green)':'var(--yellow)'}"></div>
        </div>
        <div class="compare-band-change" style="color:${improved?'var(--green)':'var(--yellow)'}">${change>0?'+':''}${change}%</div>
      </div>`;
    }).join('');
  }
  
  resetCompare(){
    this.compareBefore=null;this.compareAfter=null;
    document.getElementById('scoreBefore').textContent='--';
    document.getElementById('scoreBefore').style.color='var(--text3)';
    document.getElementById('scoreAfter').textContent='--';
    document.getElementById('scoreAfter').style.color='var(--text3)';
    document.getElementById('compareLeft').style.borderColor='var(--border)';
    document.getElementById('compareRight').style.borderColor='var(--border)';
    document.getElementById('compareChange').textContent='ChÆ°a cÃ³ dá»¯ liá»‡u';
    document.getElementById('compareMsg').textContent='PhÃ¢n tÃ­ch â†’ LÆ°u TRÆ¯á»šC â†’ Chá»‰nh mixer â†’ PhÃ¢n tÃ­ch láº¡i â†’ LÆ°u SAU';
    document.getElementById('compareBands').style.display='none';
  }
  
  // FEEDBACK DETECTION
  toggleFeedback(){
    if(this.fbRunning){this.stopFeedback();}else{this.startFeedback();}
  }
  
  async startFeedback(){
    try{
      this.fbStream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:false,noiseSuppression:false,autoGainControl:false}});
      this.fbCtx=new(window.AudioContext||window.webkitAudioContext)();
      this.fbAn=this.fbCtx.createAnalyser();this.fbAn.fftSize=8192;this.fbAn.smoothingTimeConstant=0.5;
      this.fbSrc=this.fbCtx.createMediaStreamSource(this.fbStream);this.fbSrc.connect(this.fbAn);
      this.fbData=new Uint8Array(this.fbAn.frequencyBinCount);
      this.fbRunning=true;this.fbPeaks=[];
      document.getElementById('feedbackBtn').classList.add('rec');
      document.getElementById('fbIcon').textContent='â¹ï¸';
      document.getElementById('fbText').textContent='Dá»ªNG TÃŒM FEEDBACK';
      this.fbCanvas=document.getElementById('fbCanvas');
      this.fbC=this.fbCanvas.getContext('2d');
      const r=this.fbCanvas.parentElement.getBoundingClientRect();
      this.fbCanvas.width=r.width*2;this.fbCanvas.height=120*2;this.fbC.scale(2,2);
      this.fbW=r.width;this.fbH=120;
      this.drawFeedback();
    }catch(e){alert('KhÃ´ng thá»ƒ truy cáº­p mic!');console.error(e);}
  }
  
  stopFeedback(){
    this.fbRunning=false;
    if(this.fbStream)this.fbStream.getTracks().forEach(t=>t.stop());
    if(this.fbCtx)this.fbCtx.close();
    document.getElementById('feedbackBtn').classList.remove('rec');
    document.getElementById('fbIcon').textContent='ğŸ¤';
    document.getElementById('fbText').textContent='Báº®T Äáº¦U TÃŒM FEEDBACK';
  }
  
  drawFeedback(){
    if(!this.fbRunning)return;
    requestAnimationFrame(()=>this.drawFeedback());
    this.fbAn.getByteFrequencyData(this.fbData);
    
    // Find peaks
    const peaks=[];const threshold=200;
    for(let i=10;i<this.fbData.length-10;i++){
      if(this.fbData[i]>threshold&&this.fbData[i]>this.fbData[i-1]&&this.fbData[i]>this.fbData[i+1]){
        const freq=i*this.fbCtx.sampleRate/this.fbAn.fftSize;
        if(freq>100&&freq<10000){peaks.push({freq,level:this.fbData[i]});}
      }
    }
    
    // Sort by level and keep top 5
    peaks.sort((a,b)=>b.level-a.level);
    const topPeaks=peaks.slice(0,5);
    
    // Update peaks history
    topPeaks.forEach(p=>{
      const existing=this.fbPeaks.find(x=>Math.abs(x.freq-p.freq)<100);
      if(existing){existing.count++;existing.level=Math.max(existing.level,p.level);}
      else{this.fbPeaks.push({...p,count:1});}
    });
    
    // Draw spectrum
    this.fbC.fillStyle='#0a0a12';this.fbC.fillRect(0,0,this.fbW,this.fbH);
    const bars=128,bw=this.fbW/bars;
    for(let i=0;i<bars;i++){
      const idx=Math.floor(Math.pow(i/bars,1.5)*this.fbData.length*0.3);
      const v=this.fbData[idx]/255;
      const h=v*this.fbH*0.9;
      const danger=v>0.78;
      this.fbC.fillStyle=danger?'rgba(255,56,96,0.9)':'rgba(0,200,255,0.6)';
      this.fbC.fillRect(i*bw+0.5,this.fbH-h,bw-1,h);
    }
    
    // Update feedback list
    const dangerous=this.fbPeaks.filter(p=>p.level>200&&p.count>3).sort((a,b)=>b.level-a.level).slice(0,5);
    if(dangerous.length>0){
      document.getElementById('feedbackList').innerHTML=dangerous.map(p=>{
        const freqName=this.getFreqName(p.freq);
        return`<div class="fb-item">
          <div class="fb-freq">${p.freq<1000?Math.round(p.freq)+'Hz':(p.freq/1000).toFixed(1)+'kHz'}</div>
          <div class="fb-info">
            <div class="fb-name">${freqName.name}</div>
            <div class="fb-level">${freqName.desc} â€¢ Äá»™ nguy hiá»ƒm: ${Math.round(p.level/255*100)}%</div>
          </div>
          <div class="fb-meter"><div class="fb-meter-fill" style="width:${p.level/255*100}%"></div></div>
        </div>`;
      }).join('');
      
      // Show solutions
      document.getElementById('feedbackTips').style.display='block';
      document.getElementById('feedbackSolutions').innerHTML=dangerous.slice(0,3).map(p=>{
        const sol=this.getFeedbackSolution(p.freq);
        return`<div class="tip"><span class="tip-icon">ğŸ”§</span><div>
          <div class="tip-title">${p.freq<1000?Math.round(p.freq)+'Hz':(p.freq/1000).toFixed(1)+'kHz'} - ${sol.title}</div>
          <div class="tip-text">${sol.action}</div>
        </div></div>`;
      }).join('');
    }
  }
  
  getFreqName(freq){
    if(freq<200)return{name:'Sub/Bass',desc:'Tiáº¿ng Ã¹ tráº§m'};
    if(freq<500)return{name:'Low-Mid',desc:'Tiáº¿ng Ã¹ Ä‘á»¥c'};
    if(freq<1000)return{name:'Mid',desc:'Tiáº¿ng hÃº tráº§m'};
    if(freq<2500)return{name:'Hi-Mid',desc:'Tiáº¿ng hÃº giá»¯a'};
    if(freq<5000)return{name:'Presence',desc:'Tiáº¿ng hÃº chÃ³i - PHá»” BIáº¾N!'};
    return{name:'Treble',desc:'Tiáº¿ng rÃ­t cao'};
  }
  
  getFeedbackSolution(freq){
    if(freq<200)return{title:'Giáº£m LO',action:'Váº·n nÃºm LO sang TRÃI ~1/4 vÃ²ng. Hoáº·c báº­t HPF.'};
    if(freq<500)return{title:'Cáº¯t Low-Mid',action:'Váº·n MID FREQ vá» 400Hz, giáº£m MID ~1/4 vÃ²ng TRÃI.'};
    if(freq<1000)return{title:'Giáº£m Mid nháº¹',action:'Váº·n MID FREQ vá» 800Hz-1kHz, giáº£m MID ~1/8 vÃ²ng.'};
    if(freq<2500)return{title:'Cáº¯t Hi-Mid',action:'Váº·n MID FREQ vá» '+(freq/1000).toFixed(1)+'kHz, giáº£m MID ~1/4 vÃ²ng TRÃI.'};
    if(freq<5000)return{title:'Cáº¯t Presence (Quan trá»ng!)',action:'Váº·n MID FREQ vá» '+(freq/1000).toFixed(1)+'kHz, giáº£m MID ~1/4 vÃ²ng. ÄÃ¢y lÃ  vÃ¹ng hay hÃº nháº¥t!'};
    return{title:'Giáº£m HI',action:'Váº·n nÃºm HI sang TRÃI ~1/8 vÃ²ng.'};
  }
  
  // LEARN FEATURE - LÆ°u Ã¢m thanh hay lÃ m chuáº©n
  learnFromCurrent(){
    // Check if we have analysis data
    const hasData = Object.values(this.bands).some(b => b.avg > 0);
    if(!hasData){
      alert('âš ï¸ ChÆ°a cÃ³ dá»¯ liá»‡u phÃ¢n tÃ­ch!\n\nHÃ£y:\n1. Nháº¥n "Báº¯t Ä‘áº§u phÃ¢n tÃ­ch"\n2. HÃ¡t/Ä‘Ã¡nh Ä‘Ã n 15-20 giÃ¢y\n3. Nháº¥n "Dá»«ng"\n4. Rá»“i má»›i nháº¥n "LÆ°u lÃ m chuáº©n"');
      return;
    }
    
    // Create custom target from current analysis
    this.customTarget = {
      bass: Math.round(this.bands.bass.avg),
      lowMid: Math.round(this.bands.lowMid.avg),
      mid: Math.round(this.bands.mid.avg),
      highMid: Math.round(this.bands.highMid.avg),
      high: Math.round(this.bands.high.avg),
      tol: 10,
      desc: 'Chuáº©n cá»§a tÃ´i - ' + new Date().toLocaleDateString('vi-VN'),
      savedAt: new Date().toISOString()
    };
    
    // Save to targets
    this.targets.custom = this.customTarget;
    
    // Persist to localStorage
    localStorage.setItem('customTarget', JSON.stringify(this.customTarget));
    localStorage.setItem('userTargets', JSON.stringify(this.targets));
    
    // Switch to custom mode
    this.mode = 'custom';
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('customModeBtn').classList.add('active');
    this.updateTargets();
    this.showCustomInfo();
    
    alert('âœ… ÄÃ£ lÆ°u thÃ nh cÃ´ng!\n\nÃ‚m thanh hiá»‡n táº¡i Ä‘Ã£ Ä‘Æ°á»£c lÆ°u lÃ m CHUáº¨N cá»§a báº¡n.\n\nTá»« giá» khi chá»n "â­ Cá»§a tÃ´i", app sáº½ so sÃ¡nh vá»›i chuáº©n nÃ y.');
  }
  
  resetToDefault(){
    if(!confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a chuáº©n tá»± táº¡o vÃ  quay vá» máº·c Ä‘á»‹nh?')) return;
    
    this.customTarget = null;
    this.targets = {...this.defaultTargets};
    
    localStorage.removeItem('customTarget');
    localStorage.removeItem('userTargets');
    
    // Switch back to vocal mode
    this.mode = 'vocal';
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
    document.querySelector('[data-m="vocal"]').classList.add('active');
    this.updateTargets();
    this.hideCustomInfo();
    
    alert('âœ… ÄÃ£ reset vá» máº·c Ä‘á»‹nh!');
  }
  
  showCustomInfo(){
    const panel = document.getElementById('customInfo');
    const details = document.getElementById('customDetails');
    if(this.customTarget){
      panel.style.display = 'block';
      const date = this.customTarget.savedAt ? new Date(this.customTarget.savedAt).toLocaleDateString('vi-VN') : 'N/A';
      details.innerHTML = `
        Bass: ${this.customTarget.bass}% | Low-Mid: ${this.customTarget.lowMid}% | Mid: ${this.customTarget.mid}%<br>
        Hi-Mid: ${this.customTarget.highMid}% | High: ${this.customTarget.high}%<br>
        <span style="color:var(--text3)">LÆ°u ngÃ y: ${date}</span>
      `;
    }
  }
  
  hideCustomInfo(){
    document.getElementById('customInfo').style.display = 'none';
  }
  
  initLearnPanel(){
    if(this.customTarget){
      this.targets.custom = this.customTarget;
      this.showCustomInfo();
    }
  }
  
  // ==================== HEADPHONE MODE ====================
  setHPType(type){
    this.hpType=type;
    document.querySelectorAll('.hp-type-btn').forEach(btn=>{
      btn.style.borderColor=btn.dataset.type===type?'var(--purple)':'var(--border)';
      btn.style.background=btn.dataset.type===type?'var(--purple)22':'var(--card)';
    });
  }
  
  updateHPSlider(band,value){
    this.hpRatings[band]=parseInt(value);
    const labels={
      '-3':'Ráº¥t thiáº¿u','-2':'Thiáº¿u','-1':'HÆ¡i thiáº¿u',
      '0':'Vá»«a Ä‘á»§',
      '1':'HÆ¡i thá»«a','2':'Thá»«a','3':'QuÃ¡ nhiá»u'
    };
    const labelMap={
      bass:{'-3':'Ráº¥t thiáº¿u bass','-2':'Thiáº¿u bass','-1':'HÆ¡i thiáº¿u bass','0':'Bass vá»«a Ä‘á»§','1':'HÆ¡i nhiá»u bass','2':'Nhiá»u bass','3':'QuÃ¡ nhiá»u bass'},
      mid:{'-3':'Giá»ng ráº¥t chÃ¬m','-2':'Giá»ng chÃ¬m','-1':'Giá»ng hÆ¡i chÃ¬m','0':'Giá»ng vá»«a Ä‘á»§','1':'Giá»ng hÆ¡i to','2':'Giá»ng to','3':'Giá»ng quÃ¡ chÃ³i'},
      treble:{'-3':'Ráº¥t tá»‘i, Ä‘á»¥c','-2':'Tá»‘i, Ä‘á»¥c','-1':'HÆ¡i tá»‘i','0':'Treble vá»«a Ä‘á»§','1':'HÆ¡i sÃ¡ng','2':'SÃ¡ng','3':'QuÃ¡ chÃ³i, xÃ¨n'},
      clarity:{'-3':'Ráº¥t Ä‘á»¥c, bÃ¹n','-2':'Äá»¥c, bÃ¹n','-1':'HÆ¡i Ä‘á»¥c','0':'Äá»™ rÃµ vá»«a Ä‘á»§','1':'HÆ¡i sáº¯c','2':'Sáº¯c nÃ©t','3':'QuÃ¡ sáº¯c'},
      loud:{'-3':'Ráº¥t nhá»','-2':'Nhá»','-1':'HÆ¡i nhá»','0':'Vá»«a Ä‘á»§','1':'HÆ¡i to','2':'To','3':'QuÃ¡ to'}
    };
    document.getElementById('hp'+band.charAt(0).toUpperCase()+band.slice(1)+'Label').textContent=labelMap[band][value];
  }
  
  analyzeHeadphone(){
    const r=this.hpRatings;
    const type=this.hpType;
    
    // Calculate EQ adjustments based on ratings
    // Negative rating = need more = positive EQ boost
    // Positive rating = too much = negative EQ cut
    let eq={b32:0,b64:0,b250:0,b1k:0,b2k:0,b4k:0,b8k:0,b16k:0};
    
    // Bass adjustment
    eq.b32=-r.bass*2.5;
    eq.b64=-r.bass*2;
    
    // Mid/Vocal adjustment  
    eq.b1k=-r.mid*1.5;
    eq.b2k=-r.mid*2;
    
    // Treble adjustment
    eq.b8k=-r.treble*2;
    eq.b16k=-r.treble*1.5;
    
    // Clarity adjustment (affects low-mid mud zone and presence)
    eq.b250=r.clarity*2; // Cut mud if too muddy, boost if too harsh
    eq.b4k=-r.clarity*1.5; // Opposite of 250Hz
    
    // Loudness perception (Fletcher-Munson compensation)
    if(r.loud<0){ // Sounds too quiet - boost bass and treble
      eq.b32+=(-r.loud)*1.5;
      eq.b64+=(-r.loud)*1;
      eq.b8k+=(-r.loud)*1;
    }
    
    // Content type adjustments
    const typeBoosts={
      music:{},
      podcast:{b1k:2,b2k:3,b4k:2,b250:-2}, // Boost voice clarity
      movie:{b32:2,b64:2,b4k:1}, // Boost bass for rumble, presence for dialog
      game:{b64:2,b2k:2,b8k:2}, // Boost bass, footsteps, spatial cues
      call:{b1k:3,b2k:4,b4k:3,b64:-2,b16k:-2}, // Heavy voice boost
      asmr:{b32:-2,b64:-1,b8k:3,b16k:4}, // Reduce bass, boost air
      audiobook:{b1k:3,b2k:4,b4k:3,b64:-1,b250:-2}, // Clear voice
      meditation:{b32:2,b64:2,b250:1,b8k:2,b16k:3}, // Warm, airy
      
      // Vietnamese music
      bolero:{b32:2,b64:3,b250:1,b1k:3,b2k:4,b4k:2,b8k:1,b16k:0}, // Warm vocal
      vpop:{b32:4,b64:4,b250:0,b1k:2,b2k:3,b4k:3,b8k:3,b16k:2}, // Modern pop
      vremix:{b32:7,b64:6,b250:-1,b1k:1,b2k:2,b4k:4,b8k:4,b16k:3}, // Heavy bass
      trieudu:{b32:2,b64:2,b250:1,b1k:3,b2k:4,b4k:3,b8k:2,b16k:1}, // Emotional vocal
      
      // International music  
      pop:{b32:3,b64:4,b250:0,b1k:2,b2k:3,b4k:3,b8k:3,b16k:2}, // Balanced modern
      rock:{b32:4,b64:5,b250:1,b1k:2,b2k:3,b4k:4,b8k:4,b16k:3}, // Punchy guitars
      hiphop:{b32:6,b64:6,b250:0,b1k:1,b2k:3,b4k:3,b8k:3,b16k:2}, // Heavy 808
      rnb:{b32:5,b64:5,b250:1,b1k:2,b2k:3,b4k:3,b8k:2,b16k:2}, // Smooth bass
      edm:{b32:7,b64:6,b250:-1,b1k:0,b2k:2,b4k:4,b8k:5,b16k:4}, // Festival sound
      jazz:{b32:3,b64:3,b250:2,b1k:2,b2k:2,b4k:2,b8k:3,b16k:3}, // Warm, detailed
      classical:{b32:2,b64:2,b250:1,b1k:1,b2k:2,b4k:3,b8k:4,b16k:4}, // Natural, airy
      country:{b32:3,b64:3,b250:2,b1k:3,b2k:3,b4k:3,b8k:3,b16k:2}, // Acoustic warmth
      kpop:{b32:4,b64:5,b250:-1,b1k:2,b2k:4,b4k:4,b8k:4,b16k:3}, // Bright, punchy
      jpop:{b32:3,b64:4,b250:0,b1k:2,b2k:3,b4k:4,b8k:4,b16k:3}, // Clear, bright
      cpop:{b32:3,b64:4,b250:1,b1k:3,b2k:3,b4k:3,b8k:3,b16k:2}, // Vocal focus
      latin:{b32:5,b64:5,b250:1,b1k:2,b2k:3,b4k:3,b8k:4,b16k:3}, // Rhythmic bass
      
      // Acoustic / Special
      acoustic:{b32:2,b64:2,b250:2,b1k:2,b2k:3,b4k:3,b8k:4,b16k:3}, // Natural
      lofi:{b32:4,b64:4,b250:2,b1k:1,b2k:2,b4k:2,b8k:2,b16k:1}, // Warm, mellow
      instrumental:{b32:3,b64:3,b250:1,b1k:2,b2k:2,b4k:3,b8k:4,b16k:4}, // Detailed
      metal:{b32:5,b64:6,b250:0,b1k:2,b2k:3,b4k:5,b8k:5,b16k:4}, // Aggressive
      
      // Cinema types
      cinema:{b32:4,b64:3,b250:-1,b1k:2,b2k:2,b4k:2,b8k:2,b16k:1}, // Standard cinema
      dolby:{b32:3,b64:3,b250:-2,b1k:1,b2k:3,b4k:4,b8k:5,b16k:4}, // Dolby Atmos - spatial
      imax:{b32:6,b64:5,b250:-1,b1k:2,b2k:3,b4k:4,b8k:4,b16k:3}, // IMAX - extreme bass
      surround:{b32:3,b64:2,b250:-2,b1k:1,b2k:3,b4k:5,b8k:5,b16k:5}, // Virtual 7.1
      action:{b32:7,b64:6,b250:-2,b1k:1,b2k:3,b4k:4,b8k:4,b16k:3}, // Action movies - explosions
      horror:{b32:5,b64:4,b250:1,b1k:0,b2k:2,b4k:3,b8k:5,b16k:5}, // Horror - creepy details
      scifi:{b32:5,b64:4,b250:-2,b1k:1,b2k:3,b4k:5,b8k:5,b16k:5}, // Sci-Fi - futuristic
      latenight:{b32:1,b64:1,b250:0,b1k:3,b2k:3,b4k:2,b8k:0,b16k:-1} // Late night - quiet bass
    };
    
    Object.keys(typeBoosts[type]||{}).forEach(k=>{
      eq[k]=(eq[k]||0)+typeBoosts[type][k];
    });
    
    // Clamp all values to -12 to +12
    Object.keys(eq).forEach(k=>{
      eq[k]=Math.max(-12,Math.min(12,Math.round(eq[k])));
    });
    
    // Update visual
    this.updateHPEQVisual(eq);
    
    // Generate explanation
    this.generateHPExplanation(eq,r,type);
    
    // Show results
    document.getElementById('hpResults').style.display='block';
  }
  
  updateHPEQVisual(eq){
    const dbToPos=(db)=>50-(db/12)*50;
    const bands=['32','64','250','1k','2k','4k','8k','16k'];
    const values=[eq.b32,eq.b64,eq.b250,eq.b1k,eq.b2k,eq.b4k,eq.b8k,eq.b16k];
    
    bands.forEach((band,i)=>{
      const slider=document.getElementById('hpeq_'+band);
      const valDisplay=document.getElementById('hpval_'+band);
      if(slider){
        const pos=dbToPos(values[i]);
        slider.style.top=pos+'%';
        slider.style.transform='translateX(-50%) translateY(-50%)';
        if(values[i]>3)slider.style.background='#ff3b30';
        else if(values[i]<-3)slider.style.background='#007aff';
        else slider.style.background='#34c759';
      }
      if(valDisplay){
        const v=values[i];
        valDisplay.textContent=(v>0?'+':'')+v;
        valDisplay.style.color=v>0?'#ff3b30':v<0?'#007aff':'#34c759';
      }
    });
    
    // Store for copy
    this.lastHPEQ=eq;
  }
  
  generateHPExplanation(eq,ratings,type){
    const typeNames={
      music:'nghe nháº¡c',podcast:'nghe podcast',movie:'xem phim',
      game:'chÆ¡i game',call:'gá»i Ä‘iá»‡n',asmr:'nghe ASMR/thÆ° giÃ£n',
      audiobook:'nghe sÃ¡ch nÃ³i',meditation:'thiá»n/thÆ° giÃ£n',
      // Vietnamese
      bolero:'nghe Bolero',vpop:'nghe V-Pop',vremix:'nghe Remix Viá»‡t',trieudu:'nghe nháº¡c trá»¯ tÃ¬nh',
      // International
      pop:'nghe Pop',rock:'nghe Rock',hiphop:'nghe Hip-hop',rnb:'nghe R&B',
      edm:'nghe EDM',jazz:'nghe Jazz',classical:'nghe Classical',country:'nghe Country',
      kpop:'nghe K-Pop',jpop:'nghe J-Pop',cpop:'nghe C-Pop',latin:'nghe Latin',
      // Acoustic/Special
      acoustic:'nghe Acoustic',lofi:'nghe Lo-Fi',instrumental:'nghe hÃ²a táº¥u',metal:'nghe Metal',
      // Cinema types
      cinema:'xem phim ráº¡p',dolby:'Dolby Atmos',imax:'IMAX',
      surround:'Surround 7.1',action:'phim hÃ nh Ä‘á»™ng',horror:'phim kinh dá»‹',
      scifi:'phim Sci-Fi',latenight:'xem phim Ä‘Ãªm'
    };
    
    let tips=[];
    
    // Genre-specific tips
    const genreTips={
      bolero:'ğŸ» <b>Bolero:</b> EQ áº¥m Ã¡p, giá»ng hÃ¡t rÃµ rÃ ng, cáº£m xÃºc',
      vpop:'ğŸ§ <b>V-Pop:</b> Bass máº¡nh, vocal sÃ¡ng nhÆ° hit Viá»‡t',
      vremix:'ğŸ’ƒ <b>Remix:</b> Bass cá»±c máº¡nh cho party!',
      hiphop:'ğŸ¤ <b>Hip-hop:</b> 808 bass náº·ng, vocal cáº¯t qua beat',
      edm:'ğŸ¹ <b>EDM:</b> Drop bass máº¡nh, treble sÃ¡ng',
      rock:'ğŸ¸ <b>Rock:</b> Guitar punchy, drums powerful',
      metal:'ğŸ¤˜ <b>Metal:</b> Bass/treble aggressive, mids scooped',
      jazz:'ğŸº <b>Jazz:</b> áº¤m Ã¡p, chi tiáº¿t tá»± nhiÃªn',
      classical:'ğŸ¼ <b>Classical:</b> Dynamic range rá»™ng, khÃ´ng gian',
      kpop:'ğŸ‡°ğŸ‡· <b>K-Pop:</b> SÃ¡ng, punchy nhÆ° sáº£n xuáº¥t HÃ n',
      lofi:'ğŸŒ§ï¸ <b>Lo-Fi:</b> Warm, mellow, relax',
      acoustic:'ğŸª• <b>Acoustic:</b> Tá»± nhiÃªn, chi tiáº¿t guitar/strings'
    };
    
    if(genreTips[type])tips.push(genreTips[type]);
    
    // Cinema-specific tips
    if(['cinema','dolby','imax','surround','action','horror','scifi','latenight'].includes(type)){
      if(type==='dolby')tips.push('ğŸ”Š <b>Dolby Atmos:</b> Báº­t Atmos trong Settings Ä‘á»ƒ cÃ³ khÃ´ng gian 3D');
      if(type==='imax')tips.push('ğŸ¦ <b>IMAX:</b> TÄƒng volume Ä‘á»ƒ cáº£m nháº­n full impact');
      if(type==='surround')tips.push('ğŸ§ <b>7.1 Virtual:</b> Táº¯t cÃ¡c surround khÃ¡c Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t');
      if(type==='action')tips.push('ğŸ’¥ <b>Action:</b> Chuáº©n bá»‹! Bass sáº½ ráº¥t máº¡nh khi ná»•');
      if(type==='horror')tips.push('ğŸ‘» <b>Horror:</b> Äeo tai nghe trong phÃ²ng tá»‘i Ä‘á»ƒ tráº£i nghiá»‡m tá»‘t nháº¥t');
      if(type==='latenight')tips.push('ğŸŒ™ <b>ÄÃªm:</b> Bass vÃ  treble Ä‘Ã£ Ä‘Æ°á»£c giáº£m Ä‘á»ƒ khÃ´ng lÃ m phiá»n ngÆ°á»i khÃ¡c');
    }
    
    // Bass tips
    if(eq.b32>3||eq.b64>3)tips.push('ğŸ”Š <b>TÄƒng bass</b> Ä‘á»ƒ cÃ³ Ä‘á»™ tráº§m tá»‘t hÆ¡n');
    if(eq.b32<-3||eq.b64<-3)tips.push('ğŸ”‰ <b>Giáº£m bass</b> Ä‘á»ƒ bá»›t Ã¹, rÃµ rÃ ng hÆ¡n');
    
    // Mid tips
    if(eq.b1k>3||eq.b2k>3)tips.push('ğŸ¤ <b>TÄƒng mid</b> Ä‘á»ƒ giá»ng/nháº¡c cá»¥ rÃµ hÆ¡n');
    if(eq.b1k<-3||eq.b2k<-3)tips.push('ğŸ¤ <b>Giáº£m mid</b> Ä‘á»ƒ bá»›t chÃ³i tai');
    
    // Treble tips
    if(eq.b8k>3||eq.b16k>3)tips.push('âœ¨ <b>TÄƒng treble</b> Ä‘á»ƒ sÃ¡ng vÃ  chi tiáº¿t hÆ¡n');
    if(eq.b8k<-3||eq.b16k<-3)tips.push('ğŸŒ™ <b>Giáº£m treble</b> Ä‘á»ƒ Ãªm tai hÆ¡n');
    
    // Clarity tips
    if(eq.b250>3)tips.push('ğŸ” <b>Giáº£m 250Hz</b> Ä‘á»ƒ bá»›t Ä‘á»¥c, rÃµ rÃ ng hÆ¡n');
    if(eq.b4k>3)tips.push('ğŸ¯ <b>TÄƒng 4kHz</b> Ä‘á»ƒ giá»ng cáº¯t qua mix');
    
    let presetRec='';
    const avgBass=(eq.b32+eq.b64)/2;
    const avgMid=(eq.b1k+eq.b2k)/2;
    const avgTreble=(eq.b8k+eq.b16k)/2;
    
    // Genre-specific preset names
    const genrePresets={
      bolero:'ğŸ» Bolero',vpop:'ğŸ§ V-Pop',vremix:'ğŸ’ƒ Remix Viá»‡t',trieudu:'ğŸ¤ Trá»¯ tÃ¬nh',
      pop:'ğŸµ Pop',rock:'ğŸ¸ Rock',hiphop:'ğŸ¤ Hip-hop',rnb:'ğŸ· R&B',
      edm:'ğŸ¹ EDM',jazz:'ğŸº Jazz',classical:'ğŸ¼ Classical',country:'ğŸ¤  Country',
      kpop:'ğŸ‡°ğŸ‡· K-Pop',jpop:'ğŸ‡¯ğŸ‡µ J-Pop',cpop:'ğŸ‡¨ğŸ‡³ C-Pop',latin:'ğŸ’ƒ Latin',
      acoustic:'ğŸª• Acoustic',lofi:'ğŸŒ§ï¸ Lo-Fi',instrumental:'ğŸ» HÃ²a táº¥u',metal:'ğŸ¤˜ Metal',
      podcast:'ğŸ™ï¸ Podcast',audiobook:'ğŸ“š Audiobook',meditation:'ğŸ§˜ Meditation',
      game:'ğŸ® Gaming',call:'ğŸ“ Voice Call',asmr:'ğŸ˜´ ASMR'
    };
    
    // Cinema-specific preset names
    const cinemaPresets={
      cinema:'ğŸ¬ Cinema Standard',dolby:'ğŸ”Š Dolby Atmos',imax:'ğŸ¦ IMAX',
      surround:'ğŸ§ Virtual 7.1',action:'ğŸ’¥ Action Movie',horror:'ğŸ‘» Horror',
      scifi:'ğŸš€ Sci-Fi',latenight:'ğŸŒ™ Late Night'
    };
    
    if(cinemaPresets[type]){
      presetRec=cinemaPresets[type];
    }else if(genrePresets[type]){
      presetRec=genrePresets[type];
    }else{
      if(avgBass>4)presetRec='ğŸ”Š Bass Boost';
      else if(avgMid>4)presetRec='ğŸ¤ Vocal/Speech';
      else if(avgTreble>4)presetRec='âœ¨ Treble Boost';
      else if(avgBass<-2&&avgTreble<-2)presetRec='ğŸŒ™ Night Mode';
      else presetRec='ğŸ“ Balanced';
    }
    
    document.getElementById('hpRecName').textContent=presetRec+' (cho '+(typeNames[type]||type)+')';
    
    let explanation=`<b>PhÃ¢n tÃ­ch:</b> Dá»±a trÃªn Ä‘Ã¡nh giÃ¡ cá»§a báº¡n khi ${typeNames[type]||type}, Ä‘Ã¢y lÃ  EQ Ä‘á» xuáº¥t.<br><br>`;
    if(tips.length>0){
      explanation+=tips.join('<br>')+'<br><br>';
    }
    explanation+=`<b>CÃ¡ch Ã¡p dá»¥ng:</b> VÃ o Settings â†’ EQ trÃªn Ä‘iá»‡n thoáº¡i vÃ  chá»‰nh theo giÃ¡ trá»‹ á»Ÿ trÃªn.`;
    
    document.getElementById('hpExplanation').innerHTML=explanation;
  }
  
  copyHPEQ(){
    if(!this.lastHPEQ){
      alert('ChÆ°a cÃ³ dá»¯ liá»‡u EQ!');return;
    }
    const eq=this.lastHPEQ;
    const text=`EQ Settings:
32Hz: ${eq.b32>0?'+':''}${eq.b32}dB
64Hz: ${eq.b64>0?'+':''}${eq.b64}dB  
250Hz: ${eq.b250>0?'+':''}${eq.b250}dB
1kHz: ${eq.b1k>0?'+':''}${eq.b1k}dB
2kHz: ${eq.b2k>0?'+':''}${eq.b2k}dB
4kHz: ${eq.b4k>0?'+':''}${eq.b4k}dB
8kHz: ${eq.b8k>0?'+':''}${eq.b8k}dB
16kHz: ${eq.b16k>0?'+':''}${eq.b16k}dB`;
    
    if(navigator.clipboard){
      navigator.clipboard.writeText(text).then(()=>{
        alert('âœ… ÄÃ£ copy EQ settings!');
      });
    }else{
      alert(text);
    }
  }
  
  resetHP(){
    this.hpRatings={bass:0,mid:0,treble:0,clarity:0,loud:0};
    ['hpBass','hpMid','hpTreble','hpClarity','hpLoud'].forEach(id=>{
      document.getElementById(id).value=0;
    });
    ['hpBassLabel','hpMidLabel','hpTrebleLabel','hpClarityLabel','hpLoudLabel'].forEach(id=>{
      document.getElementById(id).textContent='Vá»«a Ä‘á»§';
    });
    document.getElementById('hpResults').style.display='none';
  }
  
  // ==================== HEADPHONE AUTO ANALYZE ====================
  async toggleHPAnalyze(){
    if(this.hpRunning){
      this.stopHPAnalyze();
    }else{
      await this.startHPAnalyze();
    }
  }
  
  async startHPAnalyze(){
    try{
      const stream=await navigator.mediaDevices.getUserMedia({audio:true});
      this.hpAudioCtx=new(window.AudioContext||window.webkitAudioContext)();
      this.hpAnalyser=this.hpAudioCtx.createAnalyser();
      this.hpAnalyser.fftSize=4096;
      this.hpAnalyser.smoothingTimeConstant=0.8;
      
      const src=this.hpAudioCtx.createMediaStreamSource(stream);
      src.connect(this.hpAnalyser);
      this.hpStream=stream;
      
      // Setup canvas
      this.hpCanvasEl=document.getElementById('hpCanvas');
      this.hpCtx=this.hpCanvasEl.getContext('2d');
      const rc=this.hpCanvasEl.parentElement.getBoundingClientRect();
      const d=window.devicePixelRatio||1;
      this.hpCanvasEl.width=rc.width*d;
      this.hpCanvasEl.height=80*d;
      this.hpCtx.scale(d,d);
      this.hpCanvasW=rc.width;
      this.hpCanvasH=80;
      
      // Init bands
      this.hpBands={
        bass:{sum:0,cnt:0,avg:0},
        lowMid:{sum:0,cnt:0,avg:0},
        mid:{sum:0,cnt:0,avg:0},
        highMid:{sum:0,cnt:0,avg:0},
        high:{sum:0,cnt:0,avg:0}
      };
      this.hpDur=0;
      this.hpRunning=true;
      this.hpStartTime=Date.now();
      
      // Update UI
      document.getElementById('hpStartBtn').classList.add('active');
      document.getElementById('hpStartIcon').textContent='â¹ï¸';
      document.getElementById('hpStartText').textContent='Dá»ªNG PHÃ‚N TÃCH';
      document.getElementById('hpDot').style.background='var(--green)';
      document.getElementById('hpStatus').textContent='Äang phÃ¢n tÃ­ch...';
      
      this.hpAnalyzeLoop();
      
    }catch(e){
      alert('KhÃ´ng thá»ƒ truy cáº­p microphone: '+e.message);
    }
  }
  
  hpAnalyzeLoop(){
    if(!this.hpRunning)return;
    
    const bufLen=this.hpAnalyser.frequencyBinCount;
    const data=new Uint8Array(bufLen);
    this.hpAnalyser.getByteFrequencyData(data);
    
    const sr=this.hpAudioCtx.sampleRate;
    const binHz=sr/this.hpAnalyser.fftSize;
    
    // Calculate band averages
    const getBand=(lo,hi)=>{
      let sum=0,cnt=0;
      for(let i=0;i<bufLen;i++){
        const f=i*binHz;
        if(f>=lo&&f<hi){sum+=data[i];cnt++;}
      }
      return cnt?sum/cnt/2.55:0;
    };
    
    const bass=getBand(20,150);
    const lowMid=getBand(150,500);
    const mid=getBand(500,2000);
    const highMid=getBand(2000,6000);
    const high=getBand(6000,20000);
    
    // Accumulate
    this.hpBands.bass.sum+=bass;this.hpBands.bass.cnt++;
    this.hpBands.lowMid.sum+=lowMid;this.hpBands.lowMid.cnt++;
    this.hpBands.mid.sum+=mid;this.hpBands.mid.cnt++;
    this.hpBands.highMid.sum+=highMid;this.hpBands.highMid.cnt++;
    this.hpBands.high.sum+=high;this.hpBands.high.cnt++;
    
    // Calculate dB
    let sum=0;for(let i=0;i<bufLen;i++)sum+=data[i];
    const avg=sum/bufLen;
    const db=avg>0?Math.round(20*Math.log10(avg/255)*10)/10:-60;
    
    // Update duration
    this.hpDur=Math.round((Date.now()-this.hpStartTime)/1000);
    document.getElementById('hpDur').textContent=this.hpDur+'s';
    document.getElementById('hpDb').textContent=db+'dB';
    
    // Draw spectrum
    this.drawHPSpectrum(data,bufLen,binHz);
    
    requestAnimationFrame(()=>this.hpAnalyzeLoop());
  }
  
  drawHPSpectrum(data,bufLen,binHz){
    const ctx=this.hpCtx;
    const w=this.hpCanvasW;
    const h=this.hpCanvasH;
    
    ctx.fillStyle='#1a1a2e';
    ctx.fillRect(0,0,w,h);
    
    const barW=w/80;
    const gap=1;
    
    for(let i=0;i<80;i++){
      const idx=Math.floor(i*bufLen/80);
      const val=data[idx]/255;
      const barH=val*h*0.9;
      
      const hue=280-i*2;
      ctx.fillStyle=`hsla(${hue},80%,60%,0.9)`;
      ctx.fillRect(i*(barW+gap),h-barH,barW,barH);
    }
  }
  
  stopHPAnalyze(){
    this.hpRunning=false;
    
    if(this.hpStream){
      this.hpStream.getTracks().forEach(t=>t.stop());
    }
    if(this.hpAudioCtx){
      this.hpAudioCtx.close();
    }
    
    // Update UI
    document.getElementById('hpStartBtn').classList.remove('active');
    document.getElementById('hpStartIcon').textContent='ğŸ™ï¸';
    document.getElementById('hpStartText').textContent='Báº®T Äáº¦U PHÃ‚N TÃCH';
    document.getElementById('hpDot').style.background='var(--text3)';
    document.getElementById('hpStatus').textContent='HoÃ n thÃ nh!';
    
    // Calculate averages
    Object.keys(this.hpBands).forEach(k=>{
      const b=this.hpBands[k];
      b.avg=b.cnt?b.sum/b.cnt:0;
    });
    
    // Generate EQ recommendation based on analysis
    this.generateHPAutoEQ();
  }
  
  generateHPAutoEQ(){
    const b=this.hpBands;
    const type=this.hpType;
    
    // Target values based on content type
    const targets={
      music:{bass:35,lowMid:30,mid:45,highMid:50,high:40},
      podcast:{bass:20,lowMid:25,mid:55,highMid:55,high:35},
      movie:{bass:45,lowMid:35,mid:45,highMid:50,high:45},
      game:{bass:40,lowMid:30,mid:45,highMid:55,high:50},
      call:{bass:20,lowMid:25,mid:55,highMid:60,high:35},
      asmr:{bass:25,lowMid:30,mid:40,highMid:45,high:55},
      audiobook:{bass:20,lowMid:25,mid:55,highMid:55,high:35},
      meditation:{bass:30,lowMid:32,mid:42,highMid:45,high:50},
      // Vietnamese
      bolero:{bass:35,lowMid:35,mid:50,highMid:52,high:40},
      vpop:{bass:42,lowMid:32,mid:48,highMid:52,high:45},
      vremix:{bass:55,lowMid:30,mid:42,highMid:52,high:48},
      trieudu:{bass:35,lowMid:35,mid:52,highMid:50,high:40},
      // International
      pop:{bass:40,lowMid:32,mid:48,highMid:52,high:45},
      rock:{bass:45,lowMid:35,mid:48,highMid:55,high:50},
      hiphop:{bass:55,lowMid:30,mid:45,highMid:52,high:45},
      rnb:{bass:50,lowMid:35,mid:48,highMid:50,high:42},
      edm:{bass:58,lowMid:28,mid:42,highMid:55,high:52},
      jazz:{bass:38,lowMid:35,mid:48,highMid:48,high:48},
      classical:{bass:35,lowMid:32,mid:45,highMid:50,high:52},
      country:{bass:38,lowMid:38,mid:50,highMid:50,high:45},
      kpop:{bass:45,lowMid:30,mid:48,highMid:55,high:50},
      jpop:{bass:40,lowMid:32,mid:48,highMid:52,high:48},
      cpop:{bass:40,lowMid:35,mid:50,highMid:50,high:42},
      latin:{bass:50,lowMid:35,mid:48,highMid:52,high:48},
      // Acoustic/Special
      acoustic:{bass:35,lowMid:35,mid:48,highMid:52,high:50},
      lofi:{bass:42,lowMid:38,mid:45,highMid:45,high:38},
      instrumental:{bass:38,lowMid:35,mid:48,highMid:52,high:52},
      metal:{bass:50,lowMid:32,mid:45,highMid:58,high:55},
      // Cinema
      cinema:{bass:45,lowMid:35,mid:48,highMid:52,high:45},
      dolby:{bass:48,lowMid:32,mid:48,highMid:55,high:52},
      imax:{bass:55,lowMid:35,mid:50,highMid:55,high:52},
      surround:{bass:45,lowMid:30,mid:48,highMid:55,high:55},
      action:{bass:58,lowMid:35,mid:45,highMid:55,high:50},
      horror:{bass:50,lowMid:38,mid:45,highMid:50,high:55},
      scifi:{bass:52,lowMid:32,mid:48,highMid:55,high:55},
      latenight:{bass:38,lowMid:35,mid:52,highMid:48,high:38}
    };
    
    const t=targets[type]||targets.music;
    
    // Calculate differences and convert to EQ
    const diff={
      bass:(t.bass-b.bass.avg)/8,
      lowMid:(t.lowMid-b.lowMid.avg)/8,
      mid:(t.mid-b.mid.avg)/8,
      highMid:(t.highMid-b.highMid.avg)/8,
      high:(t.high-b.high.avg)/8
    };
    
    const clamp=(v)=>Math.max(-12,Math.min(12,Math.round(v)));
    
    const eq={
      b32:clamp(diff.bass*1.5),
      b64:clamp(diff.bass*1.2),
      b250:clamp(diff.lowMid),
      b1k:clamp(diff.mid),
      b2k:clamp(diff.mid*0.8+diff.highMid*0.2),
      b4k:clamp(diff.highMid),
      b8k:clamp(diff.highMid*0.5+diff.high*0.5),
      b16k:clamp(diff.high)
    };
    
    // Update visual
    this.updateHPEQVisual(eq);
    
    // Generate explanation
    const typeNames={
      music:'nghe nháº¡c',podcast:'nghe podcast',movie:'xem phim',
      game:'chÆ¡i game',call:'gá»i Ä‘iá»‡n',asmr:'nghe ASMR',
      cinema:'xem phim ráº¡p',dolby:'Dolby Atmos',imax:'IMAX',
      surround:'Surround 7.1',action:'phim hÃ nh Ä‘á»™ng',horror:'phim kinh dá»‹',
      scifi:'phim Sci-Fi',latenight:'xem phim Ä‘Ãªm'
    };
    
    let explanation=`<b>PhÃ¢n tÃ­ch tá»± Ä‘á»™ng (${this.hpDur}s):</b><br>`;
    explanation+=`Bass: ${Math.round(b.bass.avg)}% | Mid: ${Math.round(b.mid.avg)}% | Treble: ${Math.round(b.high.avg)}%<br><br>`;
    explanation+=`<b>Äá» xuáº¥t EQ cho ${typeNames[type]}:</b><br>`;
    
    if(eq.b32>3||eq.b64>3)explanation+='ğŸ”Š TÄƒng bass Ä‘á»ƒ cÃ³ Ä‘á»™ tráº§m tá»‘t hÆ¡n<br>';
    if(eq.b32<-3||eq.b64<-3)explanation+='ğŸ”‰ Giáº£m bass Ä‘á»ƒ bá»›t Ã¹<br>';
    if(eq.b1k>3||eq.b2k>3)explanation+='ğŸ¤ TÄƒng mid Ä‘á»ƒ giá»ng rÃµ hÆ¡n<br>';
    if(eq.b8k>3||eq.b16k>3)explanation+='âœ¨ TÄƒng treble Ä‘á»ƒ sÃ¡ng hÆ¡n<br>';
    
    explanation+=`<br><b>CÃ¡ch Ã¡p dá»¥ng:</b> Copy EQ nÃ y sang Ä‘iá»‡n thoáº¡i, Ä‘eo tai nghe vÃ  nghe!`;
    
    document.getElementById('hpRecName').textContent=`ğŸ¯ Auto EQ (${typeNames[type]})`;
    document.getElementById('hpExplanation').innerHTML=explanation;
    document.getElementById('hpResults').style.display='block';
  }
}

// Initialize app
let app;
document.addEventListener('DOMContentLoaded', function() {
  app = new App();
  console.log('âœ… App initialized');
});
</script>
</body>
</html>
