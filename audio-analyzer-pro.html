<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0a0a12">
  <title>ğŸšï¸ Audio Analyzer Pro - Soundcraft EFX8</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    :root{--bg:#0a0a12;--card:#16161f;--card2:#1c1c28;--border:#2a2a3c;--accent:#00c8ff;--green:#00e878;--yellow:#ffc400;--red:#ff3860;--purple:#a855f7;--text:#fff;--text2:#9898b0;--text3:#5a5a70}
    body{font-family:-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
    .app{max-width:480px;margin:0 auto;padding-bottom:100px}
    .header{background:linear-gradient(180deg,#111 0%,transparent 100%);padding:16px;position:sticky;top:0;z-index:100;backdrop-filter:blur(20px);display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;background:linear-gradient(135deg,var(--accent),var(--purple));border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px}
    .header h1{font-size:1.1rem}
    .header p{font-size:0.7rem;color:var(--text3)}
    .nav{display:flex;gap:4px;padding:4px;margin:12px;background:var(--card);border-radius:12px}
    .nav-btn{flex:1;padding:10px 4px;background:transparent;border:none;border-radius:8px;color:var(--text3);font-size:0.7rem;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px}
    .nav-btn.active{background:var(--accent);color:#000}
    .nav-btn span:first-child{font-size:1.2rem}
    .section{display:none;padding:0 12px}
    .section.active{display:block}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:12px}
    .card-header{display:flex;align-items:center;gap:12px;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--border)}
    .card-icon{width:36px;height:36px;background:var(--card2);border-radius:8px;display:flex;align-items:center;justify-content:center}
    .card-title{font-size:0.95rem;font-weight:700}
    .card-sub{font-size:0.7rem;color:var(--text3)}
    .mode-sel{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:16px}
    .mode-btn{padding:14px 8px;background:var(--card);border:2px solid var(--border);border-radius:12px;color:var(--text2);font-size:0.8rem;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:6px}
    .mode-btn.active{background:rgba(0,200,255,0.15);border-color:var(--accent);color:var(--accent)}
    .mode-btn span:first-child{font-size:1.8rem}
    .start-btn{width:100%;padding:18px;margin-bottom:16px;background:linear-gradient(135deg,var(--accent),#0090ff);border:none;border-radius:16px;color:#000;font-size:1rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 4px 20px rgba(0,200,255,0.4)}
    .start-btn.rec{background:linear-gradient(135deg,var(--red),#ff0040);animation:pulse 1.5s infinite}
    @keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(255,56,96,0.5)}50%{box-shadow:0 0 0 15px rgba(255,56,96,0)}}
    .status{display:flex;justify-content:space-between;padding:12px 16px;background:#111;border-radius:12px;margin-bottom:16px;font-size:0.8rem}
    .status-dot{width:8px;height:8px;background:var(--text3);border-radius:50%;display:inline-block;margin-right:8px}
    .status-dot.on{background:var(--green);box-shadow:0 0 10px var(--green);animation:blink 1s infinite}
    @keyframes blink{50%{opacity:0.5}}
    .spectrum{background:var(--bg);border-radius:12px;margin-bottom:16px;padding:2px}
    #canvas{width:100%;height:140px;display:block}
    .bands{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
    .band{background:var(--card2);border-radius:8px;padding:10px 6px;text-align:center}
    .band-meter{height:70px;background:var(--bg);border-radius:6px;margin-bottom:6px;position:relative;overflow:hidden}
    .band-fill{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(to top,var(--green),var(--yellow),var(--red));transition:height 0.1s}
    .band-target{position:absolute;left:0;right:0;height:2px;background:var(--accent);box-shadow:0 0 6px var(--accent)}
    .band-name{font-size:0.55rem;color:var(--text3)}
    .band-val{font-size:0.75rem;font-weight:700}
    .band-sts{font-size:0.5rem;font-weight:700;padding:2px 6px;border-radius:4px;margin-top:4px;display:inline-block}
    .band-sts.ok{background:rgba(0,232,120,0.2);color:var(--green)}
    .band-sts.hi{background:rgba(255,56,96,0.2);color:var(--red)}
    .band-sts.lo{background:rgba(0,200,255,0.2);color:var(--accent)}
    .results{display:none}
    .results.show{display:block}
    .score-card{background:linear-gradient(135deg,var(--card),var(--card2));border-radius:20px;padding:24px;text-align:center;margin-bottom:16px}
    .score-ring{width:130px;height:130px;margin:0 auto 16px;position:relative}
    .score-ring svg{transform:rotate(-90deg);width:100%;height:100%}
    .score-bg{fill:none;stroke:var(--bg);stroke-width:8}
    .score-prog{fill:none;stroke:var(--green);stroke-width:8;stroke-linecap:round;stroke-dasharray:377;stroke-dashoffset:377;transition:all 1s}
    .score-inner{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
    .score-num{font-size:2.5rem;font-weight:700}
    .score-lbl{font-size:0.65rem;color:var(--text3);text-transform:uppercase}
    .score-msg{font-size:1rem;font-weight:700}
    .score-hint{font-size:0.8rem;color:var(--text2)}
    .problem{background:var(--card2);border-radius:12px;padding:14px;margin-bottom:10px;border-left:4px solid var(--yellow)}
    .problem.crit{border-left-color:var(--red)}
    .problem.good{border-left-color:var(--green)}
    .problem-head{display:flex;justify-content:space-between;margin-bottom:8px}
    .problem-title{font-size:0.9rem;font-weight:700}
    .problem-badge{font-size:0.6rem;font-weight:700;padding:4px 8px;border-radius:20px}
    .badge-crit{background:rgba(255,56,96,0.2);color:var(--red)}
    .badge-warn{background:rgba(255,196,0,0.2);color:var(--yellow)}
    .badge-good{background:rgba(0,232,120,0.2);color:var(--green)}
    .problem-desc{font-size:0.8rem;color:var(--text2);margin-bottom:12px}
    .solution{background:var(--card);border-radius:8px;padding:12px}
    .solution-label{font-size:0.75rem;font-weight:700;color:var(--accent);margin-bottom:8px}
    .sol-step{display:flex;align-items:flex-start;gap:10px;padding:10px;background:var(--card2);border-radius:8px;margin-bottom:8px}
    .sol-knob{width:44px;height:44px;background:linear-gradient(145deg,#3a3a4a,#28283a);border-radius:50%;position:relative;flex-shrink:0}
    .sol-knob-ptr{position:absolute;width:3px;height:14px;background:var(--accent);border-radius:2px;top:5px;left:50%;transform-origin:bottom center;box-shadow:0 0 6px var(--accent)}
    .sol-knob-lbl{position:absolute;bottom:-16px;left:50%;transform:translateX(-50%);font-size:0.55rem;font-weight:700;color:var(--text3);white-space:nowrap}
    .sol-info{flex:1}
    .sol-action{font-size:0.85rem;font-weight:700}
    .sol-detail{font-size:0.75rem;color:var(--text2)}
    .sol-turn{display:inline-flex;padding:3px 8px;background:rgba(0,200,255,0.15);border-radius:4px;font-size:0.7rem;font-weight:700;color:var(--accent);margin-top:6px}
    .mixer{background:linear-gradient(145deg,#1e1e2a,#16161f);border-radius:16px;padding:16px;margin-bottom:16px}
    .mixer-label{text-align:center;font-size:0.75rem;color:var(--accent);padding:8px;background:var(--bg);border-radius:8px;margin-bottom:16px;letter-spacing:2px}
    .channel{background:var(--card);border-radius:12px;padding:14px;margin-bottom:12px}
    .channel-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .channel-name{font-size:0.9rem;font-weight:700;display:flex;align-items:center;gap:8px}
    .channel-badge{padding:4px 10px;background:var(--accent);border-radius:20px;font-size:0.6rem;font-weight:700;color:#000}
    .knobs{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
    .knob-item{text-align:center}
    .knob{width:40px;height:40px;margin:0 auto 6px;background:linear-gradient(145deg,#3a3a4a,#28283a);border-radius:50%;position:relative;box-shadow:0 3px 8px rgba(0,0,0,0.4)}
    .knob-ptr{position:absolute;width:3px;height:12px;background:var(--accent);border-radius:2px;top:5px;left:50%;transform-origin:bottom center;box-shadow:0 0 6px var(--accent)}
    .knob-name{font-size:0.55rem;color:var(--text3)}
    .knob-val{font-size:0.7rem;font-weight:700}
    .knob-val.pos{color:var(--green)}
    .knob-val.neg{color:var(--red)}
    .knob-turn{font-size:0.5rem;color:var(--yellow)}
    .channel-freq{display:flex;justify-content:center;gap:8px;margin-top:12px;padding:8px;background:var(--card2);border-radius:8px;font-size:0.75rem}
    .channel-freq span:first-child{color:var(--text3)}
    .channel-freq span:last-child{font-weight:700;color:var(--purple)}
    .fx-panel{background:linear-gradient(135deg,rgba(168,85,247,0.1),transparent);border:1px solid rgba(168,85,247,0.3);border-radius:12px;padding:14px}
    .fx-head{display:flex;align-items:center;gap:8px;margin-bottom:12px;font-size:0.9rem;font-weight:700;color:var(--purple)}
    .fx-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .fx-item{background:var(--card);border-radius:8px;padding:10px}
    .fx-item-lbl{font-size:0.6rem;color:var(--text3)}
    .fx-item-val{font-size:0.85rem;font-weight:700;color:var(--purple)}
    .steps{display:flex;flex-direction:column;gap:10px}
    .step{display:flex;gap:12px;padding:14px;background:var(--card2);border-radius:12px;border:2px solid var(--border)}
    .step.active{border-color:var(--accent);background:rgba(0,200,255,0.05)}
    .step.done{border-color:var(--green);opacity:0.7}
    .step-num{width:32px;height:32px;background:var(--card);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;flex-shrink:0}
    .step.active .step-num{background:var(--accent);color:#000}
    .step.done .step-num{background:var(--green);color:#000}
    .step-content{flex:1}
    .step-title{font-size:0.9rem;font-weight:700;margin-bottom:4px}
    .step-desc{font-size:0.8rem;color:var(--text2);line-height:1.5;margin-bottom:10px}
    .step-visual{display:flex;align-items:center;gap:12px;padding:10px;background:var(--card);border-radius:8px;margin-bottom:10px}
    .step-vis-knob{width:36px;height:36px;background:linear-gradient(145deg,#3a3a4a,#28283a);border-radius:50%;position:relative;flex-shrink:0}
    .step-vis-ptr{position:absolute;width:3px;height:10px;background:var(--accent);border-radius:2px;top:5px;left:50%;transform-origin:bottom center}
    .step-vis-text{font-size:0.75rem}
    .step-btn{width:100%;padding:10px;background:var(--card);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.8rem;cursor:pointer}
    .step.done .step-btn{background:var(--green);color:#000}
    .clock-ref{display:flex;justify-content:center;gap:12px;padding:12px;background:var(--card);border-radius:12px;margin-bottom:16px}
    .clock-item{text-align:center}
    .clock-vis{width:32px;height:32px;background:var(--card2);border-radius:50%;margin:0 auto 4px;position:relative;border:2px solid var(--border)}
    .clock-hand{position:absolute;width:2px;height:10px;background:var(--accent);top:5px;left:50%;transform-origin:bottom center}
    .clock-val{font-size:0.65rem;font-weight:600}
    .clock-lbl{font-size:0.5rem;color:var(--text3)}
    .tip{display:flex;gap:12px;padding:12px;background:var(--card2);border-radius:10px;margin-bottom:8px}
    .tip-icon{font-size:1.3rem}
    .tip-title{font-size:0.8rem;font-weight:700;margin-bottom:4px}
    .tip-text{font-size:0.7rem;color:var(--text2);line-height:1.5}
    .history-item{display:flex;align-items:center;gap:12px;padding:12px;background:var(--card2);border-radius:10px;margin-bottom:8px}
    .history-score{width:44px;height:44px;background:var(--card);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1rem;font-weight:700}
    .history-info{flex:1}
    .history-mode{font-size:0.8rem;font-weight:600}
    .history-time{font-size:0.65rem;color:var(--text3)}
    .history-btn{padding:6px 10px;background:var(--card);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:0.7rem;cursor:pointer}
    .empty{text-align:center;padding:40px;color:var(--text3)}
    .empty-icon{font-size:2.5rem;margin-bottom:12px;opacity:0.5}
    .detail-tbl{width:100%;border-collapse:collapse;font-size:0.75rem}
    .detail-tbl th{padding:8px;background:var(--card2);text-align:left;color:var(--text3);border-bottom:1px solid var(--border)}
    .detail-tbl td{padding:8px;border-bottom:1px solid var(--border)}
    .detail-bar{height:6px;background:var(--bg);border-radius:3px;overflow:hidden}
    .detail-bar-fill{height:100%;border-radius:3px}
    .detail-sts{font-weight:700}
    .detail-sts.hi{color:var(--red)}
    .detail-sts.ok{color:var(--green)}
    .detail-sts.lo{color:var(--accent)}
    .fb-item{display:flex;align-items:center;gap:12px;padding:10px;background:var(--card);border-radius:8px;margin-bottom:8px;border-left:4px solid var(--red)}
    .fb-freq{font-size:1.1rem;font-weight:700;color:var(--red);min-width:70px}
    .fb-info{flex:1}
    .fb-name{font-size:0.8rem;font-weight:600}
    .fb-level{font-size:0.65rem;color:var(--text3)}
    .fb-meter{width:60px;height:8px;background:var(--bg);border-radius:4px;overflow:hidden}
    .fb-meter-fill{height:100%;background:linear-gradient(90deg,var(--yellow),var(--red));border-radius:4px}
    .compare-band{display:flex;align-items:center;gap:10px;padding:10px;background:var(--card);border-radius:8px;margin-bottom:8px}
    .compare-band-name{font-size:0.75rem;font-weight:600;width:70px}
    .compare-band-bars{flex:1;display:flex;gap:4px;align-items:center}
    .compare-band-bar{height:8px;border-radius:4px}
    .compare-band-change{font-size:0.7rem;font-weight:700;min-width:50px;text-align:right}
  </style>
</head>
<body>
<div class="app">
  <header class="header">
    <div class="logo">ğŸšï¸</div>
    <div><h1>Audio Analyzer Pro</h1><p>SOUNDCRAFT EFX8</p></div>
  </header>
  
  <nav class="nav">
    <button class="nav-btn active" data-s="analyze"><span>ğŸ“Š</span><span>PhÃ¢n TÃ­ch</span></button>
    <button class="nav-btn" data-s="compare"><span>âš–ï¸</span><span>So SÃ¡nh</span></button>
    <button class="nav-btn" data-s="feedback"><span>ğŸ”Š</span><span>Feedback</span></button>
    <button class="nav-btn" data-s="guide"><span>ğŸ›ï¸</span><span>HÆ°á»›ng Dáº«n</span></button>
    <button class="nav-btn" data-s="history"><span>ğŸ“‹</span><span>Lá»‹ch Sá»­</span></button>
  </nav>
  
  <section class="section active" id="s-analyze">
    <div class="mode-sel">
      <button class="mode-btn active" data-m="vocal"><span>ğŸ¤</span><span>Vocal</span></button>
      <button class="mode-btn" data-m="guitar"><span>ğŸ¸</span><span>Guitar</span></button>
      <button class="mode-btn" data-m="full"><span>ğŸµ</span><span>Full Mix</span></button>
    </div>
    <div class="mode-sel" style="margin-top:-8px">
      <button class="mode-btn" data-m="broadcast"><span>ğŸ“»</span><span>Broadcast</span></button>
      <button class="mode-btn" data-m="live"><span>ğŸª</span><span>Live</span></button>
      <button class="mode-btn" data-m="custom" id="customModeBtn" style="border-color:var(--purple)"><span>â­</span><span>Cá»§a tÃ´i</span></button>
    </div>
    
    <div id="learnPanel" style="background:linear-gradient(135deg,rgba(168,85,247,0.15),rgba(0,200,255,0.1));border:1px solid var(--purple);border-radius:12px;padding:14px;margin-bottom:16px">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
        <span style="font-size:1.3rem">ğŸ“</span>
        <div>
          <div style="font-size:0.9rem;font-weight:700;color:var(--purple)">Cháº¿ Ä‘á»™ Há»ŒC (Learn)</div>
          <div style="font-size:0.7rem;color:var(--text2)">Khi Ã¢m thanh HAY â†’ LÆ°u lÃ m chuáº©n cá»§a báº¡n</div>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <button onclick="app.learnFromCurrent()" style="padding:12px;background:var(--purple);border:none;border-radius:8px;color:#fff;font-weight:700;font-size:0.75rem;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px">
          <span>ğŸ’¾</span> LÆ°u lÃ m CHUáº¨N
        </button>
        <button onclick="app.resetToDefault()" style="padding:12px;background:var(--card2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.75rem;cursor:pointer">
          ğŸ”„ Reset vá» máº·c Ä‘á»‹nh
        </button>
      </div>
      <div id="customInfo" style="margin-top:10px;padding:10px;background:var(--card);border-radius:8px;font-size:0.7rem;display:none">
        <div style="color:var(--green);font-weight:700;margin-bottom:4px">âœ… ÄÃ£ cÃ³ chuáº©n cá»§a báº¡n!</div>
        <div id="customDetails" style="color:var(--text2)"></div>
      </div>
    </div>
    
    <button class="start-btn" id="startBtn"><span id="startIcon">ğŸ™ï¸</span><span id="startText">Báº®T Äáº¦U PHÃ‚N TÃCH</span></button>
    
    <div class="status">
      <div><span class="status-dot" id="dot"></span><span id="sts">Chá» káº¿t ná»‘i</span></div>
      <div>ğŸ”Š <span id="db">--dB</span></div>
      <div>â±ï¸ <span id="dur">0s</span></div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <div class="card-icon">ğŸ“ˆ</div>
        <div><div class="card-title">Phá»• Táº§n Sá»‘ Real-time</div><div class="card-sub">Frequency Spectrum</div></div>
      </div>
      <div class="spectrum"><canvas id="canvas"></canvas></div>
      <div class="bands">
        <div class="band"><div class="band-meter"><div class="band-fill" id="fBass"></div><div class="band-target" id="tBass"></div></div><div class="band-name">BASS</div><div class="band-val" id="vBass">0%</div><div class="band-sts ok" id="sBass">OK</div></div>
        <div class="band"><div class="band-meter"><div class="band-fill" id="fLowMid"></div><div class="band-target" id="tLowMid"></div></div><div class="band-name">LOW-MID</div><div class="band-val" id="vLowMid">0%</div><div class="band-sts ok" id="sLowMid">OK</div></div>
        <div class="band"><div class="band-meter"><div class="band-fill" id="fMid"></div><div class="band-target" id="tMid"></div></div><div class="band-name">MID</div><div class="band-val" id="vMid">0%</div><div class="band-sts ok" id="sMid">OK</div></div>
        <div class="band"><div class="band-meter"><div class="band-fill" id="fHighMid"></div><div class="band-target" id="tHighMid"></div></div><div class="band-name">HI-MID</div><div class="band-val" id="vHighMid">0%</div><div class="band-sts ok" id="sHighMid">OK</div></div>
        <div class="band"><div class="band-meter"><div class="band-fill" id="fHigh"></div><div class="band-target" id="tHigh"></div></div><div class="band-name">HIGH</div><div class="band-val" id="vHigh">0%</div><div class="band-sts ok" id="sHigh">OK</div></div>
      </div>
    </div>
    
    <div class="results" id="results">
      <div class="score-card">
        <div class="score-ring">
          <svg viewBox="0 0 130 130"><circle class="score-bg" cx="65" cy="65" r="60"/><circle class="score-prog" id="scoreRing" cx="65" cy="65" r="60"/></svg>
          <div class="score-inner"><div class="score-num" id="scoreNum">0</div><div class="score-lbl">ÄIá»‚M</div></div>
        </div>
        <div class="score-msg" id="scoreMsg">Äang phÃ¢n tÃ­ch...</div>
        <div class="score-hint" id="scoreHint">Vui lÃ²ng chá»</div>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-icon">ğŸ”</div><div><div class="card-title">Váº¥n Äá» & CÃ¡ch Sá»­a</div><div class="card-sub">Chi tiáº¿t váº·n nÃºm</div></div></div>
        <div id="probList"></div>
      </div>
    </div>
  </section>
  
  <section class="section" id="s-compare">
    <div class="card">
      <div class="card-header"><div class="card-icon">âš–ï¸</div><div><div class="card-title">So SÃ¡nh TRÆ¯á»šC / SAU</div><div class="card-sub">Xem hiá»‡u quáº£ chá»‰nh mixer</div></div></div>
      
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">
        <div style="background:var(--card2);border-radius:12px;padding:14px;text-align:center;border:2px solid var(--border)" id="compareLeft">
          <div style="font-size:0.7rem;color:var(--text3);margin-bottom:8px">TRÆ¯á»šC KHI CHá»ˆNH</div>
          <div style="font-size:2.5rem;font-weight:700;color:var(--text3)" id="scoreBefore">--</div>
          <div style="font-size:0.65rem;color:var(--text3)">Ä‘iá»ƒm</div>
          <button style="margin-top:12px;width:100%;padding:10px;background:var(--accent);border:none;border-radius:8px;color:#000;font-weight:700;font-size:0.75rem;cursor:pointer" onclick="app.saveCompare('before')">ğŸ“Œ LÆ°u káº¿t quáº£ TRÆ¯á»šC</button>
        </div>
        <div style="background:var(--card2);border-radius:12px;padding:14px;text-align:center;border:2px solid var(--border)" id="compareRight">
          <div style="font-size:0.7rem;color:var(--text3);margin-bottom:8px">SAU KHI CHá»ˆNH</div>
          <div style="font-size:2.5rem;font-weight:700;color:var(--text3)" id="scoreAfter">--</div>
          <div style="font-size:0.65rem;color:var(--text3)">Ä‘iá»ƒm</div>
          <button style="margin-top:12px;width:100%;padding:10px;background:var(--green);border:none;border-radius:8px;color:#000;font-weight:700;font-size:0.75rem;cursor:pointer" onclick="app.saveCompare('after')">ğŸ“Œ LÆ°u káº¿t quáº£ SAU</button>
        </div>
      </div>
      
      <div style="background:var(--card2);border-radius:12px;padding:16px;text-align:center;margin-bottom:16px" id="compareResult">
        <div style="font-size:0.8rem;color:var(--text3);margin-bottom:8px">Káº¾T QUáº¢ Cáº¢I THIá»†N</div>
        <div style="font-size:2rem;font-weight:700" id="compareChange">ChÆ°a cÃ³ dá»¯ liá»‡u</div>
        <div style="font-size:0.75rem;color:var(--text2);margin-top:8px" id="compareMsg">PhÃ¢n tÃ­ch â†’ LÆ°u TRÆ¯á»šC â†’ Chá»‰nh mixer â†’ PhÃ¢n tÃ­ch láº¡i â†’ LÆ°u SAU</div>
      </div>
      
      <div id="compareBands" style="display:none">
        <div style="font-size:0.8rem;font-weight:700;margin-bottom:12px">ğŸ“Š Chi tiáº¿t tá»«ng band:</div>
        <div id="compareBandsList"></div>
      </div>
      
      <button style="width:100%;padding:12px;background:var(--card2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.8rem;cursor:pointer;margin-top:12px" onclick="app.resetCompare()">ğŸ”„ Reset so sÃ¡nh</button>
    </div>
    
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ’¡</div><div><div class="card-title">CÃ¡ch sá»­ dá»¥ng</div><div class="card-sub">Quy trÃ¬nh so sÃ¡nh</div></div></div>
      <div class="tip"><span class="tip-icon">1ï¸âƒ£</span><div><div class="tip-title">PhÃ¢n tÃ­ch láº§n 1</div><div class="tip-text">Quay láº¡i tab PhÃ¢n TÃ­ch, thu Ã¢m 15-20 giÃ¢y vá»›i setting hiá»‡n táº¡i.</div></div></div>
      <div class="tip"><span class="tip-icon">2ï¸âƒ£</span><div><div class="tip-title">LÆ°u káº¿t quáº£ TRÆ¯á»šC</div><div class="tip-text">Nháº¥n nÃºt "LÆ°u káº¿t quáº£ TRÆ¯á»šC" Ä‘á»ƒ ghi nhá»› Ä‘iá»ƒm sá»‘ ban Ä‘áº§u.</div></div></div>
      <div class="tip"><span class="tip-icon">3ï¸âƒ£</span><div><div class="tip-title">Chá»‰nh mixer</div><div class="tip-text">VÃ o tab HÆ°á»›ng Dáº«n, lÃ m theo cÃ¡c bÆ°á»›c chá»‰nh mixer.</div></div></div>
      <div class="tip"><span class="tip-icon">4ï¸âƒ£</span><div><div class="tip-title">PhÃ¢n tÃ­ch láº§n 2</div><div class="tip-text">Quay láº¡i tab PhÃ¢n TÃ­ch, thu Ã¢m láº¡i vá»›i setting má»›i.</div></div></div>
      <div class="tip"><span class="tip-icon">5ï¸âƒ£</span><div><div class="tip-title">LÆ°u káº¿t quáº£ SAU</div><div class="tip-text">Nháº¥n "LÆ°u káº¿t quáº£ SAU" Ä‘á»ƒ xem má»©c cáº£i thiá»‡n!</div></div></div>
    </div>
  </section>
  
  <section class="section" id="s-feedback">
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ”Š</div><div><div class="card-title">PhÃ¡t Hiá»‡n Feedback</div><div class="card-sub">TÃ¬m táº§n sá»‘ dá»… bá»‹ hÃº</div></div></div>
      
      <button class="start-btn" id="feedbackBtn" onclick="app.toggleFeedback()">
        <span id="fbIcon">ğŸ¤</span>
        <span id="fbText">Báº®T Äáº¦U TÃŒM FEEDBACK</span>
      </button>
      
      <div style="background:var(--bg);border-radius:12px;padding:2px;margin-bottom:16px">
        <canvas id="fbCanvas" style="width:100%;height:120px;display:block"></canvas>
      </div>
      
      <div style="background:var(--card2);border-radius:12px;padding:14px;margin-bottom:16px">
        <div style="font-size:0.8rem;font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:8px">
          <span>âš ï¸</span> Táº¦N Sá» NGUY HIá»‚M (Dá»… hÃº)
        </div>
        <div id="feedbackList">
          <div style="text-align:center;color:var(--text3);padding:20px;font-size:0.8rem">
            Nháº¥n "Báº¯t Ä‘áº§u" vÃ  tÄƒng dáº§n volume Ä‘á»ƒ tÃ¬m Ä‘iá»ƒm feedback
          </div>
        </div>
      </div>
      
      <div id="feedbackTips" style="display:none">
        <div style="font-size:0.8rem;font-weight:700;margin-bottom:12px">ğŸ› ï¸ CÃ¡ch xá»­ lÃ½ Feedback:</div>
        <div id="feedbackSolutions"></div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ“š</div><div><div class="card-title">Kiáº¿n thá»©c vá» Feedback</div><div class="card-sub">Hiá»ƒu Ä‘á»ƒ xá»­ lÃ½ tá»‘t hÆ¡n</div></div></div>
      <div class="tip"><span class="tip-icon">â“</span><div><div class="tip-title">Feedback lÃ  gÃ¬?</div><div class="tip-text">LÃ  hiá»‡n tÆ°á»£ng Ã¢m thanh tá»« loa quay láº¡i mic, táº¡o vÃ²ng láº·p vÃ  phÃ¡t ra tiáº¿ng hÃº chÃ³i tai. ThÆ°á»ng xáº£y ra á»Ÿ má»™t sá»‘ táº§n sá»‘ nháº¥t Ä‘á»‹nh.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ¯</span><div><div class="tip-title">Táº§n sá»‘ hay bá»‹ hÃº nháº¥t</div><div class="tip-text"><b>250-500Hz</b> (Ã¹ Ã¹), <b>1-2kHz</b> (hÃº tráº§m), <b>2.5-4kHz</b> (hÃº chÃ³i - phá»• biáº¿n nháº¥t!), <b>8kHz+</b> (rÃ­t tai)</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ”§</span><div><div class="tip-title">CÃ¡ch xá»­ lÃ½</div><div class="tip-text"><b>1.</b> Giáº£m volume tá»•ng. <b>2.</b> Di chuyá»ƒn mic xa loa hÆ¡n. <b>3.</b> Váº·n MID FREQ vá» táº§n sá»‘ hÃº vÃ  Cáº®T MID. <b>4.</b> Giáº£m FX/reverb.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ’¡</span><div><div class="tip-title">Máº¹o phÃ²ng trÃ¡nh</div><div class="tip-text">Äá»«ng Ä‘á»ƒ mic hÆ°á»›ng tháº³ng vÃ o loa. Sá»­ dá»¥ng mic cardioid (hÆ°á»›ng tÃ­nh). Giá»¯ khoáº£ng cÃ¡ch mic-loa Ã­t nháº¥t 2-3m.</div></div></div>
    </div>
  </section>
  
  <section class="section" id="s-guide">
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ•</div><div><div class="card-title">Quy Æ¯á»›c Vá»‹ TrÃ­ NÃºm</div><div class="card-sub">DÃ¹ng Ä‘á»“ng há»“ Ä‘á»ƒ dá»… hiá»ƒu</div></div></div>
      <div class="clock-ref">
        <div class="clock-item"><div class="clock-vis"><div class="clock-hand" style="transform:translateX(-50%) rotate(-90deg)"></div></div><div class="clock-val">9 giá»</div><div class="clock-lbl">Giáº£m max</div></div>
        <div class="clock-item"><div class="clock-vis"><div class="clock-hand" style="transform:translateX(-50%) rotate(-45deg)"></div></div><div class="clock-val">10-11h</div><div class="clock-lbl">Giáº£m nháº¹</div></div>
        <div class="clock-item"><div class="clock-vis"><div class="clock-hand" style="transform:translateX(-50%) rotate(0deg)"></div></div><div class="clock-val">12 giá»</div><div class="clock-lbl">Trung tÃ¢m</div></div>
        <div class="clock-item"><div class="clock-vis"><div class="clock-hand" style="transform:translateX(-50%) rotate(45deg)"></div></div><div class="clock-val">1-2 giá»</div><div class="clock-lbl">TÄƒng nháº¹</div></div>
        <div class="clock-item"><div class="clock-vis"><div class="clock-hand" style="transform:translateX(-50%) rotate(90deg)"></div></div><div class="clock-val">3 giá»</div><div class="clock-lbl">TÄƒng max</div></div>
      </div>
      <div style="padding:10px;background:var(--card2);border-radius:8px;font-size:0.75rem;color:var(--text2);line-height:1.8">
        <strong style="color:var(--accent)">ğŸ’¡ CÃCH Äá»ŒC Vá»Š TRÃ NÃšM:</strong><br>
        â€¢ <b>1/8 vÃ²ng</b> = 22.5Â° = tá»« 12h â†’ 1h (hoáº·c 12h â†’ 11h) - thay Ä‘á»•i NHáº¸<br>
        â€¢ <b>1/4 vÃ²ng</b> = 45Â° = tá»« 12h â†’ 3h (hoáº·c 12h â†’ 9h) - thay Ä‘á»•i Vá»ªA<br>
        â€¢ <b>3/8 vÃ²ng</b> = 67.5Â° = tá»« 12h gáº§n tá»›i 3h - thay Ä‘á»•i KHÃ NHIá»€U<br>
        â€¢ <b>1/2 vÃ²ng</b> = 90Â° = ná»­a vÃ²ng trÃ²n - thay Ä‘á»•i Tá»I ÄA<br><br>
        <strong style="color:var(--yellow)">âš ï¸ QUY Táº®C VÃ€NG:</strong><br>
        â€¢ <b>Váº·n TRÃI</b> = GIáº¢M = cáº¯t bá»›t táº§n sá»‘ Ä‘Ã³<br>
        â€¢ <b>Váº·n PHáº¢I</b> = TÄ‚NG = thÃªm táº§n sá»‘ Ä‘Ã³<br>
        â€¢ <b>12 giá»</b> = Vá»‹ trÃ­ trung tÃ¢m = 0dB = khÃ´ng thay Ä‘á»•i
      </div>
    </div>
    
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ›ï¸</div><div><div class="card-title">Gá»£i Ã Chá»‰nh Mixer</div><div class="card-sub">Dá»±a trÃªn phÃ¢n tÃ­ch</div></div></div>
      <div class="mixer">
        <div class="mixer-label">â•â• SOUNDCRAFT EFX8 â•â•</div>
        <div class="channel">
          <div class="channel-head"><div class="channel-name"><span>ğŸ¤</span>KÃŠNH VOCAL</div><div class="channel-badge">CH 1-2</div></div>
          <div class="knobs">
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kVGain" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">GAIN</div><div class="knob-val" id="vVGain">0</div><div class="knob-turn" id="tVGain"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kVHi" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">HI</div><div class="knob-val" id="vVHi">0dB</div><div class="knob-turn" id="tVHi"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kVMid" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">MID</div><div class="knob-val" id="vVMid">0dB</div><div class="knob-turn" id="tVMid"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kVLo" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">LO</div><div class="knob-val" id="vVLo">0dB</div><div class="knob-turn" id="tVLo"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kVFx" style="transform:translateX(-50%) rotate(-45deg)"></div></div><div class="knob-name">FX</div><div class="knob-val" id="vVFx">25%</div><div class="knob-turn" id="tVFx">11h</div></div>
          </div>
          <div class="channel-freq"><span>MID FREQ:</span><span id="fqV">2.5kHz</span></div>
          <div style="margin-top:8px;padding:8px;background:rgba(255,196,0,0.1);border-radius:6px;font-size:0.7rem;color:var(--yellow)">ğŸ’¡ <b>HPF (nÃºt báº¥m):</b> Náº¿u cÃ³, Báº¬T lÃªn Ä‘á»ƒ cáº¯t bass dÆ°á»›i 80Hz!</div>
        </div>
        <div class="channel">
          <div class="channel-head"><div class="channel-name"><span>ğŸ¸</span>KÃŠNH GUITAR</div><div class="channel-badge">CH 3-4</div></div>
          <div class="knobs">
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kGGain" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">GAIN</div><div class="knob-val" id="vGGain">0</div><div class="knob-turn" id="tGGain"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kGHi" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">HI</div><div class="knob-val" id="vGHi">0dB</div><div class="knob-turn" id="tGHi"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kGMid" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">MID</div><div class="knob-val" id="vGMid">0dB</div><div class="knob-turn" id="tGMid"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kGLo" style="transform:translateX(-50%) rotate(0)"></div></div><div class="knob-name">LO</div><div class="knob-val" id="vGLo">0dB</div><div class="knob-turn" id="tGLo"></div></div>
            <div class="knob-item"><div class="knob"><div class="knob-ptr" id="kGFx" style="transform:translateX(-50%) rotate(-60deg)"></div></div><div class="knob-name">FX</div><div class="knob-val" id="vGFx">15%</div><div class="knob-turn" id="tGFx">10h</div></div>
          </div>
          <div class="channel-freq"><span>MID FREQ:</span><span id="fqG">3kHz</span></div>
        </div>
        <div class="fx-panel">
          <div class="fx-head"><span>ğŸŒŠ</span>LEXICON FX (Reverb)</div>
          <div class="fx-grid">
            <div class="fx-item"><div class="fx-item-lbl">ChÆ°Æ¡ng trÃ¬nh</div><div class="fx-item-val" id="fxProg">Vocal Plate</div></div>
            <div class="fx-item"><div class="fx-item-lbl">FX Time (Decay)</div><div class="fx-item-val" id="fxTime">10 giá»</div></div>
            <div class="fx-item"><div class="fx-item-lbl">FX to Mix</div><div class="fx-item-val" id="fxMix">25%</div></div>
            <div class="fx-item"><div class="fx-item-lbl">Ghi chÃº</div><div class="fx-item-val" id="fxNote" style="font-size:0.65rem">Vang vá»«a</div></div>
          </div>
          <div style="margin-top:10px;padding:8px;background:var(--card);border-radius:6px;font-size:0.65rem;color:var(--text2);line-height:1.5">
            <b style="color:var(--purple)">ğŸ’¡ Chá»n Program:</b><br>
            â€¢ <b>Plate</b> - Vocal (ngáº¯n, áº¥m)<br>
            â€¢ <b>Hall</b> - PhÃ²ng lá»›n (dÃ i, rá»™ng)<br>
            â€¢ <b>Room</b> - PhÃ²ng nhá» (tá»± nhiÃªn)<br>
            <b style="color:var(--yellow)">âš ï¸ Ãt reverb = giá»ng RÃ• hÆ¡n!</b>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ“</div><div><div class="card-title">HÆ°á»›ng Dáº«n Tá»«ng BÆ°á»›c</div><div class="card-sub">LÃ m theo thá»© tá»±</div></div></div>
      <div class="steps" id="stepsBox"></div>
    </div>
  </section>
  
  <section class="section" id="s-detail">
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ“Š</div><div><div class="card-title">Báº£ng PhÃ¢n TÃ­ch Chi Tiáº¿t</div><div class="card-sub">Tá»«ng dáº£i táº§n</div></div></div>
      <table class="detail-tbl"><thead><tr><th>Táº§n sá»‘</th><th>Má»©c</th><th>Tráº¡ng thÃ¡i</th></tr></thead><tbody id="detailBody"></tbody></table>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ“š</div><div><div class="card-title">Giáº£i ThÃ­ch Táº§n Sá»‘</div><div class="card-sub">Hiá»ƒu Ä‘á»ƒ chá»‰nh tá»‘t</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ”´</span><div><div class="tip-title">Sub/Bass (20-150Hz) - Äá»™ dÃ y, Ä‘á»™ áº¥m</div><div class="tip-text"><b>QuÃ¡ nhiá»u = tiáº¿ng Ã¹ng á»¥c, náº·ng ná», Ä‘á»¥c.</b> Vá»›i vocal vÃ  guitar acoustic, LUÃ”N cáº¯t vÃ¹ng nÃ y báº±ng nÃºm LO. Chá»‰ cáº§n thiáº¿t cho bass guitar hoáº·c kick drum.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸŸ </span><div><div class="tip-title">Low-Mid (150-500Hz) - VÃ™NG "BÃ™N"!</div><div class="tip-text"><b>ÄÃ¢y lÃ  vÃ¹ng GÃ‚Y Äá»¤C nháº¥t - thÆ°á»ng pháº£i Cáº®T!</b> Váº·n MID FREQ vá» 400Hz rá»“i giáº£m MID. Cáº¯t vÃ¹ng nÃ y sáº½ lÃ m giá»ng/Ä‘Ã n trong hÆ¡n ngay láº­p tá»©c.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸŸ¢</span><div><div class="tip-title">Mid (500Hz-2kHz) - ThÃ¢n tiáº¿ng</div><div class="tip-text"><b>VÃ¹ng quan trá»ng cho vocal!</b> Chá»©a ngá»¯ Ã¢m, phá»¥ Ã¢m. Thiáº¿u = giá»ng má»ng, xa xÃ´i. Thá»«a = tiáº¿ng "há»™p", gÃ² bÃ³. TÄƒng nháº¹ Ä‘á»ƒ giá»ng dÃ y hÆ¡n.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ”µ</span><div><div class="tip-title">Hi-Mid (2-6kHz) - VÃ¹ng "PRESENCE"</div><div class="tip-text"><b>QUAN TRá»ŒNG: LÃ m giá»ng Cáº®T QUA mix!</b> TÄƒng vÃ¹ng nÃ y Ä‘á»ƒ giá»ng ná»•i báº­t, nghe rÃµ tá»«ng chá»¯. Váº·n MID FREQ vá» 2.5-4kHz vÃ  tÄƒng MID.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸŸ£</span><div><div class="tip-title">Treble/Air (6-20kHz) - Äá»™ sÃ¡ng</div><div class="tip-text">ThÃªm "sparkle", "air", Ä‘á»™ sÃ¡ng. <b>QuÃ¡ nhiá»u = chÃ³i tai, xÃ¨n xáº¹t.</b> TÄƒng vá»«a pháº£i báº±ng nÃºm HI Ä‘á»ƒ giá»ng/Ä‘Ã n sÃ¡ng hÆ¡n nhÆ°ng khÃ´ng chÃ³i.</div></div></div>
    </div>
  </section>
  
  <section class="section" id="s-history">
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ“</div><div><div class="card-title">Quy Chuáº©n ChuyÃªn Nghiá»‡p</div><div class="card-sub">Giáº£i thÃ­ch cÃ¡c tiÃªu chuáº©n</div></div></div>
      
      <div class="tip"><span class="tip-icon">ğŸ¤</span><div><div class="tip-title">Vocal Mode</div><div class="tip-text">Cáº¯t bass máº¡nh, tÄƒng presence (2-5kHz). Dá»±a trÃªn nguyÃªn táº¯c <b>vocal cutting through mix</b> - giá»ng hÃ¡t pháº£i ná»•i báº­t.</div></div></div>
      
      <div class="tip"><span class="tip-icon">ğŸ¸</span><div><div class="tip-title">Guitar Mode</div><div class="tip-text">Giá»¯ bass vá»«a pháº£i, tÄƒng hi-mid. Dá»±a trÃªn <b>acoustic guitar frequency response</b> chuáº©n 80Hz-12kHz.</div></div></div>
      
      <div class="tip"><span class="tip-icon">ğŸµ</span><div><div class="tip-title">Full Mix Mode</div><div class="tip-text">CÃ¢n báº±ng táº¥t cáº£ bands. Dá»±a trÃªn <b>Pink Noise Reference</b> - nÄƒng lÆ°á»£ng báº±ng nhau má»—i octave.</div></div></div>
      
      <div class="tip"><span class="tip-icon">ğŸ“»</span><div><div class="tip-title">Broadcast Mode</div><div class="tip-text">Chuáº©n <b>EBU R128 / -24 LUFS</b>. DÃ¹ng cho phÃ¡t thanh, podcast, YouTube. Ã‚m thanh rÃµ rÃ ng qua má»i thiáº¿t bá»‹.</div></div></div>
      
      <div class="tip"><span class="tip-icon">ğŸª</span><div><div class="tip-title">Live Mode</div><div class="tip-text">Cáº¯t low-mid máº¡nh Ä‘á»ƒ <b>chá»‘ng feedback</b>. TÄƒng tolerance vÃ¬ mÃ´i trÆ°á»ng live thay Ä‘á»•i liÃªn tá»¥c.</div></div></div>
      
      <div class="tip"><span class="tip-icon">â­</span><div><div class="tip-title">Cá»§a tÃ´i (Custom)</div><div class="tip-text">Chuáº©n do Báº N tá»± táº¡o. Khi nÃ o tháº¥y Ã¢m thanh HAY â†’ nháº¥n "LÆ°u lÃ m chuáº©n". <b>ChÃ­nh xÃ¡c nháº¥t cho setup cá»§a báº¡n!</b></div></div></div>
      
      <div style="margin-top:12px;padding:12px;background:var(--card2);border-radius:8px;font-size:0.7rem;color:var(--text2);line-height:1.6">
        <b style="color:var(--accent)">ğŸ“š Tham kháº£o tá»«:</b><br>
        â€¢ <b>Fletcher-Munson Curves</b> - Äá»™ nháº¡y tai ngÆ°á»i theo táº§n sá»‘<br>
        â€¢ <b>Pink Noise Reference</b> - NÄƒng lÆ°á»£ng báº±ng nhau/octave<br>
        â€¢ <b>Bob Katz K-System</b> - Chuáº©n mastering chuyÃªn nghiá»‡p<br>
        â€¢ <b>EBU R128</b> - Chuáº©n loudness chÃ¢u Ã‚u<br>
        â€¢ <b>ITU-R BS.1770</b> - Chuáº©n Ä‘o loudness quá»‘c táº¿
      </div>
    </div>
    
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ“‹</div><div><div class="card-title">Lá»‹ch Sá»­ PhÃ¢n TÃ­ch</div><div class="card-sub">So sÃ¡nh trÆ°á»›c/sau</div></div></div>
      <div id="histList"><div class="empty"><div class="empty-icon">ğŸ“Š</div><div>ChÆ°a cÃ³ lá»‹ch sá»­</div></div></div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-icon">ğŸ’¡</div><div><div class="card-title">Máº¹o Sá»­ Dá»¥ng</div><div class="card-sub">Äá»ƒ chÃ­nh xÃ¡c hÆ¡n</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ“±</span><div><div class="tip-title">Vá»‹ trÃ­ Ä‘iá»‡n thoáº¡i khi Ä‘o</div><div class="tip-text">Äáº·t Ä‘iá»‡n thoáº¡i cÃ¡ch loa <b>1-2 mÃ©t</b>, hÆ°á»›ng mic (thÆ°á»ng á»Ÿ dÆ°á»›i Ä‘iá»‡n thoáº¡i) vá» phÃ­a loa. KhÃ´ng Ä‘á»ƒ quÃ¡ gáº§n (bá»‹ mÃ©o) hoáº·c quÃ¡ xa (nhiá»…u phÃ²ng nhiá»u).</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ”‡</span><div><div class="tip-title">Giáº£m nhiá»…u mÃ´i trÆ°á»ng</div><div class="tip-text"><b>Táº®T quáº¡t, mÃ¡y láº¡nh, TV</b> khi phÃ¢n tÃ­ch. PhÃ²ng cÃ ng yÃªn tÄ©nh, káº¿t quáº£ cÃ ng chÃ­nh xÃ¡c. ÄÃ³ng cá»­a sá»• náº¿u ngoÃ i Ä‘Æ°á»ng á»“n.</div></div></div>
      <div class="tip"><span class="tip-icon">â±ï¸</span><div><div class="tip-title">Thá»i gian phÃ¢n tÃ­ch</div><div class="tip-text">Thu Ã­t nháº¥t <b>15-20 giÃ¢y</b>. HÃ¡t/Ä‘Ã¡nh Ä‘Ã n LIÃŠN Tá»¤C, Ä‘á»«ng ngáº¯t quÃ£ng. HÃ¡t á»Ÿ má»©c Ã¢m lÆ°á»£ng bÃ¬nh thÆ°á»ng khi biá»ƒu diá»…n.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ”„</span><div><div class="tip-title">NguyÃªn táº¯c chá»‰nh</div><div class="tip-text"><b>Chá»‰nh 1 nÃºm â†’ Nghe â†’ PhÃ¢n tÃ­ch láº¡i.</b> Äá»«ng váº·n nhiá»u nÃºm cÃ¹ng lÃºc! Má»—i láº§n chá»‰ thay Ä‘á»•i 1 thá»© Ä‘á»ƒ biáº¿t cÃ¡i nÃ o hiá»‡u quáº£.</div></div></div>
      <div class="tip"><span class="tip-icon">âœ‚ï¸</span><div><div class="tip-title">NguyÃªn táº¯c "Cáº¯t trÆ°á»›c TÄƒng"</div><div class="tip-text"><b>LuÃ´n Cáº®T táº§n sá»‘ thá»«a trÆ°á»›c, rá»“i má»›i TÄ‚NG táº§n sá»‘ thiáº¿u.</b> VÃ­ dá»¥: Cáº¯t bass trÆ°á»›c, rá»“i má»›i tÄƒng mid/treble sau. Cáº¯t khÃ´ng gÃ¢y mÃ©o, tÄƒng cÃ³ thá»ƒ gÃ¢y mÃ©o.</div></div></div>
      <div class="tip"><span class="tip-icon">ğŸ‘‚</span><div><div class="tip-title">Tin vÃ o tai báº¡n!</div><div class="tip-text">App chá»‰ lÃ  cÃ´ng cá»¥ há»— trá»£. <b>Náº¿u tai báº¡n tháº¥y hay mÃ  Ä‘iá»ƒm tháº¥p = váº«n OK!</b> Má»¥c tiÃªu lÃ  Ã¢m thanh HAY, khÃ´ng pháº£i Ä‘iá»ƒm CAO.</div></div></div>
    </div>
  </section>
</div>

<script>
class App{
  constructor(){
    this.ctx=null;this.an=null;this.src=null;this.stream=null;this.data=null;this.running=false;
    this.canvas=document.getElementById('canvas');this.c=this.canvas.getContext('2d');
    this.mode='vocal';this.dur=0;this.timer=null;this.hist=JSON.parse(localStorage.getItem('ah')||'[]');
    this.bands={bass:{min:20,max:150,vals:[],avg:0},lowMid:{min:150,max:500,vals:[],avg:0},mid:{min:500,max:2000,vals:[],avg:0},highMid:{min:2000,max:6000,vals:[],avg:0},high:{min:6000,max:20000,vals:[],avg:0}};
    // Professional mixing targets based on:
    // - Pink noise reference (equal energy per octave)
    // - Fletcher-Munson equal loudness curves
    // - Industry mixing standards (broadcast -24 LUFS reference)
    // - Bob Katz K-System recommendations
    this.defaultTargets={
      vocal:{bass:18,lowMid:25,mid:52,highMid:55,high:35,tol:10,desc:'Giá»ng hÃ¡t rÃµ, cáº¯t qua mix'},
      guitar:{bass:28,lowMid:32,mid:45,highMid:52,high:40,tol:10,desc:'Guitar acoustic áº¥m, sÃ¡ng'},
      full:{bass:42,lowMid:38,mid:42,highMid:45,high:38,tol:12,desc:'Mix cÃ¢n báº±ng, tá»± nhiÃªn'},
      broadcast:{bass:35,lowMid:35,mid:45,highMid:48,high:40,tol:8,desc:'Chuáº©n phÃ¡t thanh -24 LUFS'},
      live:{bass:38,lowMid:30,mid:48,highMid:50,high:42,tol:15,desc:'Live performance, chá»‘ng feedback'}
    };
    this.customTarget=JSON.parse(localStorage.getItem('customTarget')||'null');
    this.targets=JSON.parse(localStorage.getItem('userTargets')||'null')||{...this.defaultTargets};
    this.compareBefore=null;this.compareAfter=null;
    this.fbRunning=false;this.fbPeaks=[];
    this.init();
  }
  init(){
    this.setupCanvas();this.setupEvents();this.updateTargets();this.genSteps();this.updateDetail();this.renderHist();this.initLearnPanel();
  }
  setupCanvas(){
    const r=()=>{const rc=this.canvas.parentElement.getBoundingClientRect();const d=window.devicePixelRatio||1;this.canvas.width=rc.width*d;this.canvas.height=140*d;this.c.scale(d,d);this.w=rc.width;this.h=140;};
    r();window.addEventListener('resize',r);
  }
  setupEvents(){
    document.getElementById('startBtn').onclick=()=>this.toggle();
    document.querySelectorAll('.mode-btn').forEach(b=>{
      b.onclick=e=>{
        document.querySelectorAll('.mode-btn').forEach(x=>x.classList.remove('active'));
        e.currentTarget.classList.add('active');
        this.mode=e.currentTarget.dataset.m;
        this.updateTargets();
        this.resetBands();
        // Handle custom info display
        if(this.mode==='custom'&&this.customTarget){
          this.showCustomInfo();
        }else{
          this.hideCustomInfo();
        }
      };
    });
    document.querySelectorAll('.nav-btn').forEach(b=>{
      b.onclick=e=>{
        const s=e.currentTarget.dataset.s;
        document.querySelectorAll('.nav-btn').forEach(x=>x.classList.remove('active'));
        document.querySelectorAll('.section').forEach(x=>x.classList.remove('active'));
        e.currentTarget.classList.add('active');
        document.getElementById('s-'+s).classList.add('active');
      };
    });
  }
  updateTargets(){
    const t=this.targets[this.mode];
    ['Bass','LowMid','Mid','HighMid','High'].forEach((n,i)=>{const k=['bass','lowMid','mid','highMid','high'][i];const el=document.getElementById('t'+n);if(el)el.style.bottom=t[k]+'%';});
  }
  resetBands(){Object.keys(this.bands).forEach(k=>{this.bands[k].vals=[];this.bands[k].avg=0;});}
  async start(){
    try{
      this.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:false,noiseSuppression:false,autoGainControl:false}});
      this.ctx=new(window.AudioContext||window.webkitAudioContext)();this.an=this.ctx.createAnalyser();this.an.fftSize=4096;this.an.smoothingTimeConstant=0.8;
      this.src=this.ctx.createMediaStreamSource(this.stream);this.src.connect(this.an);this.data=new Uint8Array(this.an.frequencyBinCount);
      this.running=true;this.dur=0;this.resetBands();this.updateUI(true);this.startTimer();this.draw();
    }catch(e){alert('KhÃ´ng thá»ƒ truy cáº­p mic!');console.error(e);}
  }
  stop(){this.running=false;this.stopTimer();if(this.stream)this.stream.getTracks().forEach(t=>t.stop());if(this.ctx)this.ctx.close();this.updateUI(false);this.genReport();this.saveHist();}
  toggle(){this.running?this.stop():this.start();}
  startTimer(){this.timer=setInterval(()=>{this.dur++;document.getElementById('dur').textContent=this.dur+'s';},1000);}
  stopTimer(){if(this.timer){clearInterval(this.timer);this.timer=null;}}
  updateUI(on){
    const btn=document.getElementById('startBtn'),icon=document.getElementById('startIcon'),txt=document.getElementById('startText'),dot=document.getElementById('dot'),sts=document.getElementById('sts');
    if(on){btn.classList.add('rec');icon.textContent='â¹ï¸';txt.textContent='Dá»ªNG PHÃ‚N TÃCH';dot.classList.add('on');sts.textContent='Äang thu...';document.getElementById('results').classList.remove('show');}
    else{btn.classList.remove('rec');icon.textContent='ğŸ™ï¸';txt.textContent='Báº®T Äáº¦U PHÃ‚N TÃCH';dot.classList.remove('on');sts.textContent='ÄÃ£ dá»«ng';}
  }
  fToI(f){return Math.round(f/(this.ctx.sampleRate/this.an.fftSize));}
  getBand(min,max){const mi=this.fToI(min),ma=Math.min(this.fToI(max),this.data.length-1);let s=0,c=0;for(let i=mi;i<=ma;i++){s+=this.data[i];c++;}return c>0?(s/c/255)*100:0;}
  analyze(){
    let total=0;
    Object.keys(this.bands).forEach(k=>{
      const b=this.bands[k],lv=this.getBand(b.min,b.max);b.vals.push(lv);if(b.vals.length>100)b.vals.shift();b.avg=b.vals.reduce((a,c)=>a+c,0)/b.vals.length;total+=lv;this.updateBandUI(k,lv);
    });
    const db=20*Math.log10((total/5)/100);document.getElementById('db').textContent=isFinite(db)?db.toFixed(1)+'dB':'--dB';this.updateDetail();
  }
  updateBandUI(k,lv){
    const nm={bass:'Bass',lowMid:'LowMid',mid:'Mid',highMid:'HighMid',high:'High'}[k],t=this.targets[this.mode][k],d=this.bands[k].avg-t,tol=this.targets[this.mode].tol;
    document.getElementById('f'+nm).style.height=Math.min(100,lv)+'%';document.getElementById('v'+nm).textContent=Math.round(this.bands[k].avg)+'%';
    const s=document.getElementById('s'+nm);if(Math.abs(d)<=tol){s.className='band-sts ok';s.textContent='OK';}else if(d>0){s.className='band-sts hi';s.textContent='THá»ªA';}else{s.className='band-sts lo';s.textContent='THIáº¾U';}
  }
  updateDetail(){
    const fd=[{n:'Sub Bass',r:'20-60Hz',k:'bass',m:0.4},{n:'Bass',r:'60-150Hz',k:'bass',m:0.6},{n:'Low-Mid',r:'150-500Hz',k:'lowMid',m:1},{n:'Mid',r:'500Hz-2kHz',k:'mid',m:1},{n:'Hi-Mid',r:'2-6kHz',k:'highMid',m:1},{n:'Treble',r:'6-12kHz',k:'high',m:0.7},{n:'Air',r:'12-20kHz',k:'high',m:0.3}];
    document.getElementById('detailBody').innerHTML=fd.map(f=>{const v=this.bands[f.k].avg*f.m,t=this.targets[this.mode][f.k]*f.m,d=v-t;let st,cl,co;if(Math.abs(d)<=10){st='OK';cl='ok';co='var(--green)';}else if(d>0){st='+'+Math.round(d)+'%';cl='hi';co='var(--red)';}else{st=Math.round(d)+'%';cl='lo';co='var(--accent)';}return`<tr><td><b>${f.n}</b><br><small style="color:var(--text3)">${f.r}</small></td><td><div class="detail-bar"><div class="detail-bar-fill" style="width:${Math.min(100,v)}%;background:${co}"></div></div></td><td class="detail-sts ${cl}">${st}</td></tr>`;}).join('');
  }
  draw(){
    if(!this.running)return;requestAnimationFrame(()=>this.draw());this.an.getByteFrequencyData(this.data);this.analyze();
    this.c.fillStyle='#0a0a12';this.c.fillRect(0,0,this.w,this.h);
    const bars=64,bw=this.w/bars;
    for(let i=0;i<bars;i++){const idx=Math.floor(Math.pow(i/bars,2)*this.data.length*0.5),v=this.data[idx]/255,ht=v*this.h*0.9;let hue;if(i<bars*0.15)hue=350;else if(i<bars*0.3)hue=40;else if(i<bars*0.5)hue=150;else if(i<bars*0.75)hue=190;else hue=270;const g=this.c.createLinearGradient(0,this.h,0,this.h-ht);g.addColorStop(0,`hsla(${hue},100%,50%,0.9)`);g.addColorStop(1,`hsla(${hue},100%,70%,0.6)`);this.c.fillStyle=g;this.c.fillRect(i*bw+1,this.h-ht,bw-2,ht);}
  }
  dbToTurn(db){const a=Math.abs(db),dir=db>0?'pháº£i':'trÃ¡i',act=db>0?'TÄƒng':'Giáº£m';if(a<1)return{txt:'Giá»¯ nguyÃªn',clk:'12h',trn:''};if(a<=3)return{txt:`Váº·n ${dir} ~1/8 vÃ²ng`,clk:db>0?'1h':'11h',trn:`${act} ~${Math.round(a)}dB`};if(a<=6)return{txt:`Váº·n ${dir} ~1/4 vÃ²ng`,clk:db>0?'2h':'10h',trn:`${act} ~${Math.round(a)}dB`};if(a<=9)return{txt:`Váº·n ${dir} ~3/8 vÃ²ng`,clk:db>0?'2-3h':'9-10h',trn:`${act} ~${Math.round(a)}dB`};return{txt:`Váº·n ${dir} ~1/2 vÃ²ng`,clk:db>0?'3h':'9h',trn:`${act} max`};}
  dbToRot(db){return(db/15)*135;}
  genReport(){
    const t=this.targets[this.mode],tol=t.tol,probs=[];
    const calcEQ=(k,mx=12)=>{const d=t[k]-this.bands[k].avg;return Math.max(-mx,Math.min(mx,d/4));};
    const eqV={hi:calcEQ('high',6),mid:calcEQ('mid',6)+calcEQ('highMid',6)/2,lo:-(this.bands.bass.avg-t.bass)/3-(this.bands.lowMid.avg-t.lowMid)/4};
    const eqG={hi:calcEQ('high',4),mid:calcEQ('highMid',4),lo:calcEQ('bass',6)};
    const bn={bass:'Bass (20-150Hz)',lowMid:'Low-Mid (150-500Hz)',mid:'Mid (500Hz-2kHz)',highMid:'Hi-Mid (2-6kHz)',high:'Treble (6-20kHz)'};
    const sols={bass:{high:{t:'ğŸ”´ Giáº£m nÃºm LO - Loáº¡i bá» tiáº¿ng Ã¹ng á»¥c',s:[{k:'LO',a:'Váº·n TRÃI tá»« tá»«',d:'Báº¯t Ä‘áº§u tá»« 12h, váº·n dáº§n vá» 9-10h. Nghe tháº¥y tiáº¿ng bá»›t náº·ng lÃ  Ä‘Æ°á»£c.',tr:'1/4 vÃ²ng TRÃI (45Â°)'},{k:'HPF',a:'Báº¬T nÃºt HPF (náº¿u cÃ³)',d:'High Pass Filter cáº¯t táº§n sá»‘ dÆ°á»›i 80Hz, giÃºp loáº¡i bá» tiáº¿ng Ã¹.',tr:'Nháº¥n nÃºt xuá»‘ng'}]},low:{t:'ğŸŸ¢ TÄƒng nÃºm LO nháº¹ - ThÃªm Ä‘á»™ áº¥m',s:[{k:'LO',a:'Váº·n PHáº¢I nháº¹',d:'Tá»« 12h vá» 1h. Cáº©n tháº­n Ä‘á»«ng tÄƒng quÃ¡ nhiá»u sáº½ bá»‹ Ã¹ng á»¥c.',tr:'1/8 vÃ²ng PHáº¢I (22Â°)'}]}},lowMid:{high:{t:'ğŸ”´ Cáº¯t vÃ¹ng "bÃ¹n" 200-500Hz - Ráº¤T QUAN TRá»ŒNG!',s:[{k:'MID FREQ',a:'Váº·n nÃºm nhá» vá» 400Hz',d:'TÃ¬m váº¡ch Ä‘Ã¡nh dáº¥u 400 hoáº·c 0.4k trÃªn mixer. ÄÃ¢y lÃ  táº§n sá»‘ gÃ¢y Ä‘á»¥c nháº¥t!',tr:'TÃ¬m vá»‹ trÃ­ 400Hz'},{k:'MID',a:'Váº·n TRÃI máº¡nh tay',d:'Tá»« 12h vá» 9-10h. ÄÃ¢y lÃ  bÆ°á»›c quan trá»ng nháº¥t Ä‘á»ƒ giá»ng/Ä‘Ã n rÃµ hÆ¡n.',tr:'1/4 Ä‘áº¿n 1/2 vÃ²ng TRÃI'}]},low:{t:'ğŸŸ¢ Low-Mid Ä‘ang tá»‘t',s:[{k:'MID',a:'Giá»¯ nguyÃªn vá»‹ trÃ­',d:'VÃ¹ng nÃ y thÆ°á»ng cáº§n cáº¯t. Náº¿u thiáº¿u thÃ¬ khÃ´ng cáº§n tÄƒng.',tr:'KhÃ´ng cáº§n chá»‰nh'}]}},mid:{high:{t:'ğŸŸ¡ Giáº£m MID nháº¹ - Bá»›t tiáº¿ng "há»™p"',s:[{k:'MID FREQ',a:'Váº·n vá» 1kHz',d:'TÃ¬m váº¡ch 1k hoáº·c 1000.',tr:'TÃ¬m vá»‹ trÃ­ 1kHz'},{k:'MID',a:'Váº·n TRÃI nháº¹',d:'Tá»« 12h vá» 11h. Chá»‰ giáº£m nháº¹ thÃ´i, Ä‘á»«ng cáº¯t quÃ¡ nhiá»u.',tr:'1/8 vÃ²ng TRÃI (22Â°)'}]},low:{t:'ğŸ”´ TÄƒng MID - Giá»ng/Ä‘Ã n sáº½ rÃµ hÆ¡n nhiá»u!',s:[{k:'MID FREQ',a:'Váº·n vá» 1-2kHz',d:'VÃ¹ng 1-2kHz lÃ  thÃ¢n tiáº¿ng cá»§a giá»ng hÃ¡t vÃ  guitar.',tr:'TÃ¬m vá»‹ trÃ­ 1-2kHz'},{k:'MID',a:'Váº·n PHáº¢I',d:'Tá»« 12h vá» 1-2h. Giá»ng sáº½ dÃ y vÃ  rÃµ rÃ ng hÆ¡n.',tr:'1/4 vÃ²ng PHáº¢I (45Â°)'}]}},highMid:{high:{t:'ğŸŸ¡ Giáº£m Hi-Mid - Bá»›t chÃ³i tai',s:[{k:'MID FREQ',a:'Váº·n vá» 3-4kHz',d:'TÃ¬m váº¡ch 3k hoáº·c 4k.',tr:'TÃ¬m vá»‹ trÃ­ 3-4kHz'},{k:'MID',a:'Váº·n TRÃI nháº¹',d:'Tá»« 12h vá» 11h. Sáº½ bá»›t chÃ³i vÃ  dá»… nghe hÆ¡n.',tr:'1/8 vÃ²ng TRÃI (22Â°)'}]},low:{t:'ğŸ”´ TÄƒng Hi-Mid - Giá»ng cáº¯t qua mix, nghe RÃ• hÆ¡n!',s:[{k:'MID FREQ',a:'Váº·n vá» 2.5-4kHz',d:'ÄÃ¢y lÃ  vÃ¹ng "presence" - lÃ m giá»ng ná»•i báº­t lÃªn trÃªn nháº¡c!',tr:'TÃ¬m vá»‹ trÃ­ 2.5-4kHz'},{k:'MID',a:'Váº·n PHáº¢I',d:'Tá»« 12h vá» 1-2h. Giá»ng sáº½ cáº¯t qua mix, nghe rÃµ tá»«ng chá»¯.',tr:'1/4 vÃ²ng PHáº¢I (45Â°)'}]}},high:{high:{t:'ğŸŸ¡ Giáº£m Treble - Bá»›t xÃ¨n xáº¹t',s:[{k:'HI',a:'Váº·n TRÃI',d:'Tá»« 12h vá» 10-11h. Giáº£m Ä‘á»™ chÃ³i, dá»… nghe hÆ¡n.',tr:'1/8 vÃ²ng TRÃI (22Â°)'}]},low:{t:'ğŸŸ¢ TÄƒng Treble - ThÃªm Ä‘á»™ sÃ¡ng, sparkle',s:[{k:'HI',a:'Váº·n PHáº¢I',d:'Tá»« 12h vá» 1-2h. ThÃªm "air" vÃ  Ä‘á»™ sÃ¡ng cho giá»ng/Ä‘Ã n.',tr:'1/4 vÃ²ng PHáº¢I (45Â°)'}}]}};
    let sc=0;
    Object.keys(this.bands).forEach(k=>{const avg=this.bands[k].avg,d=avg-t[k],bs=Math.max(0,100-Math.abs(d)*2.5);sc+=bs;if(Math.abs(d)>tol){const hi=d>0,sev=Math.abs(d)>tol*1.8?'crit':'warn',sol=sols[k][hi?'high':'low'];probs.push({k,n:bn[k],sev,hi,d:Math.round(d),avg:Math.round(avg),t:t[k],sol});}});
    sc=Math.round(sc/5);this.showScore(sc);this.showProbs(probs);this.updateMixer(eqV,eqG);this.genSteps(probs);document.getElementById('results').classList.add('show');
  }
  showScore(sc){
    const ring=document.getElementById('scoreRing'),num=document.getElementById('scoreNum'),msg=document.getElementById('scoreMsg'),hint=document.getElementById('scoreHint');
    const circ=2*Math.PI*60,off=circ-(sc/100)*circ;ring.style.strokeDashoffset=off;
    let col;if(sc>=80)col='var(--green)';else if(sc>=55)col='var(--yellow)';else col='var(--red)';ring.style.stroke=col;num.style.color=col;num.textContent=sc;
    if(sc>=85){msg.textContent='ğŸ‰ Xuáº¥t sáº¯c!';hint.textContent='Ã‚m thanh ráº¥t cÃ¢n báº±ng. Giá»¯ nguyÃªn setting nÃ y!';}else if(sc>=70){msg.textContent='ğŸ‘ KhÃ¡ tá»‘t!';hint.textContent='Gáº§n hoÃ n háº£o rá»“i! Chá»‰nh thÃªm chÃºt theo hÆ°á»›ng dáº«n.';}else if(sc>=55){msg.textContent='âš¡ Cáº§n Ä‘iá»u chá»‰nh';hint.textContent='CÃ³ váº¥n Ä‘á» cáº§n sá»­a. LÃ m theo hÆ°á»›ng dáº«n bÃªn dÆ°á»›i.';}else{msg.textContent='âš ï¸ Cáº§n chá»‰nh nhiá»u';hint.textContent='CÃ³ váº¥n Ä‘á» rÃµ rÃ ng. Xem chi tiáº¿t vÃ  lÃ m tá»«ng bÆ°á»›c.';}
  }
  showProbs(probs){
    const c=document.getElementById('probList');
    if(!probs.length){c.innerHTML='<div class="problem good"><div class="problem-head"><div class="problem-title">âœ… Ã‚m thanh cÃ¢n báº±ng!</div><span class="problem-badge badge-good">TUYá»†T</span></div><div class="problem-desc">Giá»¯ nguyÃªn setting hiá»‡n táº¡i!</div></div>';return;}
    probs.sort((a,b)=>a.sev==='crit'?-1:1);
    c.innerHTML=probs.map(p=>`<div class="problem ${p.sev}"><div class="problem-head"><div class="problem-title">${p.sev==='crit'?'ğŸ”´':'ğŸŸ¡'} ${p.n} ${p.hi?'THá»ªA':'THIáº¾U'}</div><span class="problem-badge badge-${p.sev}">${p.hi?'+':''}${p.d}%</span></div><div class="problem-desc">Hiá»‡n táº¡i: <b>${p.avg}%</b>, lÃ½ tÆ°á»Ÿng: <b>${p.t}%</b> â†’ ${p.hi?'Cáº§n GIáº¢M':'Cáº§n TÄ‚NG'}</div><div class="solution"><div class="solution-label">ğŸ”§ ${p.sol.t}</div>${p.sol.s.map(s=>`<div class="sol-step"><div class="sol-knob"><div class="sol-knob-ptr" style="transform:translateX(-50%) rotate(${s.a.includes('TRÃI')?-60:s.a.includes('PHáº¢I')?60:0}deg)"></div><div class="sol-knob-lbl">${s.k}</div></div><div class="sol-info"><div class="sol-action">${s.a}</div><div class="sol-detail">${s.d}</div>${s.tr?`<div class="sol-turn">â†» ${s.tr}</div>`:''}</div></div>`).join('')}</div></div>`).join('');
  }
  updateMixer(eqV,eqG){
    this.updateKnob('V','Gain',0,'0','');this.updateKnob('V','Hi',eqV.hi);this.updateKnob('V','Mid',eqV.mid);this.updateKnob('V','Lo',eqV.lo);
    this.updateKnob('G','Gain',0,'0','');this.updateKnob('G','Hi',eqG.hi);this.updateKnob('G','Mid',eqG.mid);this.updateKnob('G','Lo',eqG.lo);
    const cut=this.bands.lowMid.avg>this.targets[this.mode].lowMid+10;
    document.getElementById('fqV').textContent=cut?'400Hz (cáº¯t)':'2.5kHz';document.getElementById('fqG').textContent=cut?'500Hz (cáº¯t)':'3kHz';
    const mud=this.bands.lowMid.avg>this.targets[this.mode].lowMid+15;
    document.getElementById('fxProg').textContent=mud?'Plate':'Vocal Plate';document.getElementById('fxTime').textContent=mud?'9h':'10h';document.getElementById('fxMix').textContent=mud?'20%':'25%';document.getElementById('fxNote').textContent=mud?'Giáº£m vang':'Vang vá»«a';
  }
  updateKnob(ch,p,db,dv=null,tv=null){
    const knob=document.getElementById('k'+ch+p),val=document.getElementById('v'+ch+p),trn=document.getElementById('t'+ch+p);
    knob.style.transform=`translateX(-50%) rotate(${this.dbToRot(db)}deg)`;
    if(dv!==null){val.textContent=dv;val.className='knob-val';}else{const s=db>0?'+':'';val.textContent=s+Math.round(db)+'dB';val.className='knob-val '+(db>0?'pos':db<0?'neg':'');}
    if(trn){if(tv!==null)trn.textContent=tv;else{const t=this.dbToTurn(db);trn.textContent=t.trn||t.clk;}}
  }
  genSteps(){
    const steps=[
      {t:'1. ğŸšï¸ Kiá»ƒm tra GAIN (Äá»™ nháº¡y)',d:'HÃ¡t/Ä‘Ã n TO NHáº¤T cÃ³ thá»ƒ. NhÃ¬n Ä‘Ã¨n PEAK (Ä‘Ã¨n Ä‘á» nhá» gáº§n fader). Váº·n GAIN sao cho Ä‘Ã¨n PEAK chá»›p nhÃ¡y 1-2 láº§n khi hÃ¡t to, KHÃ”NG sÃ¡ng liÃªn tá»¥c.',v:{r:0,x:'âœ“ ÄÃ¨n peak chá»›p nháº¹ = ÄÃšNG\nâœ— SÃ¡ng liÃªn tá»¥c = Giáº£m GAIN\nâœ— KhÃ´ng sÃ¡ng = TÄƒng GAIN'}},
      {t:'2. ğŸ”´ Cáº®T BASS - QUAN TRá»ŒNG NHáº¤T!',d:'ÄÃ¢y lÃ  bÆ°á»›c quan trá»ng nháº¥t! Váº·n nÃºm LO sang TRÃI vá» hÆ°á»›ng 9-10 giá». Tiáº¿ng sáº½ bá»›t Ã¹ng á»¥c, náº·ng ná» ngay láº­p tá»©c.',v:{r:-90,x:'Váº·n LO sang TRÃI\nâ†’ 1/4 vÃ²ng (tá»« 12h vá» 9h)\nâ†’ Khoáº£ng 45 Ä‘á»™'}},
      {t:'3. ğŸ¯ Äáº·t MID FREQ (Táº§n sá»‘ trung tÃ¢m)',d:'NÃºm MID FREQ lÃ  nÃºm NHá» náº±m gáº§n nÃºm MID. Váº·n vá»: 2.5kHz cho VOCAL, 3kHz cho GUITAR. Náº¿u tiáº¿ng Ä‘á»¥c thÃ¬ váº·n vá» 400Hz Ä‘á»ƒ cáº¯t "bÃ¹n".',v:{r:30,x:'TÃ¬m váº¡ch 2.5k hoáº·c 3k\nNáº¿u Ä‘á»¥c: chá»n 400Hz'}},
      {t:'4. â¬†ï¸ TÄ‚NG MID - Giá»ng rÃµ hÆ¡n!',d:'Váº·n nÃºm MID sang PHáº¢I vá» hÆ°á»›ng 1-2 giá». Giá»ng hÃ¡t sáº½ dÃ y hÆ¡n, rÃµ tá»«ng chá»¯ hÆ¡n. Guitar sáº½ cÃ³ thÃ¢n tiáº¿ng hÆ¡n.',v:{r:60,x:'Váº·n MID sang PHáº¢I\nâ†’ 1/4 vÃ²ng (tá»« 12h vá» 2-3h)\nâ†’ Khoáº£ng 45-60 Ä‘á»™'}},
      {t:'5. âœ¨ ThÃªm HI (Treble) - ThÃªm sÃ¡ng',d:'Váº·n nÃºm HI sang PHáº¢I NHáº¸ vá» hÆ°á»›ng 1 giá». ThÃªm Ä‘á»™ sÃ¡ng, "air" cho giá»ng/Ä‘Ã n. Äá»«ng tÄƒng quÃ¡ nhiá»u sáº½ chÃ³i tai!',v:{r:30,x:'Váº·n HI sang PHáº¢I NHáº¸\nâ†’ 1/8 vÃ²ng (tá»« 12h vá» 1h)\nâ†’ Khoáº£ng 20-30 Ä‘á»™'}},
      {t:'6. ğŸŒŠ Chá»‰nh FX Send (Reverb)',d:'NÃºm FX Ä‘iá»u khiá»ƒn lÆ°á»£ng reverb. VOCAL: 25-30% (váº·n vá» 10-11h). GUITAR: 15-20% (váº·n vá» 9-10h). Äá»«ng Ä‘á»ƒ quÃ¡ nhiá»u reverb sáº½ bá»‹ "nhÃ²e"!',v:{r:-30,x:'VOCAL: FX á»Ÿ 10-11 giá»\nGUITAR: FX á»Ÿ 9-10 giá»\nâš ï¸ Ãt reverb = rÃµ hÆ¡n'}},
      {t:'7. ğŸ“Š CÃ¢n báº±ng Fader (Volume)',d:'KÃ©o fader VOCAL lÃªn váº¡ch 0dB (váº¡ch Ä‘áº­m, gá»i lÃ  Unity). Fader GUITAR Ä‘á»ƒ THáº¤P HÆ N khoáº£ng 1-2 váº¡ch Ä‘á»ƒ khÃ´ng láº¥n Ã¡t giá»ng hÃ¡t.',v:{r:0,x:'VOCAL: Fader á»Ÿ 0dB (Unity)\nGUITAR: Fader á»Ÿ -3 Ä‘áº¿n -5dB\nâ†’ Giá»ng hÃ¡t luÃ´n ná»•i hÆ¡n Ä‘Ã n'}}
    ];
    document.getElementById('stepsBox').innerHTML=steps.map((s,i)=>`<div class="step ${i===0?'active':''}" data-i="${i}"><div class="step-num">${i+1}</div><div class="step-content"><div class="step-title">${s.t}</div><div class="step-desc">${s.d}</div><div class="step-visual"><div class="step-vis-knob"><div class="step-vis-ptr" style="transform:translateX(-50%) rotate(${s.v.r}deg)"></div></div><div class="step-vis-text" style="white-space:pre-line;font-size:0.7rem;line-height:1.4">${s.v.x}</div></div><button class="step-btn" onclick="app.doneStep(${i})">âœ“ ÄÃ£ xong bÆ°á»›c nÃ y</button></div></div>`).join('');
  }
  doneStep(i){const ss=document.querySelectorAll('.step');ss[i].classList.remove('active');ss[i].classList.add('done');if(i<ss.length-1)ss[i+1].classList.add('active');}
  saveHist(){
    const sc=parseInt(document.getElementById('scoreNum').textContent)||0;
    this.hist.unshift({id:Date.now(),mode:this.mode,score:sc,dur:this.dur,time:new Date().toISOString()});
    if(this.hist.length>20)this.hist.pop();localStorage.setItem('ah',JSON.stringify(this.hist));this.renderHist();
  }
  renderHist(){
    const c=document.getElementById('histList');
    if(!this.hist.length){c.innerHTML='<div class="empty"><div class="empty-icon">ğŸ“Š</div><div>ChÆ°a cÃ³ lá»‹ch sá»­</div></div>';return;}
    c.innerHTML=this.hist.map(h=>{const d=new Date(h.time),ts=d.toLocaleDateString('vi-VN')+' '+d.toLocaleTimeString('vi-VN',{hour:'2-digit',minute:'2-digit'}),ml=h.mode==='vocal'?'ğŸ¤ Vocal':h.mode==='guitar'?'ğŸ¸ Guitar':'ğŸµ Full';let col='var(--green)';if(h.score<55)col='var(--red)';else if(h.score<75)col='var(--yellow)';return`<div class="history-item"><div class="history-score" style="color:${col}">${h.score}</div><div class="history-info"><div class="history-mode">${ml}</div><div class="history-time">${ts} â€¢ ${h.dur}s</div></div><button class="history-btn" onclick="app.delHist(${h.id})">ğŸ—‘ï¸</button></div>`;}).join('');
  }
  delHist(id){this.hist=this.hist.filter(h=>h.id!==id);localStorage.setItem('ah',JSON.stringify(this.hist));this.renderHist();}
  
  // COMPARE FEATURE
  saveCompare(type){
    const sc=parseInt(document.getElementById('scoreNum').textContent)||0;
    if(sc===0){alert('ChÆ°a cÃ³ káº¿t quáº£ phÃ¢n tÃ­ch! HÃ£y phÃ¢n tÃ­ch trÆ°á»›c.');return;}
    
    const bandsData={};
    Object.keys(this.bands).forEach(k=>{bandsData[k]=Math.round(this.bands[k].avg);});
    
    if(type==='before'){
      this.compareBefore={score:sc,bands:bandsData};
      document.getElementById('scoreBefore').textContent=sc;
      document.getElementById('scoreBefore').style.color=sc>=70?'var(--green)':sc>=50?'var(--yellow)':'var(--red)';
      document.getElementById('compareLeft').style.borderColor='var(--accent)';
    }else{
      this.compareAfter={score:sc,bands:bandsData};
      document.getElementById('scoreAfter').textContent=sc;
      document.getElementById('scoreAfter').style.color=sc>=70?'var(--green)':sc>=50?'var(--yellow)':'var(--red)';
      document.getElementById('compareRight').style.borderColor='var(--green)';
    }
    
    this.updateCompare();
  }
  
  updateCompare(){
    if(!this.compareBefore||!this.compareAfter)return;
    
    const diff=this.compareAfter.score-this.compareBefore.score;
    const el=document.getElementById('compareChange');
    const msg=document.getElementById('compareMsg');
    
    if(diff>0){
      el.innerHTML=`<span style="color:var(--green)">+${diff} Ä‘iá»ƒm ğŸ‰</span>`;
      msg.textContent=diff>=20?'Cáº£i thiá»‡n TUYá»†T Vá»œI! Giá»¯ nguyÃªn setting nÃ y!':diff>=10?'Cáº£i thiá»‡n tá»‘t! CÃ³ thá»ƒ chá»‰nh thÃªm.':'CÃ³ cáº£i thiá»‡n. Tiáº¿p tá»¥c chá»‰nh!';
    }else if(diff<0){
      el.innerHTML=`<span style="color:var(--red)">${diff} Ä‘iá»ƒm ğŸ˜¢</span>`;
      msg.textContent='Tá»‡ hÆ¡n trÆ°á»›c! HÃ£y quay láº¡i setting cÅ©.';
    }else{
      el.innerHTML=`<span style="color:var(--yellow)">KhÃ´ng Ä‘á»•i</span>`;
      msg.textContent='KhÃ´ng cÃ³ thay Ä‘á»•i. Thá»­ chá»‰nh khÃ¡c Ä‘i.';
    }
    
    // Show bands comparison
    document.getElementById('compareBands').style.display='block';
    const bandNames={bass:'Bass',lowMid:'Low-Mid',mid:'Mid',highMid:'Hi-Mid',high:'High'};
    document.getElementById('compareBandsList').innerHTML=Object.keys(bandNames).map(k=>{
      const before=this.compareBefore.bands[k]||0;
      const after=this.compareAfter.bands[k]||0;
      const target=this.targets[this.mode][k];
      const beforeDiff=Math.abs(before-target);
      const afterDiff=Math.abs(after-target);
      const improved=afterDiff<beforeDiff;
      const change=after-before;
      return`<div class="compare-band">
        <div class="compare-band-name">${bandNames[k]}</div>
        <div class="compare-band-bars">
          <div class="compare-band-bar" style="width:${before}%;background:var(--text3)"></div>
          <span style="font-size:0.6rem;color:var(--text3)">â†’</span>
          <div class="compare-band-bar" style="width:${after}%;background:${improved?'var(--green)':'var(--yellow)'}"></div>
        </div>
        <div class="compare-band-change" style="color:${improved?'var(--green)':'var(--yellow)'}">${change>0?'+':''}${change}%</div>
      </div>`;
    }).join('');
  }
  
  resetCompare(){
    this.compareBefore=null;this.compareAfter=null;
    document.getElementById('scoreBefore').textContent='--';
    document.getElementById('scoreBefore').style.color='var(--text3)';
    document.getElementById('scoreAfter').textContent='--';
    document.getElementById('scoreAfter').style.color='var(--text3)';
    document.getElementById('compareLeft').style.borderColor='var(--border)';
    document.getElementById('compareRight').style.borderColor='var(--border)';
    document.getElementById('compareChange').textContent='ChÆ°a cÃ³ dá»¯ liá»‡u';
    document.getElementById('compareMsg').textContent='PhÃ¢n tÃ­ch â†’ LÆ°u TRÆ¯á»šC â†’ Chá»‰nh mixer â†’ PhÃ¢n tÃ­ch láº¡i â†’ LÆ°u SAU';
    document.getElementById('compareBands').style.display='none';
  }
  
  // FEEDBACK DETECTION
  toggleFeedback(){
    if(this.fbRunning){this.stopFeedback();}else{this.startFeedback();}
  }
  
  async startFeedback(){
    try{
      this.fbStream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:false,noiseSuppression:false,autoGainControl:false}});
      this.fbCtx=new(window.AudioContext||window.webkitAudioContext)();
      this.fbAn=this.fbCtx.createAnalyser();this.fbAn.fftSize=8192;this.fbAn.smoothingTimeConstant=0.5;
      this.fbSrc=this.fbCtx.createMediaStreamSource(this.fbStream);this.fbSrc.connect(this.fbAn);
      this.fbData=new Uint8Array(this.fbAn.frequencyBinCount);
      this.fbRunning=true;this.fbPeaks=[];
      document.getElementById('feedbackBtn').classList.add('rec');
      document.getElementById('fbIcon').textContent='â¹ï¸';
      document.getElementById('fbText').textContent='Dá»ªNG TÃŒM FEEDBACK';
      this.fbCanvas=document.getElementById('fbCanvas');
      this.fbC=this.fbCanvas.getContext('2d');
      const r=this.fbCanvas.parentElement.getBoundingClientRect();
      this.fbCanvas.width=r.width*2;this.fbCanvas.height=120*2;this.fbC.scale(2,2);
      this.fbW=r.width;this.fbH=120;
      this.drawFeedback();
    }catch(e){alert('KhÃ´ng thá»ƒ truy cáº­p mic!');console.error(e);}
  }
  
  stopFeedback(){
    this.fbRunning=false;
    if(this.fbStream)this.fbStream.getTracks().forEach(t=>t.stop());
    if(this.fbCtx)this.fbCtx.close();
    document.getElementById('feedbackBtn').classList.remove('rec');
    document.getElementById('fbIcon').textContent='ğŸ¤';
    document.getElementById('fbText').textContent='Báº®T Äáº¦U TÃŒM FEEDBACK';
  }
  
  drawFeedback(){
    if(!this.fbRunning)return;
    requestAnimationFrame(()=>this.drawFeedback());
    this.fbAn.getByteFrequencyData(this.fbData);
    
    // Find peaks
    const peaks=[];const threshold=200;
    for(let i=10;i<this.fbData.length-10;i++){
      if(this.fbData[i]>threshold&&this.fbData[i]>this.fbData[i-1]&&this.fbData[i]>this.fbData[i+1]){
        const freq=i*this.fbCtx.sampleRate/this.fbAn.fftSize;
        if(freq>100&&freq<10000){peaks.push({freq,level:this.fbData[i]});}
      }
    }
    
    // Sort by level and keep top 5
    peaks.sort((a,b)=>b.level-a.level);
    const topPeaks=peaks.slice(0,5);
    
    // Update peaks history
    topPeaks.forEach(p=>{
      const existing=this.fbPeaks.find(x=>Math.abs(x.freq-p.freq)<100);
      if(existing){existing.count++;existing.level=Math.max(existing.level,p.level);}
      else{this.fbPeaks.push({...p,count:1});}
    });
    
    // Draw spectrum
    this.fbC.fillStyle='#0a0a12';this.fbC.fillRect(0,0,this.fbW,this.fbH);
    const bars=128,bw=this.fbW/bars;
    for(let i=0;i<bars;i++){
      const idx=Math.floor(Math.pow(i/bars,1.5)*this.fbData.length*0.3);
      const v=this.fbData[idx]/255;
      const h=v*this.fbH*0.9;
      const danger=v>0.78;
      this.fbC.fillStyle=danger?'rgba(255,56,96,0.9)':'rgba(0,200,255,0.6)';
      this.fbC.fillRect(i*bw+0.5,this.fbH-h,bw-1,h);
    }
    
    // Update feedback list
    const dangerous=this.fbPeaks.filter(p=>p.level>200&&p.count>3).sort((a,b)=>b.level-a.level).slice(0,5);
    if(dangerous.length>0){
      document.getElementById('feedbackList').innerHTML=dangerous.map(p=>{
        const freqName=this.getFreqName(p.freq);
        return`<div class="fb-item">
          <div class="fb-freq">${p.freq<1000?Math.round(p.freq)+'Hz':(p.freq/1000).toFixed(1)+'kHz'}</div>
          <div class="fb-info">
            <div class="fb-name">${freqName.name}</div>
            <div class="fb-level">${freqName.desc} â€¢ Äá»™ nguy hiá»ƒm: ${Math.round(p.level/255*100)}%</div>
          </div>
          <div class="fb-meter"><div class="fb-meter-fill" style="width:${p.level/255*100}%"></div></div>
        </div>`;
      }).join('');
      
      // Show solutions
      document.getElementById('feedbackTips').style.display='block';
      document.getElementById('feedbackSolutions').innerHTML=dangerous.slice(0,3).map(p=>{
        const sol=this.getFeedbackSolution(p.freq);
        return`<div class="tip"><span class="tip-icon">ğŸ”§</span><div>
          <div class="tip-title">${p.freq<1000?Math.round(p.freq)+'Hz':(p.freq/1000).toFixed(1)+'kHz'} - ${sol.title}</div>
          <div class="tip-text">${sol.action}</div>
        </div></div>`;
      }).join('');
    }
  }
  
  getFreqName(freq){
    if(freq<200)return{name:'Sub/Bass',desc:'Tiáº¿ng Ã¹ tráº§m'};
    if(freq<500)return{name:'Low-Mid',desc:'Tiáº¿ng Ã¹ Ä‘á»¥c'};
    if(freq<1000)return{name:'Mid',desc:'Tiáº¿ng hÃº tráº§m'};
    if(freq<2500)return{name:'Hi-Mid',desc:'Tiáº¿ng hÃº giá»¯a'};
    if(freq<5000)return{name:'Presence',desc:'Tiáº¿ng hÃº chÃ³i - PHá»” BIáº¾N!'};
    return{name:'Treble',desc:'Tiáº¿ng rÃ­t cao'};
  }
  
  getFeedbackSolution(freq){
    if(freq<200)return{title:'Giáº£m LO',action:'Váº·n nÃºm LO sang TRÃI ~1/4 vÃ²ng. Hoáº·c báº­t HPF.'};
    if(freq<500)return{title:'Cáº¯t Low-Mid',action:'Váº·n MID FREQ vá» 400Hz, giáº£m MID ~1/4 vÃ²ng TRÃI.'};
    if(freq<1000)return{title:'Giáº£m Mid nháº¹',action:'Váº·n MID FREQ vá» 800Hz-1kHz, giáº£m MID ~1/8 vÃ²ng.'};
    if(freq<2500)return{title:'Cáº¯t Hi-Mid',action:'Váº·n MID FREQ vá» '+(freq/1000).toFixed(1)+'kHz, giáº£m MID ~1/4 vÃ²ng TRÃI.'};
    if(freq<5000)return{title:'Cáº¯t Presence (Quan trá»ng!)',action:'Váº·n MID FREQ vá» '+(freq/1000).toFixed(1)+'kHz, giáº£m MID ~1/4 vÃ²ng. ÄÃ¢y lÃ  vÃ¹ng hay hÃº nháº¥t!'};
    return{title:'Giáº£m HI',action:'Váº·n nÃºm HI sang TRÃI ~1/8 vÃ²ng.'};
  }
  
  // LEARN FEATURE - LÆ°u Ã¢m thanh hay lÃ m chuáº©n
  learnFromCurrent(){
    // Check if we have analysis data
    const hasData = Object.values(this.bands).some(b => b.avg > 0);
    if(!hasData){
      alert('âš ï¸ ChÆ°a cÃ³ dá»¯ liá»‡u phÃ¢n tÃ­ch!\n\nHÃ£y:\n1. Nháº¥n "Báº¯t Ä‘áº§u phÃ¢n tÃ­ch"\n2. HÃ¡t/Ä‘Ã¡nh Ä‘Ã n 15-20 giÃ¢y\n3. Nháº¥n "Dá»«ng"\n4. Rá»“i má»›i nháº¥n "LÆ°u lÃ m chuáº©n"');
      return;
    }
    
    // Create custom target from current analysis
    this.customTarget = {
      bass: Math.round(this.bands.bass.avg),
      lowMid: Math.round(this.bands.lowMid.avg),
      mid: Math.round(this.bands.mid.avg),
      highMid: Math.round(this.bands.highMid.avg),
      high: Math.round(this.bands.high.avg),
      tol: 10,
      desc: 'Chuáº©n cá»§a tÃ´i - ' + new Date().toLocaleDateString('vi-VN'),
      savedAt: new Date().toISOString()
    };
    
    // Save to targets
    this.targets.custom = this.customTarget;
    
    // Persist to localStorage
    localStorage.setItem('customTarget', JSON.stringify(this.customTarget));
    localStorage.setItem('userTargets', JSON.stringify(this.targets));
    
    // Switch to custom mode
    this.mode = 'custom';
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('customModeBtn').classList.add('active');
    this.updateTargets();
    this.showCustomInfo();
    
    alert('âœ… ÄÃ£ lÆ°u thÃ nh cÃ´ng!\n\nÃ‚m thanh hiá»‡n táº¡i Ä‘Ã£ Ä‘Æ°á»£c lÆ°u lÃ m CHUáº¨N cá»§a báº¡n.\n\nTá»« giá» khi chá»n "â­ Cá»§a tÃ´i", app sáº½ so sÃ¡nh vá»›i chuáº©n nÃ y.');
  }
  
  resetToDefault(){
    if(!confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a chuáº©n tá»± táº¡o vÃ  quay vá» máº·c Ä‘á»‹nh?')) return;
    
    this.customTarget = null;
    this.targets = {...this.defaultTargets};
    
    localStorage.removeItem('customTarget');
    localStorage.removeItem('userTargets');
    
    // Switch back to vocal mode
    this.mode = 'vocal';
    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
    document.querySelector('[data-m="vocal"]').classList.add('active');
    this.updateTargets();
    this.hideCustomInfo();
    
    alert('âœ… ÄÃ£ reset vá» máº·c Ä‘á»‹nh!');
  }
  
  showCustomInfo(){
    const panel = document.getElementById('customInfo');
    const details = document.getElementById('customDetails');
    if(this.customTarget){
      panel.style.display = 'block';
      const date = this.customTarget.savedAt ? new Date(this.customTarget.savedAt).toLocaleDateString('vi-VN') : 'N/A';
      details.innerHTML = `
        Bass: ${this.customTarget.bass}% | Low-Mid: ${this.customTarget.lowMid}% | Mid: ${this.customTarget.mid}%<br>
        Hi-Mid: ${this.customTarget.highMid}% | High: ${this.customTarget.high}%<br>
        <span style="color:var(--text3)">LÆ°u ngÃ y: ${date}</span>
      `;
    }
  }
  
  hideCustomInfo(){
    document.getElementById('customInfo').style.display = 'none';
  }
  
  initLearnPanel(){
    if(this.customTarget){
      this.targets.custom = this.customTarget;
      this.showCustomInfo();
    }
  }
}

// Initialize app
let app;
document.addEventListener('DOMContentLoaded', function() {
  app = new App();
  console.log('âœ… App initialized');
});
</script>
</body>
</html>
